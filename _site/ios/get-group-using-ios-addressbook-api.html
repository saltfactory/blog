<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>iOS 주소록 API를 이용하여 그룹별 연락처 조회하기</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="">
    <link rel="canonical" href="/series/ios/get-group-using-ios-addressbook-api.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/series/assets/css/main.css">
    <!-- <link rel='stylesheet' type='text/css' href='/assets/css/main.css' /> -->

    
</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/series/">saltfactory's series</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="/">saltfactory.net</a>
        <a class="page-link" href="/guestbook">Guestbook</a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>iOS 주소록 API를 이용하여 그룹별 연락처 조회하기</h1>
    <p class="meta">Aug 13, 2012</p>
  </header>

  <article class="post-content">
  <p>우리는 앞서 <a href="http://blog.saltfactory.net/167">iOS 주소록 API를 이용하여 아이폰 주소록 그룹 다루기</a> 와  <a href="http://blog.saltfactory.net/168">iOS 주소록 API를 이용하여 아이폰 주소록 그룹 뷰컨트롤러 연결하기</a>편 에서 iOS의 AdddressBook.framework를 이용해서 주소록 데이터 중에서 그룹에 관련된 작업을 처리하는 방법에 대해서 함께 테스트하였다. 이번 포스팅은 주소록에서 연락처 조회에 관한 방법에 대해서 살펴볼 것이다. 테스트를 위해서 프로젝트를 생성해야한다. 지금까지 iOS  주소록 API 에 관련된 글을 계속 같이 해왔더라면 다음과 같이 github 에서 소스코드를 clone 하여 사용하면 된다.</p>

<!--more-->

<h2 id="소스코드-clone">소스코드 clone</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">git clone https://github.com/saltfactory/Saltfactory_iOS_Tutorial.git
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">checkout -t origin/t6-addressbook-group
</code></pre></div>
<p>위 소스가 이 포스팅 이전의 소스코드들이다. 이 소스코드에서 이어서 함께 진행하면 된다. 만약 zip이나 tar 형태로 다운로드 받아서 테스트하길 원하는 분들은 <a href="https://github.com/saltfactory/Saltfactory_iOS_Tutorial/tags">https://github.com/saltfactory/Saltfactory_iOS_Tutorial/tags</a> 에서 t6-addressbook-group 의 zip이나 tar.gz을 다운받아서 사용하면 된다.</p>

<p>앞이서 우리는 그룹에 관한 데이터 처리를 하기 위해서 SFGroupService라는 것을 만들었다. 마찬가지로 우리는 연락처에 대한 작업을 처리하기 위해서 SFContactService라는 객체를 만들어서 사용할 것이다.</p>

<p><img src="http://cfile9.uf.tistory.com/image/191BF145502A029F20FFCD" alt=""></p>

<p>이 포스트 이전에 우리는 SFGroupService에서 그룹 목록을 출력시키는 기능을 구현했었다. UITableView에 그룹 목록들이 나타나는데, 해당 그룹을 선택하여 Cell을 선택하면 groupId를 가지고 그룹을 찾아서 그 그룹에 해당된 연락처를 조회해서 이름을 출력시키도록 해보자.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFContactService.h</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/13/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>

<span class="k">@protocol</span> <span class="nc">SFContactServiceDelegate</span> <span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span>

<span class="k">@required</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">contactServiceDidFailWithError</span><span class="p">:(</span><span class="bp">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">contactServiceDidFindContacts</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">SFContactService</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
    <span class="kt">id</span><span class="o">&lt;</span><span class="n">SFContactServiceDelegate</span><span class="o">&gt;</span><span class="n">delegate</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="kt">id</span><span class="o">&lt;</span><span class="n">SFContactServiceDelegate</span><span class="o">&gt;</span><span class="n">delegate</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">findContactsWithGroupId:</span><span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nv">groupId</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div>
<p>ABAddressBook에서 groupId로  그룹을 찾는다는 것은 ABRecordRef를 찾는 다는 말과 같다. ABRecordRef는 ABAddressBookGetGroupWithRecrodID 함수로 찾아낼 수 있다. 그리고 ABGroupCopyArrayOfAllMembers라는 함수는 ABRecord 에 포함되는 멤버를 CFArrayRef 형태로 배열을 리턴하게 되는데 이 배열을 순차적으로 탐색하면서 각각 해당되는 ABRecordRef 정보를 CFArrayGetValueAtIndex로 찾아서 조회할 수 있다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFContactService.m</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/13/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &quot;SFContactService.h&quot;</span>
<span class="cp">#import &lt;AddressBook/AddressBook.h&gt;</span>
<span class="k">@implementation</span> <span class="nc">SFContactService</span>
<span class="k">@synthesize</span> <span class="n">delegate</span><span class="p">;</span>


<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">findContactsWithGroupId:</span><span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nv">groupId</span>
<span class="p">{</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>

    <span class="n">ABRecordRef</span> <span class="n">groupRef</span> <span class="o">=</span> <span class="n">ABAddressBookGetGroupWithRecordID</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="n">groupId</span><span class="p">);</span>
    <span class="n">CFArrayRef</span> <span class="n">membersRef</span> <span class="o">=</span> <span class="n">ABGroupCopyArrayOfAllMembers</span><span class="p">(</span><span class="n">groupRef</span><span class="p">);</span>

    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">contacts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">membersRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CFArrayGetCount</span><span class="p">(</span><span class="n">membersRef</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="bp">NSMutableDictionary</span> <span class="o">*</span><span class="n">personInfo</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableDictionary</span> <span class="n">dictionary</span><span class="p">];</span>

            <span class="n">ABRecordRef</span> <span class="n">personRef</span> <span class="o">=</span> <span class="n">CFArrayGetValueAtIndex</span><span class="p">(</span><span class="n">membersRef</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

            <span class="bp">NSInteger</span> <span class="n">personId</span> <span class="o">=</span> <span class="n">ABRecordGetRecordID</span><span class="p">(</span><span class="n">personRef</span><span class="p">);</span>

            <span class="p">[</span><span class="n">personInfo</span> <span class="nl">setValue</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="n">personId</span><span class="p">]</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;personId&quot;</span><span class="p">];</span>


            <span class="n">CFStringRef</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">ABRecordCopyValue</span><span class="p">(</span><span class="n">personRef</span><span class="p">,</span> <span class="n">kABPersonLastNameProperty</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lastName</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">personInfo</span> <span class="nl">setValue</span><span class="p">:(</span><span class="k">__bridge</span> <span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span> <span class="n">lastName</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;lastName&quot;</span><span class="p">];</span>
                <span class="n">CFRelease</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">CFStringRef</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">ABRecordCopyValue</span><span class="p">(</span><span class="n">personRef</span><span class="p">,</span> <span class="n">kABPersonFirstNameProperty</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">firstName</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">personInfo</span> <span class="nl">setValue</span><span class="p">:(</span><span class="k">__bridge</span> <span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span> <span class="n">firstName</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;firstName&quot;</span><span class="p">];</span>
                <span class="n">CFRelease</span><span class="p">(</span><span class="n">firstName</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="p">[</span><span class="n">contacts</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">personInfo</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">CFRelease</span><span class="p">(</span><span class="n">membersRef</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>

    <span class="bp">NSSortDescriptor</span> <span class="o">*</span> <span class="n">sortDescriptor</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSSortDescriptor</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithKey</span><span class="p">:</span><span class="s">@&quot;lastName&quot;</span> <span class="nl">ascending</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">[</span><span class="n">contacts</span> <span class="nl">sortUsingDescriptors</span><span class="p">:[</span><span class="bp">NSArray</span> <span class="nl">arrayWithObject</span><span class="p">:</span><span class="n">sortDescriptor</span><span class="p">]];</span>

    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">delegate</span> <span class="nl">contactServiceDidFindContacts</span><span class="p">:</span><span class="n">contacts</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></div>
<p>앞의 글에서 그룹을 목록화 해서 사용했던 SFGroupTableViewController의 Cell을 선택하면 그 그룹에 해당되는 멤버들의 연락처들을 보기 위해서 SFContactsTableViewController를 추가하도록 하자.</p>

<p><img src="http://cfile9.uf.tistory.com/image/11413845502A0DE22B3B1A" alt=""></p>

<p>이 SFContacatsTableViewController는 SFGroupTableViewController의 cell을 선택하면 navigationViewController로 뷰를 push 하도록 하기 위해서 SFGroupTableViewController.m 파일에 다음 코드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFGroupsTableViewController.m</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/13/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &quot;SFGroupsTableViewController.h&quot;</span>
<span class="cp">#import &quot;SFGroupEditorViewController.h&quot;</span>
<span class="cp">#import &quot;SFContactsTableViewController.h&quot;</span>

<span class="p">...</span> <span class="err">생략</span> <span class="p">...</span>

<span class="cp">#pragma mark - Table view delegate</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">tableView</span><span class="p">:(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">didSelectRowAtIndexPath</span><span class="p">:(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="n">indexPath</span>
<span class="p">{</span>
    <span class="c1">// Navigation logic may go here. Create and push another view controller.</span>
    <span class="cm">/*</span>
<span class="cm">     &lt;#DetailViewController#&gt; *detailViewController = [[&lt;#DetailViewController#&gt; alloc] initWithNibName:@&quot;&lt;#Nib name#&gt;&quot; bundle:nil];</span>
<span class="cm">     // ...</span>
<span class="cm">     // Pass the selected object to the new view controller.</span>
<span class="cm">     [self.navigationController pushViewController:detailViewController animated:YES];</span>
<span class="cm">     */</span>

    <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">groupInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tableView</span><span class="p">.</span><span class="n">editing</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">SFGroupEditorViewController</span> <span class="o">*</span><span class="n">groupEditorViewController</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SFGroupEditorViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithGroupInfo</span><span class="p">:</span><span class="n">groupInfo</span><span class="p">];</span>
        <span class="bp">UINavigationController</span> <span class="o">*</span><span class="n">navigationController</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UINavigationController</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithRootViewController</span><span class="p">:</span><span class="n">groupEditorViewController</span><span class="p">];</span>
        <span class="p">[</span><span class="nb">self</span> <span class="nl">presentModalViewController</span><span class="p">:</span><span class="n">navigationController</span> <span class="nl">animated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">SFContactsTableViewController</span> <span class="o">*</span><span class="n">contactsTableViewController</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SFContactsTableViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithGroupInfo</span><span class="p">:</span><span class="n">groupInfo</span><span class="p">];</span>
        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">navigationController</span> <span class="nl">pushViewController</span><span class="p">:</span><span class="n">contactsTableViewController</span> <span class="nl">animated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>다음은 SFContactsTAbleViewController에 -initWithGroupInfo: 를 추가하여 초기화 할 때 그룹 정보를 가져올 수 있도록 다음과 같이 코드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFContactsTableViewController.h</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/14/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>

<span class="k">@interface</span> <span class="nc">SFContactsTableViewController</span> : <span class="bp">UITableViewController</span>
<span class="p">{</span>
    <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">groupInfo</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithGroupInfo:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">aGroupInfo</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFContactsTableViewController.m</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/14/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &quot;SFContactsTableViewController.h&quot;</span>

<span class="k">@interface</span> <span class="nc">SFContactsTableViewController</span> <span class="p">()</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">SFContactsTableViewController</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithStyle:</span><span class="p">(</span><span class="n">UITableViewStyle</span><span class="p">)</span><span class="nv">style</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">style</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Custom initialization</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithGroupInfo:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">aGroupInfo</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">UITableViewStylePlain</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">groupInfo</span> <span class="o">=</span> <span class="n">aGroupInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">...</span> <span class="err">생략</span> <span class="p">...</span>
<span class="k">@end</span>
</code></pre></div>
<p>이제 우리가 그룹에 속하는 연락처들을 가져오기 위해서 만든 SFContactService 를 추가해보자.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFContactsTableViewController.h</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/14/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
<span class="cp">#import &quot;SFContactService.h&quot;</span>

<span class="k">@interface</span> <span class="nc">SFContactsTableViewController</span> : <span class="bp">UITableViewController</span><span class="o">&lt;</span><span class="n">SFContactServiceDelegate</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">groupInfo</span><span class="p">;</span>
    <span class="n">SFContactService</span> <span class="o">*</span><span class="n">contactService</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithGroupInfo</span><span class="p">:(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="n">aGroupInfo</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  SFContactsTableViewController.m</span>
<span class="c1">//  SFAddressbookTutorial</span>
<span class="c1">//</span>
<span class="c1">//  Created by saltfactory on 8/14/12.</span>
<span class="c1">//  Copyright (c) 2012 saltfactory.net. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &quot;SFContactsTableViewController.h&quot;</span>

<span class="k">@interface</span> <span class="nc">SFContactsTableViewController</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">items</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">SFContactsTableViewController</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithStyle:</span><span class="p">(</span><span class="n">UITableViewStyle</span><span class="p">)</span><span class="nv">style</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">style</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Custom initialization</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithGroupInfo:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">aGroupInfo</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">UITableViewStylePlain</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">groupInfo</span> <span class="o">=</span> <span class="n">aGroupInfo</span><span class="p">;</span>
        <span class="n">contactService</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SFContactService</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
        <span class="n">contactService</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>

    <span class="nb">self</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupInfo</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;name&quot;</span><span class="p">];</span>

    <span class="bp">NSInteger</span> <span class="n">groupId</span> <span class="o">=</span> <span class="p">[[</span><span class="n">groupInfo</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;groupId&quot;</span><span class="p">]</span> <span class="n">integerValue</span><span class="p">];</span>
    <span class="p">[</span><span class="n">contactService</span> <span class="nl">findContactsWithGroupId</span><span class="p">:</span><span class="n">groupId</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidUnload</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidUnload</span><span class="p">];</span>
    <span class="c1">// Release any retained subviews of the main view.</span>
    <span class="c1">// e.g. self.myOutlet = nil;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">shouldAutorotateToInterfaceOrientation:</span><span class="p">(</span><span class="n">UIInterfaceOrientation</span><span class="p">)</span><span class="nv">interfaceOrientation</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">interfaceOrientation</span> <span class="o">==</span> <span class="n">UIInterfaceOrientationPortrait</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#pragma mark - SFContactService delegate method</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">contactServiceDidFailWithError:</span><span class="p">(</span><span class="bp">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
<span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">error</span> <span class="n">localizedDescription</span><span class="p">]);</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">contactServiceDidFindContacts:</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">contacts</span>
<span class="p">{</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="nl">arrayWithArray</span><span class="p">:</span><span class="n">contacts</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">tableView</span> <span class="n">reloadData</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Table view data source</span>

<span class="p">-</span> <span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nf">numberOfSectionsInTableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>
<span class="p">{</span>
    <span class="c1">// Return the number of sections.</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nv">section</span>
<span class="p">{</span>
    <span class="c1">// Return the number of rows in the section.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">items</span> <span class="n">count</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="bp">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">CellIdentifier</span> <span class="o">=</span> <span class="s">@&quot;Cell&quot;</span><span class="p">;</span>
    <span class="bp">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier</span><span class="p">:</span><span class="n">CellIdentifier</span><span class="p">];</span>

    <span class="c1">// Configure the cell...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier</span><span class="p">:</span><span class="n">CellIdentifier</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">contactInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%@ %@&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">contactInfo</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;lastName&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">contactInfo</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;firstName&quot;</span><span class="p">]];</span>

    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span> <span class="err">생략</span> <span class="p">...</span>

<span class="k">@end</span>
</code></pre></div>
<p>iOS 시뮬레이터를 열고 테스트를 위해서 특정 그룹에 연락처를 추가해보자. 앞의 예제에서 만들었던 &quot;창원대학교&quot; 그룹에 연락처를 하나 추가했다.</p>

<p><img src="http://cfile25.uf.tistory.com/image/20309B43502A128A0F0A61" alt=""></p>

<p>이제 수정한 코드를 위해서 빌드하고 실행을 해보자.
다음과 같이 그룹 목록이 나오는 SFGroupTableViewController에서 &quot;창원대학교&quot;에 해당하는 Cell을 선택하면 SFContactsTableViewController가 navigationController에 push 되면서 &quot;창원대학교에&quot; 해당하는 연락처들을 조회해서 lastName과 firstName을 조합해서 UITableView에 나타내어 주게 된다.</p>

<p><img src="http://cfile6.uf.tistory.com/image/1961AB45502A135B1AD649" alt=""></p>

<p><img src="http://cfile8.uf.tistory.com/image/206D7745502A135E083DCA" alt=""></p>

<h2 id="결론">결론</h2>

<p>이번 포스팅에서는 간단하게 그룹별 연락처들의 목록을 조회하는 코드를 추가했다. 다음 포스팅에서는 그룹에 속한 연락처 목록을 조회한 뒤에 연락처 하나하나를 선택할 경우 연락처에 대한 자세한 정보를 출력하는 것에 대해서 포스팅을 할 에정이다. 이 포스팅에서 연락처 상세 조회까지 다루기에는 연락처 상세 조회에 대한 내용이 많기 때문에 분리하게 되었다. 이번 포스팅의 핵심은 그룹별 연락처를 조회할 때 groupId를 사용하는 것이다. 그리고 ABAddressBookGetGroupWithRecordID 함수를 이용해서 ABRecordRef 타입인 그룹 정보를 가져와서 ABGroupCopyArrayOfAllMembers 함수를 이용해서 NSArrayRef 형태의 연락처들의 정보를 배열로 가져올 수 있다는 것이다. 그리고 이 배열을 CFArrayGetValueAtIndex 함수를 이용해서 순차적으로 해당되는 연락처정보를 ABRecordRef 타입으로 가져와서 가각 해당되는 속성을 키 값으로 찾아오는데 있다. 이때 lastName의 키 값은 kABpersonLastNameProperty 이고 firstName의 키 값은 kABPersonFirstNameProperty 로 접근할 수 있다.</p>

<h2 id="소스">소스</h2>

<ul>
<li> <a href="https://github.com/saltfactory/Saltfactory_iOS_Tutorial/zipball/t7-addressbook-contact-findContactWithGroupId">https://github.com/saltfactory/Saltfactory_iOS_Tutorial/zipball/t7-addressbook-contact-findContactWithGroupId</a></li>
</ul>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  
  
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactorynet';
    
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <!-- <h2 class="footer-heading">saltfactory's series</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li><a href="http://saltfactory.net">www.saltfactory.net</a></li>
        <li><a href="http://blog.saltfactory.net">blog.saltfactory.net</a></li>
        <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/saltfactory">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
  c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
  c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
  c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
  C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
  c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
  c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
  c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
  c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://twitter.com/saltfactory">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
  c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
  c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
  C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
  c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
  c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://facebook.com/saltfactory">
            <span class="icon facebook">
          		<svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
		
        	</span>
        	<span class="username">salthub</span>
			</a>
        </li>

      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text"></p>
    </div>

  </div>

</footer>


	<script src="/series/assets/javascripts/jekyll-img-converter.js"></script>
    </body>
</html>
