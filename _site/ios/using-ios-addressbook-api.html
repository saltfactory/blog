<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>iOS 주소록 API를 이용하여 아이폰 주소록 다루기</title>
    <meta name="description" content="">

    <meta content="saltfactory's blog" property="og:site_name">
    
    <meta content="iOS 주소록 API를 이용하여 아이폰 주소록 다루기" property="og:title">
    
    
    <meta content="article" property="og:type">
    
    <!-- 서론

아이폰에서는 주소록 API를 이용해서 주소록 데이터를 접근해서 조회하거나 저장할 수 있다. 이번 포스팅에서는 아이폰 앱 개발을 할 때 주소록 API를 사용하는 방법에 대해서 예제를 통해 살펴보기로 할 것이다. 주소록 API를 이용해서 사용할 수 있는 범위가 다양하고 또한 API 사용법 역시 다양하기 때문에 몇개의 아티클로 나누어서 포스팅을 할 예정이다. 그 첫번째로 iOS 주소록 API를 이용해서 주소록에 있는 그룹을 다루는 방법에 대해서 살펴보자.
 -->


    
    
    <meta content="http://blog.saltfactory.net/ios/using-ios-addressbook-api.html" property="og:url">
    
    
    <meta content="2012-08-10T00:00:00+09:00" property="article:published_time">
    <meta content="http://blog.saltfactory.net/about/" property="article:author">
    
    <!-- 
    <meta content="/img/logo-high-resolution.png" property="og:image">
     -->
    
    
    <meta content="ios" property="article:section">
    
    
    
    
    <meta content="ios" property="article:tag">
    
    <meta content="addressbook" property="article:tag">
    
    <meta content="api" property="article:tag">
    
    <meta content="sdk" property="article:tag">
    
    <meta content="objective-c" property="article:tag">
    
    



    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://blog.saltfactory.net/ios/using-ios-addressbook-api.html">
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="/assets/foaf.rdf" />

    

    
      <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-8647285-2', 'auto');
ga('send', 'pageview');
</script>

    
</head>


  <body>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">saltfactory's blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
        viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
        <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
        h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
        <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
        h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
        <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
        c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
      </svg>
    </a>
    <div class="trigger">
      <!-- <a class="page-link" href="http://saltfactory.net">saltfactory.net</a> -->
      <!--
      
      <a class="page-link" href="/about/">About</a>
      
      
      
      
      
      
      
      <a class="page-link" href="/categories/">Categories</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a class="page-link" href="/guestbook/">GuestBook</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a class="page-link" href="/categories/ruby/">Articles by category: ruby</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      -->


      <a class="page-link" href="/about/">About</a>
      <a class="page-link" href="/categories/">Categories</a>
      <a class="page-link" href="/guestbook/">GuestBook</a>
      <a class="page-link" href="http://saltfactory.net">saltfactory.net</a>
    </div>

    </nav>
    <script>
(function() {
  var cx = '014516175331458470005:ze8dwrrwnac';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
  '//cse.google.com/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
</script>
<gcse:search></gcse:search>

</div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">iOS 주소록 API를 이용하여 아이폰 주소록 다루기</h1>
    <p class="post-meta">Aug 10, 2012</p>
  </header>

  <article class="post-content">
    <h2 id="서론">서론</h2>

<p>아이폰에서는 주소록 API를 이용해서 주소록 데이터를 접근해서 조회하거나 저장할 수 있다. 이번 포스팅에서는 아이폰 앱 개발을 할 때 주소록 API를 사용하는 방법에 대해서 예제를 통해 살펴보기로 할 것이다. 주소록 API를 이용해서 사용할 수 있는 범위가 다양하고 또한 API 사용법 역시 다양하기 때문에 몇개의 아티클로 나누어서 포스팅을 할 예정이다. 그 첫번째로 iOS 주소록 API를 이용해서 주소록에 있는 그룹을 다루는 방법에 대해서 살펴보자.</p>

<!--more-->

<p>우선 예제를 테스트할 프로젝트를 만들어보자. 각자 원하는 이름으로 프로젝트를 생성한다. 이 포스팅에서 사용한 프로젝트 이름은 SFAddressbookTutorial 이다.</p>

<p><img src="http://cfile10.uf.tistory.com/image/205386375024A70E03BFD8" alt=""></p>

<p>이번 프로젝트부터는 Unit Tests를 활용할것이다. 프로젝트를 진행하면서 단위테스트는 매우 중요한 것이라고 생각하고 있기 때문에 단위테스트를 하는 습관을 가질 필요가 있다. 프로젝트를 생성하면 단위테스트를 하기위한 샘플 파일이 자동으로 생성이된다.</p>

<p><img src="http://cfile2.uf.tistory.com/image/1117A9455024A8320BE953" alt=""></p>

<p>Xcode에서 Objective-C를 단위테스트하기 위한 방법에 대해서는 다음에 자세히 설명하도록 하겠다.
단위테스트를 할 수 있는 테스트프로젝트에 주소록 API를 사용할 수 있도록 Library를 추가한다.
프로젝트 파일을 선택하여 Targets 중에 SFAddressBookTutorialTests 타켓을 선택한다. 그리고 Build Phases를 선택하여 Link Binary with Libraries를 열어서 Addressbook.framework와 AddressbookUI.framework를 추가한다.</p>

<p><img src="http://cfile1.uf.tistory.com/image/174E583A5024A9400CD392" alt=""></p>

<p>이제 iOS에서 주소록 API를 사용할 준비가 모두 마쳤다.
SFAddressBookTutorialTests.m 파일을 열어서 -testSelectAllGroups 메소드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSelectAllGroups</span>
<span class="p">{</span>

<span class="p">}</span>
</code></pre></div>
<p>다음은 단위 테스트 중에서 이 메소드만 테스트하고 싶기 때문에 alt 키를 누른 상태에서 Run 버튼을 클릭하여 Test하는 메소드 중에서 testSelectallGroups만 제외하고 모두 체크를 해제한다.</p>

<p><img src="http://cfile27.uf.tistory.com/image/177605335024AAE51FF627" alt=""></p>

<p>다음은 Test를 선택하거나 테스트를 진행하거나 command + U 를 선택해서 단위 테스트를 시작한다.
지금은 테스트메소드 안에 아무런 코드가 없어서 특별한 에러나 오류 없이 테스트가 성공적으로 끝나게 될 것이다.</p>

<h2 id="abaddressbook">ABAddressBook</h2>

<p>아이폰의 주소록은 ABAddressBook 이라는 객체로 접근을 할 수 가 있다. 그렇기 때문에 주소록의 데이터를 가져오기 위해서는 ABAddressBook을 생성해야 한다.
다음 코드를 추가해서 다시 단위테스트를 진행해보자. ABaddressBook은 NSObject 타입이 아니다. 그렇기 때문에 STAssertNotNil과 같이 id 타입으로 테스트를 진행할 수 있다. 또한 NSObject 타입이 아니고 ARC를 사용할 수 없기 대문에 메모리를 할당하는 작업을 한 뒤에는 반드시 CFRelease를 해줘야한다. 다음 코드는 ABAddressBookCreate()를 이용해서 메모리를 할당받고 난 다음에 그것이 NULL이 아닌지를 테스트한 코드이다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSelectAllGroups</span>
<span class="p">{</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>
    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>만약 로직상 잘못된 로직을 테스트한다면 다음과 같이 에러를 만나게 된다. 위 코드를 다음과 같이 수정한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSelectAllGroups</span>
<span class="p">{</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>
    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="http://cfile7.uf.tistory.com/image/163D214B5024AE3B1840DD" alt=""></p>

<p><img src="http://cfile10.uf.tistory.com/image/136287365024AEB22ED433" alt=""></p>

<p>이렇게 단위테스트에서 로직을 간단하게 테스트할 수 있다.</p>

<h2 id="abaddressbookcopyarrayofallgroups">ABAddressBookCopyArrayOfAllGroups</h2>

<p>이제 아이폰 주소록에 있는 그룹 목록을 가져오기 위해서 ABAddressBookRef에서 모든 Group을 가져오는 코드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSelectAllGroups</span>
<span class="p">{</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">CFArrayRef</span> <span class="n">groupsRef</span> <span class="o">=</span> <span class="n">ABAddressBookCopyArrayOfAllGroups</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">groupsRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;groupsRef is NULL&quot;</span><span class="p">);</span>
    <span class="n">CFRelease</span><span class="p">(</span><span class="n">groupsRef</span><span class="p">);</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>단위테스트를 진행하면 아무런 에러가 나지 않는다. 그래서 실제 아이폰 주소록의 데이터를 확인해보았는데 지금 시뮬레이터의 아이폰 주소록에는 어떤 연락처도 존재하지 않는다.</p>

<p><img src="http://cfile21.uf.tistory.com/image/1479953A5024B0B1074B2A" alt=""></p>

<p>우리는 ABAddressBookRef에서부터 그룹 목록을 가져오고 난 뒤에 그룹의 갯수를 알아보기로 하는 코드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSelectAllGroups</span>
<span class="p">{</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">CFArrayRef</span> <span class="n">groupsRef</span> <span class="o">=</span> <span class="n">ABAddressBookCopyArrayOfAllGroups</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">groupsRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;groupsRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">CFIndex</span> <span class="n">numberOfGroup</span> <span class="o">=</span> <span class="n">ABAddressBookGetGroupCount</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">numberOfGroup</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">@&quot;groupsRef count is 0&quot;</span><span class="p">);</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">groupsRef</span><span class="p">);</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
</code></pre></div>
<p>다시 단위 테스트를 실행해보니 다음과 같이 에러가 발생한다.</p>

<p><img src="http://cfile21.uf.tistory.com/image/153812405024B1C11A0C7F" alt=""></p>

<p>즉, 현재 테스트하고 있는 아이폰 주소록에는 그룹이 하나도 존재하고 있지 않다는 것이다.</p>

<h2 id="abaddressbooksave">ABAddressBookSave</h2>

<p>이제 우리는 ABAddressBookRef에 새로운 그룹을 하나 추가하는 테스트를 진행할 것이다. -testCreateGroup 이라는 단위테스트 메소드를 만들어보자.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testCreateGroup</span>
<span class="p">{</span>
    <span class="n">CFErrorRef</span> <span class="n">errorRef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">ABRecordRef</span> <span class="n">groupRef</span> <span class="o">=</span> <span class="n">ABGroupCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">groupRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;groupRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">CFStringRef</span> <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">CFStringRef</span><span class="p">)</span><span class="s">@&quot;테스트그룹&quot;</span><span class="p">;</span>
    <span class="n">ABRecordSetValue</span><span class="p">(</span><span class="n">groupRef</span><span class="p">,</span> <span class="n">kABGroupNameProperty</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorRef</span><span class="p">);</span>

    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">errorRef</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;error is not NULL&quot;</span><span class="p">);</span>

    <span class="n">ABAddressBookAddRecord</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="n">groupRef</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorRef</span><span class="p">);</span>
    <span class="n">ABAddressBookSave</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorRef</span><span class="p">);</span>

    <span class="bp">NSInteger</span> <span class="n">groupId</span> <span class="o">=</span> <span class="n">ABRecordGetRecordID</span><span class="p">(</span><span class="n">groupRef</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">groupId</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">@&quot;group is not created&quot;</span><span class="p">);</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">groupRef</span><span class="p">);</span>
    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<p>ABAddressBookRef 에 그룹을 추가하기 위해서는 ABRecordRef 타입의 그룹정보를 생성해서 ABAddressBook에 ABRecordRef 타입의 그룹 정보를 추가하고 추가된 ABAddressBook을 저장하면 된다. 테스트를 마치고 시뮬레이터의 주소록을 살펴보면 새로운 그룹이 생성된 것을 확인할 수 있다.</p>

<p><img src="http://cfile10.uf.tistory.com/image/16504B335024C01832D217" alt=""></p>

<p>우선 ABGroupCreate()를 이용해서 그룹정보를 생성해서 저장할 준비를 한다.
다음은 ABRecordSetValue를 이용해서 방금 생성한 grouopRef를 kABGroupNameProperty 속성으로 이름을 가지고 저장한다.
이렇게 생성해서 이름까지 추가된 groupRef(즉, ABRecordRef)는 ABAddressBookAdRecord()로 새로운 레코드로 저장이 된다. 이때 생성해둔 addressBookRef에 추가하려고 만든 groupRef를 넘겨서 추가하게 한다. 그리고 마니막으로 ABAddressBookSave 메소드로 addressBookRef의 갱신된 정보를 완벽하게 저장하게 한다. 저장된 ABRecordRef 정보를 이용해서 ABRecrodID를 가져올 수 있는데 이것이 바로 방금전에 저장된 Group의 ABRecord의 ID  값이 되고 이것이 아이폰 주소록의 유일한 그룹의 identifier와 동일하다.</p>

<p>이제 다시 모든 그룹을 조회하는 단위테스트를 진행해보자. 이제 에러 없이 성공적으로 STAssertTrue(numberOfGroup != 0, @&quot;groupsRef count is 0&quot;); 테스트가 통과 될 것이다.
이제 주소록에서 모든 그룹을 가져와서 NSLog로 출력을 한번해도록 하자. (단위테스트에서는 Log를 출력하는 것이 그렇게 좋은 코드가 되지 못한다. 로직을 테스트하면 하도록 한다.)</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSelectAllGroups</span>
<span class="p">{</span>
    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">CFArrayRef</span> <span class="n">groupsRef</span> <span class="o">=</span> <span class="n">ABAddressBookCopyArrayOfAllGroups</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">groupsRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;groupsRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">CFIndex</span> <span class="n">numberOfGroup</span> <span class="o">=</span> <span class="n">ABAddressBookGetGroupCount</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">numberOfGroup</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">@&quot;groupsRef count is 0&quot;</span><span class="p">);</span>


    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfGroup</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ABRecordRef</span> <span class="n">groupRef</span> <span class="o">=</span> <span class="n">CFArrayGetValueAtIndex</span><span class="p">(</span><span class="n">groupsRef</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

        <span class="n">CFStringRef</span> <span class="n">groupNameRef</span> <span class="o">=</span> <span class="n">ABRecordCopyValue</span><span class="p">(</span><span class="n">groupRef</span><span class="p">,</span> <span class="n">kABGroupNameProperty</span><span class="p">);</span>

        <span class="bp">NSInteger</span> <span class="n">groupId</span> <span class="o">=</span> <span class="n">ABRecordGetRecordID</span><span class="p">(</span><span class="n">groupRef</span><span class="p">);</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;groupId : %d&quot;</span><span class="p">,</span> <span class="n">groupId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">groupNameRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;groupName : %@&quot;</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">groupNameRef</span><span class="p">);</span>
            <span class="n">CFRelease</span><span class="p">(</span><span class="n">groupNameRef</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">groupsRef</span><span class="p">);</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>위에 코드에서 보듯이 모든 그룹을 배열형태로 가져오고 그 배열을 순차적으로 돌면서 해당되는 index 의 그룹 정보를 출력하고 있다.</p>

<p><img src="http://cfile10.uf.tistory.com/image/135CF5445024BB371724F4" alt=""></p>

<p>현재 테스트하고 있는 시뮬레이터의 주소록에서 ABRecordGetRecordID로 구한 groupId는 1이다. 우리는 이 groupId를 가지고 그룹을 삭제하는 테스트를 할 것이다.</p>

<h2 id="abaddressbookremoverecord">ABAddressBookRemoveRecord</h2>

<p>그룹 삭제 테스트를 위해서 -testDeleteGroup 단위테스트 메소드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testDeleteGroup</span>
<span class="p">{</span>

    <span class="bp">NSInteger</span> <span class="n">groupId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">CFErrorRef</span> <span class="n">errorRef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">ABAddressBookRef</span> <span class="n">addressBookRef</span> <span class="o">=</span> <span class="n">ABAddressBookCreate</span><span class="p">();</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">addressBookRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;addressBookRef is NULL&quot;</span><span class="p">);</span>

    <span class="n">ABRecordRef</span> <span class="n">savedGroupRef</span> <span class="o">=</span> <span class="n">ABAddressBookGetGroupWithRecordID</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="n">groupId</span><span class="p">);</span>
    <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">savedGroupRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;groupRef is not saved&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">savedGroupRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ABAddressBookRemoveRecord</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="n">savedGroupRef</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorRef</span><span class="p">);</span>
        <span class="n">ABAddressBookSave</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorRef</span><span class="p">);</span>

        <span class="n">savedGroupRef</span> <span class="o">=</span> <span class="n">ABAddressBookGetGroupWithRecordID</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">,</span> <span class="n">groupId</span><span class="p">);</span>
        <span class="n">STAssertTrue</span><span class="p">(</span><span class="n">savedGroupRef</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">@&quot;groupRef is not deleted&quot;</span><span class="p">);</span>

    <span class="p">}</span>


    <span class="k">if</span> <span class="p">(</span><span class="n">errorRef</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">CFRelease</span><span class="p">(</span><span class="n">errorRef</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">addressBookRef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="결론">결론</h2>

<p>이렇게 groupId를 이용해서 ABAddressBook에서 ABAddressBookGetGroupWithRecordID로 ABRecordRef를 찾은 다음 그것을 ABAddressBookRemoveRecord를 이용해서 제거한 다음에 변경된 ABAddressBook을 완전히 저장하도록 한다.</p>

<h2 id="소스">소스</h2>

<ul>
<li><a href="https://github.com/saltfactory/Saltfactory_iOS_Tutorial/zipball/t5-addressbook-group">https://github.com/saltfactory/Saltfactory_iOS_Tutorial/zipball/t5-addressbook-group</a></li>
</ul>

<h2 id="참고">참고</h2>

<ol>
<li><a href="https://developer.apple.com/library/mac/#documentation/userexperience/Refere">https://developer.apple.com/library/mac/#documentation/userexperience/Refere</a></li>
</ol>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_sharing_toolbox"></div>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55706d7f707f75ff" async="async"></script>



<!-- <div class='shareaholic-canvas' data-app='share_buttons' data-app-id=''></div>
<script type="text/javascript">
//<![CDATA[
  (function() {
    var shr = document.createElement('script');
    shr.setAttribute('data-cfasync', 'false');
    shr.src = '//dsms0mj1bbhn4.cloudfront.net/assets/pub/shareaholic.js';
    shr.type = 'text/javascript'; shr.async = 'true';
    shr.onload = shr.onreadystatechange = function() {
      var rs = this.readyState;
      if (rs && rs != 'complete' && rs != 'loaded') return;
      var site_id = 'fd3b2a079d78a86b57bffbfc4e3ee42d';
      try { Shareaholic.init(site_id); } catch (e) {}
    };
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(shr, s);
  })();
//]]>
</script> -->

  
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactoryblog';
    
    // 
    

    
      var disqus_identifier = 'http://blog.saltfactory.net/167';
    

    
      var disqus_url = 'http://blog.saltfactory.net/ios/using-ios-addressbook-api.html';
    


    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  



</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">saltfactory's blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <!-- <li>saltfactory's blog</li> -->
          <li><img class="profile" src="/assets/images/profile.png"/></li>
          <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
          <li><a href="http://saltfactory.net">saltfactory.net</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/saltfactory">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/saltfactory">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">@saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://facebook.com/salthub">
              <span class="icon icon--facebook">
                <!-- <svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
 -->
                <svg viewBox="0 0 16 28">
                  <path id="logo" d="M14.984 0.187v4.125h-2.453q-1.344 0-1.813 0.562t-0.469 1.687v2.953h4.578l-0.609 4.625h-3.969v11.859h-4.781v-11.859h-3.984v-4.625h3.984v-3.406q0-2.906 1.625-4.508t4.328-1.602q2.297 0 3.563 0.187z"></path>
                </svg>
              </span>
              <span class="username">salthub</span>
            </a>
          </li>

        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
