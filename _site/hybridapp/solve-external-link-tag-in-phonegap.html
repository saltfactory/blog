<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PhoneGap(Cordova) 외부 링크(a link) 새창으로 열기</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="">
    <link rel="canonical" href="/series/hybridapp/solve-external-link-tag-in-phonegap.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/series/assets/css/main.css">
    <!-- <link rel='stylesheet' type='text/css' href='/assets/css/main.css' /> -->

    
</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/series/">saltfactory's series</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="/">saltfactory.net</a>
        <a class="page-link" href="/guestbook">Guestbook</a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>PhoneGap(Cordova) 외부 링크(a link) 새창으로 열기</h1>
    <p class="meta">Jun 14, 2014</p>
  </header>

  <article class="post-content">
  <h2 id="서론">서론</h2>

<p>PhoneGap을 사용하여 크로스플랫폼 하이브리드 앱을 개발할 때, PhoneGap은 SDK의 <strong>WebView</strong> 기반으로 동작하는 어플리케이션으로 WebView 에 링크가 있을 경우 PhoneGap 내부의 URL은 해당 페이지를 이동하지만, 만약 외부 URL이 포함된 경우 링크를 터치하면 PhoneGap 하이브리드 앱에서 외부링크로 location이 변경되어 버린다. 이 문제를 해결하기 위해 PhoneGap 내부에서 외부 링크가 포함되었을 때 처리하는 방법에 대해서 소개한다.</p>

<!--more-->

<p><img src="http://tricedesigns.com/presentations/dreamforce/native-like%20phonegap%20apps/assets/phonegap_flow.png" alt="phonegap"></p>

<p><a href="http://phonegap.com">PhoneGap</a> (<a href="http://cordova.apache.org">Cordova</a>) 는 <strong>하이브리드 앱 개발 플랫폼</strong>이다. 모바일 앱 개발을 할 때 하이브리드 앱이라고 하면 통상 웹 자원과 네이티브 자원을 함께 사용해서 앱을 개발하는 것을 의미한다. PhoneGap은 UI 및 사용자의 이벤트를 HTML 나 JavaScript로 처리를 한다. 이 말은 다시말하면 PhoneGap은 내장 <strong><em>WebView</em></strong>를 사용하고 WebView 안에 웹 자원을 사용하여 개발을 한다는 것이다. PhoneGap에서 웹 자원은 로컬 HTML, CSS, 그리고 JavaScript를 사용한다. 웹뷰에서 HTML으로 UI를 만들때 페이지 전환을 링크를 사용한다. 이 때 앱 안에 링크를 사용할 때 다음과 같은 문제를 가진다.</p>

<blockquote>
<p>HTML 파일 안에 a 링크로 외부로 연결하는 코드가 있으면 사용자는 이것을 선택하면 http 주소로 location을 변경하면서 PhoneGap의 UI가 모두 사라져 버리는 문제가 있다.</p>
</blockquote>

<p>다시 말해서 앱 안에 <code>&lt;a href=&quot;http://blog.saltfactory.net&quot;&gt;blog&lt;/a&gt;</code> 라는 링크가 앱 안에 있을 때 이 링크를 누르는 순간 새로운 창이 나나타는 것이 아니라 동작하던 앱의 화면은 사라지고 WebView는 블로그 페이지로 가득차버리는 문제가 발생한다. 예제로 PhoneGap 프로젝트를 만들어보자.</p>

<p>프로젝트 이름은 <strong>sf-phonegap-demo</strong>라고 만들어보자. 처음 PhoneGap으로 프로젝트를 만든다면 <a href="http://blog.saltfactory.net/228">[PhoneGap 하이브리드 앱 개발] #1. PhoneGap과 Node.js로 하이브리드 앱 개발환경 구축하기</a> 글을 참조하여 만든다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap create sf-phonegap-demo -n Sf-PhoneGap-Demo -i net.saltfactory.tutorial.phonegapdemo
</code></pre></div>
<p>우리는 UI를 <a href="http://ionicframework.com">Ionic Framework</a>를 이용해서 만들것이다. PhoneGap은 <code>build</code>를 할 경우 자동으로 www 디렉토리 안에 있는 웹 자원을 각 플랫폼으로 복사하기 때문에 우리가 사용할 라이브러리를 <code>www/lib</code> 로 넣어둘 것이다. 우리는 웹 라이브러리를 <a href="http://bower.io">bower</a>를 이용해서 설치할 것이다. 컴퓨터에 <code>bower</code> 명령어가 설치되지 않았으면 <code>npm</code>을 이용해서 bower를 설치한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install -g bower
</code></pre></div>
<p><code>bower</code>를 설치하고 난 이후 bower의 컴포넌트 들의 설치 디렉토리를 <code>www/lib</code>로 지정하기 위해서 다음과 같이 <code>.bowerrc</code>를 만든다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">vi .bowerrc
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">{
  &quot;directory&quot;: &quot;www/lib&quot;
}
</code></pre></div>
<p>이제 bower를 이용하여 ionic을 설치해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">bower install driftyco/ionic-bower
</code></pre></div>
<p>bower로 설치가 끝나면 <code>www/lib</code> 안에 다음과 같이 라이브러리들이 설치된 것을 확인할 수 있다.</p>

<p><img src="http://cfile7.uf.tistory.com/image/247CDC4D53993C3032203E" alt="after install ionic using bower"></p>

<p>이제 테스트를 위해서 www/index.html 파일을 다음과 같이 수정한다.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;lib/ionic/css/ionic.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;lib/ionic/js/dist/js/ionic.bundle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script&gt;</span>
          <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;SFApp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ionic&#39;</span><span class="p">])</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;title&gt;&lt;/title&gt;</span>

    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">&quot;SFApp&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;bar bar-header bar-positive&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>a link demo<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;ion-content</span> <span class="na">class=</span><span class="s">&quot;has-header&quot;</span> <span class="na">padding=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://blog.saltfactory.net&quot;</span><span class="nt">&gt;</span>Go saltfactor&#39;s blog<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/ion-content&gt;</span>

    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>프로젝트를 만들고 ios 플랫폼을 만들어보자</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap build ios
</code></pre></div>
<p>그리고 테스트를 위해 작성한 앱을 iOS 시뮬레이터로 실행해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap run ios
</code></pre></div>
<p>실행을 해보면 아래 그림과 같이 ionic framework 안에 링크가 하나 있는 앱이 실행이 될 것이다. 이젠 링크를 클릭해보자. 어떻게 되는가?</p>

<blockquote>
<p>a 링크는 우리가 만든 앱을 사라지게 만들어버리고 a 링크가 가지고 있는 URL로 화면이 변경되어 버려 PhoneGap으로 만든 앱이 사라져 버리고 WebView에 새로운 사이트가 가득차 버리게 되는 문제가 발생한다.</p>
</blockquote>

<p><img src="http://cfile8.uf.tistory.com/image/2748EB4553993D393A709B" alt="simple page with in a link {width:320px;}">
<img src="http://cfile8.uf.tistory.com/image/252BC94553993D3B2A7414" alt="change new page after click link {width:320px;}"></p>

<p>그럼 PhoneGap 으로 하이브리드 앱을 만들때 컨텐츠 안에 a 링크가 있을 경우 어떻게 대처해야할까?</p>

<blockquote>
<p>보통 a 링크는 다른 사이트로 이동을 시키기 위해서 많이 사용하기 때문에 링크를 모바일이 가지고 있는 기본 브라우저로 새롭게 열게하면 된다.</p>
</blockquote>

<h2 id="inappbrowser-플러그인을-사용">InAppBrowser 플러그인을 사용</h2>

<p>PhoneGap에서 새로운 브라우저를 열기 위해서는 <a href="https://github.com/apache/cordova-plugin-inappbrowser">InAppBrowser</a> 플러그인이 필요하다. 다음과 같이 inappbrowser 플러그인을 설치한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap plugin add org.apache.cordova.inappbrowser
</code></pre></div>
<p>inappbrowser로 외부링크를 브라우저로 열기 위해서는 HTML 코드 안에 a 링크에 다음과 같이 target이 반드시 필요하다. 그리고 <code>target</code>은 <code>_system</code>으로 한다. 위 HTML 코드를 다음과 같이 수정하자.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;lib/ionic/css/ionic.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;lib/ionic/js/dist/js/ionic.bundle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;cordova.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script&gt;</span>
          <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;SFApp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ionic&#39;</span><span class="p">])</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;title&gt;&lt;/title&gt;</span>

    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">&quot;SFApp&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;bar bar-header bar-positive&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>a link demo<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;ion-content</span> <span class="na">class=</span><span class="s">&quot;has-header&quot;</span> <span class="na">padding=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- &lt;a href=&quot;http://blog.saltfactory.net&quot; target=&quot;_system&quot;&gt;Go saltfactor&#39;s blog&lt;/a&gt; --&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;window.open(&#39;http://blog.saltfactory.net&#39;, &#39;_system&#39;);&quot;</span><span class="nt">&gt;</span>Go saltfactor&#39;s blog<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/ion-content&gt;</span>

    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>다시 ios 플랫폼에 코드를 적용해서 실행해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap run ios
</code></pre></div>
<p>앱이 실행되면 다시 a 링크를 클릭해보자. 아래 그림과 같이 이전과는 다르게 모바일 사파리 브라우저로 열리는 것을 확인할 수 있다. 위 코드는 iOS에서 사용할 경우 <code>window.open</code> 에 <code>target</code>을 <code>_system</code>으로 사용하면 되는 예제를 보여주고 있다. 안드로이드일 경우에는 다음과 같이 <code>navigator.app.loadUrl</code>과 <code>openExtenral:true</code>를 사용해야한다.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;navigator.app.loadUrl(&#39;http://blog.saltfactory.net&#39;, {openExternal:true});&quot;</span><span class="nt">&gt;</span>Go saltfactor&#39;s blog<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<p><img src="http://cfile23.uf.tistory.com/image/23112434539943BE2D30CA" alt="open safari browser {width:320px;}">
<img src="http://cfile4.uf.tistory.com/image/245D9834539943C01F0F9C" alt="backgroud navigation ios {width:320px;}">
<img src="http://cfile5.uf.tistory.com/image/237C8C34539943C12FC75C" alt="background navigation ios {width:320px;}"></p>

<p>하지만 이 방법을 사용하기 위해서는 a 링크의 href를 분석해서 inappbrower를 사용해서 링크를 열수 있는 JavaScript 코드로 변경을 해줘야한다.</p>

<blockquote>
<p>컨텐츠를 개발자가 만들때는 문제가 되지 않지만 HTML 코드를 서버에서 Ajax와 같은 것을 이용해서 HTML코드를 가져와서 PhoneGap을 적용할 때는 a 링크 사용의 문제는 여전히 존재하게 된다.</p>
</blockquote>

<h2 id="네이티브-코드-변경---ios">네이티브 코드 변경 - iOS</h2>

<p>PhoneGap은 내부적으로 <strong>WebView</strong>를 열어서 사용하고 로컬의 웹 자원을 사용한다. 다시 말해서 <code>file://</code> 로 HTML을 불러오기 때문에</p>

<blockquote>
<p>scheme가 <strong><em>http</em></strong>나 <strong><em>https</em></strong>일 경우에는 브라우저의 새 창으로 열리게 하면 된다.</p>
</blockquote>

<p>우리는 PhoneGap 프로젝트를 iOS 플랫폼을 추가해서 만들었는데 iOS 플랫폼 디렉토리에 들어가서 <code>MainViewController.m</code> 파일을 열어보자. 그리고 scheme를 분석해서 http와 https일 경우는 모바일 브라우저로 링크를 열게 다음과 같이 코드를 추가한다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">...</span> <span class="p">(</span><span class="err">생략</span><span class="p">)</span> <span class="p">...</span>

<span class="cp">#pragma mark UIWebDelegate implementation</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">webViewDidFinishLoad</span><span class="p">:(</span><span class="bp">UIWebView</span><span class="o">*</span><span class="p">)</span><span class="n">theWebView</span>
<span class="p">{</span>
    <span class="c1">// Black base color for background matches the native apps</span>
    <span class="n">theWebView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>

    <span class="k">return</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">webViewDidFinishLoad</span><span class="p">:</span><span class="n">theWebView</span><span class="p">];</span>
<span class="p">}</span>

<span class="cm">/* Comment out the block below to over-ride */</span>

<span class="cm">/*</span>

<span class="cm">- (void) webViewDidStartLoad:(UIWebView*)theWebView</span>
<span class="cm">{</span>
<span class="cm">    return [super webViewDidStartLoad:theWebView];</span>
<span class="cm">}</span>

<span class="cm">- (void) webView:(UIWebView*)theWebView didFailLoadWithError:(NSError*)error</span>
<span class="cm">{</span>
<span class="cm">    return [super webView:theWebView didFailLoadWithError:error];</span>
<span class="cm">}</span>

<span class="cm">- (BOOL) webView:(UIWebView*)theWebView shouldStartLoadWithRequest:(NSURLRequest*)request navigationType:(UIWebViewNavigationType)navigationType</span>
<span class="cm">{</span>
<span class="cm">    return [super webView:theWebView shouldStartLoadWithRequest:request navigationType:navigationType];</span>
<span class="cm">}</span>
<span class="cm">*/</span>


<span class="o">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nl">webView</span><span class="p">:(</span><span class="bp">UIWebView</span> <span class="o">*</span><span class="p">)</span><span class="n">theWebView</span> <span class="nl">shouldStartLoadWithRequest</span><span class="p">:(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="p">)</span><span class="n">request</span> <span class="nl">navigationType</span><span class="p">:(</span><span class="n">UIWebViewNavigationType</span><span class="p">)</span><span class="n">navigationType</span>
<span class="p">{</span>
    <span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">request</span> <span class="n">URL</span><span class="p">];</span>

    <span class="c1">// Intercept the external http requests and forward to Safari.app</span>
    <span class="c1">// Otherwise forward to the PhoneGap WebView</span>
    <span class="k">if</span> <span class="p">([[</span><span class="n">url</span> <span class="n">scheme</span><span class="p">]</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;http&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="p">[[</span><span class="n">url</span> <span class="n">scheme</span><span class="p">]</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;https&quot;</span><span class="p">])</span> <span class="p">{</span>
<span class="p">[[</span><span class="bp">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">openURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
<span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span> <span class="nb">super</span> <span class="nl">webView</span><span class="p">:</span><span class="n">theWebView</span> <span class="nl">shouldStartLoadWithRequest</span><span class="p">:</span><span class="n">request</span> <span class="nl">navigationType</span><span class="p">:</span><span class="n">navigationType</span> <span class="p">];</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">@end</span>
<span class="p">...</span> <span class="p">(</span><span class="err">생략</span><span class="p">)...</span>
</code></pre></div>
<p>그리고 <strong>InAppBrowser</strong>를 더이상 사용하지 않기 위해서 플러그인을 삭제한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap plugin remove org.apache.cordova.inappbrowser
</code></pre></div>
<p>마지막으로 HTML 코드도 InAppBrowser를 더이상 사용하지 않을 것이기 때문에 최초 a 링크 html 코드로 변경한다.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://blog.saltfactory.net&quot;</span><span class="nt">&gt;</span>Go saltfactor&#39;s blog<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<p>다시 phonegap으로 ios 시뮬레이터를 실행해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap run ios
</code></pre></div>
<p>앱을 실행한 후 링크를 클릭하면 다음 그림과 같이 모바일 브라우저로 링크가 열리게 되는 것을 확인할 수 있다.이 방법은 기존의 HTML에 들어있는 a 링크를 InAppB    rowser 플러그인을 사용해서 열도록 코드를 분석해서 태그를 변경하지 않아도 되는 장점이 있다.</p>

<p><img src="http://cfile8.uf.tistory.com/image/2748EB4553993D393A709B" alt="simple page within a link {width:320px;}">
<img src="http://cfile23.uf.tistory.com/image/23112434539943BE2D30CA" alt="view safari new page from a link {width:320px;}">
<img src="http://cfile4.uf.tistory.com/image/245D9834539943C01F0F9C" alt="ios background navigator {width:320px;}"></p>

<h2 id="네이티브코드-변경---android">네이티브코드 변경 - Android</h2>

<p>위에서 우리는 iOS에서 네이티브 코드를 변경해서 <strong><em>WebView</em></strong>의 이벤트를 핸들링하여 처리하였는데 그러면 Android에서는 어떻게 할 수 있을까? 원리는 동일하다. iOS에서 WebView에서 링크를 클릭하였을 경우 <code>shouldStartLoadWithRequest</code>에서 URL을 인터셉트하여 URL scheme를 분석한 것 같이 Android에서는 <code>shouldOverrideUrlLoading</code> 안에서 URL scheme를 분석하여 처리하면 가능하다.</p>

<p>먼저 안드로이드 PhoneGap 프로젝트에서 플랫폼을 추가하자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap build android
</code></pre></div>
<p>이렇게 안드로이드 플랫폼을 추가하면 자동으로 안드로이드 프로젝트 파일이 생성이 되는데 앱이 시작할때 열리는 Activity를 열어보자. 우리는 PhoneGap 프로젝트 이름을 SfPhoneGapDemo로 만들었기 때문에 Activity의 이름이 <code>SfPhoneGapDemo.java</code>로 만들어졌을 것이다. Activity 파일을 열어서 다음과 같이 수정한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*</span>
<span class="cm">       Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cm">       or more contributor license agreements.  See the NOTICE file</span>
<span class="cm">       distributed with this work for additional information</span>
<span class="cm">       regarding copyright ownership.  The ASF licenses this file</span>
<span class="cm">       to you under the Apache License, Version 2.0 (the</span>
<span class="cm">       &quot;License&quot;); you may not use this file except in compliance</span>
<span class="cm">       with the License.  You may obtain a copy of the License at</span>

<span class="cm">         http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="cm">       Unless required by applicable law or agreed to in writing,</span>
<span class="cm">       software distributed under the License is distributed on an</span>
<span class="cm">       &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm">       KIND, either express or implied.  See the License for the</span>
<span class="cm">       specific language governing permissions and limitations</span>
<span class="cm">       under the License.</span>
<span class="cm"> */</span>

<span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">phonegapdemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.webkit.WebView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cordova.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.net.MalformedURLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URL</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SfPhoneGapDemo</span> <span class="kd">extends</span> <span class="n">CordovaActivity</span>
<span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="c1">// Set by &lt;content src=&quot;index.html&quot; /&gt; in config.xml</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>

        <span class="k">this</span><span class="o">.</span><span class="na">appView</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="nf">CordovaWebViewClient</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">appView</span><span class="o">)</span> <span class="o">{</span>
<span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldOverrideUrlLoading</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>

                <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">getScheme</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;http&quot;</span><span class="o">)</span> <span class="o">||</span> <span class="n">uri</span><span class="o">.</span><span class="na">getScheme</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;https&quot;</span><span class="o">)){</span>
                    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">);</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
                    <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">shouldOverrideUrlLoading</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

        <span class="o">});</span>


        <span class="kd">super</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">Config</span><span class="o">.</span><span class="na">getStartUrl</span><span class="o">());</span>
        <span class="c1">//super.loadUrl(&quot;file:///android_asset/www/index.html&quot;);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>이제 앱을 실행시켜보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">phonegap run android
</code></pre></div>
<p>앱을 실행시켜서 a 링크를 클릭해보자. 그러면 안드로이드 디바이스의 디폴트 브라우저로 링크가 열리는 것을 확인할 수 있다.
이렇게 네이티브 코드를 수정하여 사용하면 InAppBrowser에서 새 창을 브라우저에서 열기 위해서 여러가지 HTML 코드를 다시 프로그램으로 수정할 필요 없이 기존의 HTML 코드의 a 링크를 그대로 사용하면서 새로운 브라우저에 열 수 있게 할 수 있다.</p>

<p><img src="http://cfile9.uf.tistory.com/image/26261A3A5399749C0808A6" alt="android simple page within a link {width:320px;}">
<img src="http://cfile21.uf.tistory.com/image/210D153A5399749D2E5630" alt="android default brwoser new page {width:320px;}">
<img src="http://cfile10.uf.tistory.com/image/2407753A5399749D23F2F4" alt="android backgroud navigator {width:320px;}"></p>

<h2 id="결론">결론</h2>

<p>기존의 iOS 앱과 Android 앱을 하나의 코드로 관리하기 위해서 <a href="http://ionicframework.com">Ionic Framework</a> 를 이용하여 하이브리드 앱을 만들었다. Ionic은 <a href="https://angularjs.org/">AngularJS</a>와 <a href="http://cordova.apache.org">Cordova</a>(<a href="http://phonegap.com">PhoneGap</a>) 기반의 하이브리드 앱 개발 플랫폼인데 앱을 구현할 때 상세보기에서 서버로 부터 웹페이지코드(HTML)을 가져와서 뷰에 출력시켜주는 부분이 있었다. 그런데 상세보기 페이지 안에 사용자가 작성한 A 링크가 문제가 되는 것을 확인했다. 서버에서 HTML 코드를 받아오는 것이기 때문에 PhoneGap의 <a href="https://github.com/apache/cordova-plugin-inappbrowser">InAppBrowser</a> 플러그인을 사용해서 HTML 코드를 변경시키는 것은 복잡하고 비용이 많이 발생하는 것으로 판단되었다. 그래서 서버로부터 받아오는 HTML 의 코드는 변경하지 않고 HTML 코드 안에 A 링크가 포함되어 있을 때 , 사용자가 링크를 클릭(터치)하게 되면 새로운 모바일 브라우저로 링크가 열리게 하려고 자료를 찾고 연구하였다. 방법은 PhoneGap은 네이티브코드의 WebView를 사용하고 있는데 이 WebView는 각각 플랫폼에서 이벤트를 받아서 처리하는 부분에 URL을 인터셉트할 수 있는 것을 확인하였고, iOS에서는 <code>shouldStartLoadWithRequest</code>를 이용하고 Android에서는 `shouldOverrideUrlLoading&#39;을 사용하여 처리할 수 있는 것을 알게되었다. 이것이 하이브리드 앱의 장점이 아닌가 생각한다. 웹 자원의 코드를 변경하는 것도 가능하고 네이티브의 자원을 변경하여 사용하는 것도 가능해서 문제의 해결방법이 다양한 각도로 접근할 수 있는 것 같다. 하이브리드 앱을 개발한다면 컨텐츠 안에 들어있는 A 링크를 처리하는 문제를 반드시 겪게 될 것인데 이 포스팅에서 소개하는 내용으로 문제를 해결할 수 있기를 바래본다.</p>

<h2 id="참고">참고</h2>

<ol>
<li><a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UIWebViewDelegate_Protocol/Reference/Reference.html">https://developer.apple.com/library/ios/documentation/uikit/reference/UIWebViewDelegate_Protocol/Reference/Reference.html</a></li>
<li><a href="http://developer.android.com/reference/android/webkit/WebViewClient.html">http://developer.android.com/reference/android/webkit/WebViewClient.html</a></li>
<li><a href="http://stackoverflow.com/questions/17887348/phonegap-open-link-in-browser">http://stackoverflow.com/questions/17887348/phonegap-open-link-in-browser</a></li>
<li><a href="http://techiepulkit.blogspot.kr/2013/01/android-invoking-url-scheme-intent-from.html">http://techiepulkit.blogspot.kr/2013/01/android-invoking-url-scheme-intent-from.html</a></li>
<li><a href="http://stackoverflow.com/questions/12601491/android-phonegap-intercept-url-equivalent-of-ios-shouldstartloadwithrequest">http://stackoverflow.com/questions/12601491/android-phonegap-intercept-url-equivalent-of-ios-shouldstartloadwithrequest</a></li>
</ol>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  
  
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactorynet';
    
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <!-- <h2 class="footer-heading">saltfactory's series</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li><a href="http://saltfactory.net">www.saltfactory.net</a></li>
        <li><a href="http://blog.saltfactory.net">blog.saltfactory.net</a></li>
        <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/saltfactory">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
  c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
  c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
  c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
  C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
  c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
  c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
  c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
  c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://twitter.com/saltfactory">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
  c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
  c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
  C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
  c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
  c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://facebook.com/saltfactory">
            <span class="icon facebook">
          		<svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
		
        	</span>
        	<span class="username">salthub</span>
			</a>
        </li>

      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text"></p>
    </div>

  </div>

</footer>


	<script src="/series/assets/javascripts/jekyll-img-converter.js"></script>
    </body>
</html>
