<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>tumblr.js를 이용하여 소셜 블로그 텀블러(tumblr) API 사용하기</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="/javascript/use-tumblr-api-using-with-tumblr.js.html">
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="/assets/foaf.rdf" />

    

    
      <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-8647285-2', 'auto');
ga('send', 'pageview');
</script>

    
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">saltfactory's blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
        viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
        <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
        h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
        <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
        h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
        <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
        c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
      </svg>
    </a>
    <div class="trigger">
      <a class="page-link" href="http://saltfactory.net">saltfactory.net</a>
      
      <a class="page-link" href="/about/">About</a>
      
      
      
      <a class="page-link" href="/guestbook/">Guestbook</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </div>
  </nav>

</div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">tumblr.js를 이용하여 소셜 블로그 텀블러(tumblr) API 사용하기</h1>
    <p class="post-meta">Jun 10, 2014</p>
  </header>

  <article class="post-content">
    <h2 id="서론">서론</h2>

<p>소셜블로그의 대명사 <a href="http://tumblr.com">Tumblr</a>는 미려한 디자인과 막강한 블로깅 기능 뿐만 아니라 reblog, sharing 기능이 매우 강력해서 국외 개발자나 미디어 생산자 또는 일반 사용자들이 즐겨 사용하는 블로그이다. 현재 <a href="http://tistory.com">Tistory</a> 기반으로 블로깅을 하고 있는데 이것을 Tumblr로 이전할까 생각을 여러번 한다. 수 많은 블로그 서비스가 현재 존재하지만 티스토리 블로그를 선택한 이유는 다음과 같다.</p>

<ul>
<li><strong>안정성</strong> : 개인 서버를 사용해서 블로깅을 하면 여러가지 이유로 다운타임이 잦아지기 때문에 다운 타임 없이 운용되는 블로그 호스팅 서비스를 찾았다</li>
<li><strong>스킨의 자유성</strong> : 정해전 템플릿만 사용하는 블로그는 사용에 제한이 많다. 실제 네이버와 다음과 같은 포털 블로그는 스킨을 자유롭게 편집할 수 없기 때문에 제한된 컨텐츠 생산만 할 수 있다. 예를 들어, 외부 JavaScript나 CSS를 사용할 수 없기 때문에 정적인 블로깅만 생산해 낼 수 있다. 외부 JavaScript나 CSS를 사용할 수 있는 강점을 티스토리와 텀블러는 가지고 있다.</li>
<li><strong>API 지원</strong> : 티스토리는 meta blog와 API를 지원하고 있다.</li>
<li><strong>용량제한</strong> : 블로그 호스팅 서비스들은 대부분 파일 용량을 제한하고 있었다. 블로그에 이미지 업로드를 많이 하는 편인데 제한된 용량을 가지고 지속적인 블로깅을 하기는 쉽지 않다고 생각해서 티스토리를 선택했다</li>
</ul>

<p>티스토리를 선택한 이유는 위와 같은데 대부분을 tumblr가 만족시켜주고 있고 티스토리에서는 없는 reblog 기능 있고 텀블러는 멀티블로그 기능이 tumblr가 더 강력하다. 또한 소셜 플러그인들이 내장되어 있고 API 지원이 강력해서 써드파티 서비스를 만들어낼 수 있기 때문에 현재 tumblr로 블로그를 이전할까 여러차례 고민하고 있다. 그럼 어떻게 Tistory의 글을 Tumblr로 이전할 수 있을까 고민하게 되었는데 방법은 tumblr API를 사용해서 bulk import를 하기로 결정했다. 그래서 tumblr API를 사용하는 방법을 테스트해보기로 했다.</p>

<p>현재 우리 연구소에서 메인 언어는 Java 이지만 모바일 서비스를 연구하고 개발하는데는 Node.js를 사용하고 있기 때문에 JavaScript 기반으로 만들고 싶어서 Tumblr가 공식적으로 지원하는 <a href="https://github.com/tumblr/tumblr.js/">tumblr.js</a> 라이브러리를 사용해서 tumblr API를 사용하는 방법을 소개하려고 한다.</p>

<!--more-->

<h2 id="tumblr.js에-필요한-모듈">tumblr.js에 필요한 모듈</h2>

<p>tumblr.js를 사용하기 위해서는 다음과 같은 Node.js 모듈이 필요하다.</p>

<ul>
<li><strong><a href="http://passportjs.org/">passport</a></strong> : Node.js의 소셜 인증 모듈로 OAuth 인증을 간편하게 구현할 수 있다.</li>
<li><strong><a href="https://github.com/jaredhanson/passport-tumblr">passport-tumblr</a></strong> : passport의 인증 모듈의 tumblr 인증 미들웨어로 tumblr의 access token과 access secret 값을 받을 수 있다.</li>
<li><strong><a href="http://expressjs.com/">express</a></strong> : OAuth 인증은 서버가 필요하기 때문에 인증처리 후 redirect되는  URL을 처리하기 위한 서버로 express를 사용한다.</li>
<li><strong><a href="https://github.com/tumblr/tumblr.js/">tumblr.js</a></strong> : tumblr API 를 사용하기 위한 클라이언트 라이브러리로 tumblr에서 공식 지원하는 Node.js의 모듈이다.</li>
</ul>

<h2 id="tumblr-앱-등록">Tumblr 앱 등록</h2>

<p>이 포스팅은 Node.js 기반으로 각자 컴퓨터에 Node.js가 설치 되어 있다고 가정하고 진행한다.
첫번째 tumblr API를 사용하기 위해서는 <strong>tumblr 개발자 사이트</strong>에 들어가서 앱을 하나 등록해야한다. <a href="https://www.tumblr.com/oauth/register">https://www.tumblr.com/oauth/register</a></p>

<p>필요한 항목을 입력한다. 반드시 입력해야하는 값은 다음과 같다.</p>

<ul>
<li><strong>Application Name</strong> : TumblrAPIDemo</li>
<li><strong>Administrative contact email</strong> : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li><strong>Default callback URL</strong> : <a href="http://127.0.0.1:3000/auth/tumblr/callback">http://127.0.0.1:3000/auth/tumblr/callback</a></li>
</ul>

<p><img src="http://cfile5.uf.tistory.com/image/2517BF4F5396961336C546" alt="register application"></p>

<p>앱 등록이 모두 마치면 다음과 같이 <strong>OAuth consumer key</strong>와 <strong>OAuth consumer secret</strong>을 획득할 수 있다. 데모로 등록한 앱은 포스팅을 마치면 삭제할 것이기 때문에 여러분이 생성한 앱의 consumer key와 consumer secret을 사용하면 된다.</p>

<p><img src="http://cfile4.uf.tistory.com/image/222032335396AE53329892" alt="registered application"></p>

<h2 id="package.json">package.json</h2>

<p>이제 생성된 consumer key와 consumer secret을 사용해서 auth token와 auth secret을 획득하기 위해서 Node.js를 이용해서 프로그램을 작성할 것이다. 먼저 필요한 Node.js의 모듈을 설치하자. 필요한 Node.js의 모듈을 한번에 설치할 수 있는 package.json의 내용은 다음과 같다.</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;tumblrAPIDemo&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;private&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;node ./bin/www&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;express&quot;</span><span class="p">:</span> <span class="s2">&quot;~4.2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;static-favicon&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;morgan&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cookie-parser&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;body-parser&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;debug&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.7.4&quot;</span><span class="p">,</span>
    <span class="nt">&quot;jade&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.3.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;passport&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;passport-tumblr&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.1.2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;express-session&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.2.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;tumblr.js&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.0.4&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>우리는 Node.js 개발을 위해서 WinStorm을 사용하고 있지만 특별히 IDE를 사용해야할 필요는 없다. 다만, 개발 생산성을 높이기 위해서 우리는 WinStorm을 사용해서 Node.js 프로젝트를 생성해서 연구를 진행하고 있다. 만약에 WinStorm을 사용하지 않을 경우는 디렉토리를 생성해서 package.json을 이용해서 Node.js 모듈을 설치하고 진행하면 된다.</p>

<p>이 포스팅에서는 WinStorm이 없다고 가정하고 함께 진행하도록 하겠다. 우선 프로젝트 디렉토리를 다음과 같이 생성한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">mkdir tumblrAPIDemo
</code></pre></div>
<p>디렉토리 안으로 이동후 위 package.json을 입력해서 파일을 저장한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">vi package.json
</code></pre></div>
<p>다음은 npm으로 package.json에 명시된 Node.js 모듈을 설치한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install
</code></pre></div>
<h2 id="express-서버-구현">express 서버 구현</h2>

<p>설치가 모두 마쳤다면 express 서버를 생성하기 위해서 <code>app.js</code> 파일을 생성하고 다음 내용을 저장한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : app.js</span>
<span class="kd">var</span> <span class="nx">debug</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)(</span><span class="s1">&#39;tumblrApiDemo&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">favicon</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;static-favicon&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;morgan&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-session&#39;</span><span class="p">);</span>


<span class="kd">var</span> <span class="nx">passport</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">TumblrStrategy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport-tumblr&#39;</span><span class="p">).</span><span class="nx">Strategy</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">TUMBLR_CONSUMER_KEY</span> <span class="o">=</span> <span class="s2">&quot;앱 생성 후 획득한 consumer key&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">TUMBLR_SECRET_KEY</span> <span class="o">=</span> <span class="s2">&quot;앱 생성 후 획득한 secret key&quot;</span><span class="p">;</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">serializeUser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">deserializeUser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
<span class="p">});</span>


<span class="nx">passport</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">new</span> <span class="nx">TumblrStrategy</span><span class="p">({</span>
      <span class="nx">consumerKey</span><span class="o">:</span> <span class="nx">TUMBLR_CONSUMER_KEY</span><span class="p">,</span>
      <span class="nx">consumerSecret</span><span class="o">:</span> <span class="nx">TUMBLR_SECRET_KEY</span><span class="p">,</span>
      <span class="nx">callbackURL</span><span class="o">:</span> <span class="s2">&quot;http://127.0.0.1:3000/auth/tumblr/callback&quot;</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">tokenSecret</span><span class="p">,</span> <span class="nx">profile</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;token:&quot;</span> <span class="o">+</span> <span class="nx">token</span><span class="p">);</span> <span class="c1">// 인증 이후 auth token을 출력할 것이다.</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;token secret:&quot;</span> <span class="o">+</span> <span class="nx">tokenSecret</span><span class="p">);</span> <span class="c1">// 인증 이후 auto token secret을 출력할 것이다.</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">profile</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
<span class="p">));</span>



<span class="c1">// view engine setup</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;views&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;jade&#39;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">favicon</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span> <span class="nx">secret</span><span class="o">:</span> <span class="s1">&#39;keyboard cat&#39;</span> <span class="p">}))</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">initialize</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">session</span><span class="p">())</span>

<span class="c1">// development error handler</span>
<span class="c1">// will print stacktrace</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;development&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="mi">500</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">message</span><span class="o">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">err</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/account&#39;</span><span class="p">,</span> <span class="nx">ensureAuthenticated</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="p">});</span>
<span class="p">});</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/auth/tumblr&#39;</span><span class="p">,</span>
    <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s1">&#39;tumblr&#39;</span><span class="p">),</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
      <span class="c1">// The request will be redirected to Tumblr for authentication, so this</span>
      <span class="c1">// function will not be called.</span>
    <span class="p">});</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/auth/tumblr/callback&#39;</span><span class="p">,</span>
    <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s1">&#39;tumblr&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">failureRedirect</span><span class="o">:</span> <span class="s1">&#39;/login&#39;</span> <span class="p">}),</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">logout</span><span class="p">();</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">ensureAuthenticated</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">())</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">next</span><span class="p">();</span> <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<span class="p">}</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;Express server listening on port &#39;</span> <span class="o">+</span> <span class="nx">server</span><span class="p">.</span><span class="nx">address</span><span class="p">().</span><span class="nx">port</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>다음은 express 서버의 뷰를 만들어 줘야하는데 WinStorm에서 Node.js로 express 프로젝트를 생성하면 기본적으로 Jade 뷰 템플릿을 사용하기 때문에 <a href="http://jade-lang.com/">Jade</a>를 사용했다. 프로젝틀 디렉토리 밑에 views 디렉토리를 만든다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">mkdir views
</code></pre></div>
<p>필요한 뷰 파일은 <code>layout.jade</code>, <code>index.jade</code>, <code>login.jade</code>, <code>account.jade</code> 이고 각각 뷰 파일은 다음과 같다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename: layout.jade</span>

<span class="nx">doctype</span> <span class="nx">html</span>
<span class="nx">html</span>
  <span class="nx">head</span>
    <span class="nx">title</span> <span class="nx">TumblrAPIDemo</span>
    <span class="nx">link</span><span class="p">(</span><span class="nx">rel</span><span class="o">=</span><span class="s1">&#39;stylesheet&#39;</span><span class="p">,</span> <span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/stylesheets/style.css&#39;</span><span class="p">)</span>
  <span class="nx">body</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">user</span>
      <span class="nx">p</span>
        <span class="nx">a</span><span class="p">(</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="nx">Home</span>
        <span class="o">|</span> <span class="o">|</span>
        <span class="nx">a</span><span class="p">(</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span> <span class="nx">Log</span> <span class="k">in</span>
    <span class="k">else</span>
      <span class="nx">p</span>
        <span class="nx">a</span><span class="p">(</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="nx">Home</span>
        <span class="o">|</span> <span class="o">|</span>
        <span class="nx">a</span><span class="p">(</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/account&#39;</span><span class="p">)</span> <span class="nx">Account</span>
        <span class="o">|</span> <span class="o">|</span>
        <span class="nx">a</span><span class="p">(</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/logout&#39;</span><span class="p">)</span> <span class="nx">Logout</span>


    <span class="nx">block</span> <span class="nx">content</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : index.jade</span>

<span class="kr">extends</span> <span class="nx">layout</span>

<span class="nx">block</span> <span class="nx">content</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span>
        <span class="nx">h2</span> <span class="nx">Welcome</span><span class="o">!</span> <span class="nx">Please</span> <span class="nx">Login</span><span class="p">.</span>
    <span class="k">else</span>
        <span class="nx">h2</span> <span class="nx">Hello</span> <span class="err">#</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : login.jade</span>

<span class="kr">extends</span> <span class="nx">layout</span>
<span class="nx">block</span> <span class="nx">content</span>
    <span class="nx">a</span><span class="p">(</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;/auth/tumblr&#39;</span><span class="p">)</span> <span class="nx">Login</span> <span class="kd">with</span> <span class="nx">Tumblr</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : account.jade</span>

<span class="kr">extends</span> <span class="nx">layout</span>
<span class="nx">block</span> <span class="nx">content</span>
    <span class="nx">p</span> <span class="nx">Username</span><span class="o">:</span> <span class="err">#</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span>
</code></pre></div>
<p>마지막으로 <code>public/stylesheets/style.css</code> 파일을 추가해서 스타일을 적용하자.</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/*filename : style.css*/</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
  <span class="k">font</span><span class="o">:</span> <span class="m">14px</span> <span class="s2">&quot;Lucida Grande&quot;</span><span class="o">,</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">a</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="m">#00B7FF</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="tumblr-api-인증">tumblr API 인증</h2>

<p>인증에 필요한 파일은 모두 추가가 완료되었다. 이제 express를 실행해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">node app.js
</code></pre></div>
<p>express 서버가 동작할 것이고 브라우저를 열어서 <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a> 으로 접근해보자.</p>

<p><img src="http://cfile5.uf.tistory.com/image/24356E4053969E8A0E55CF" alt="start express"></p>

<p>express가 정상적으로 동작하는 것을 확인할 수 있다. Login을 눌러서 tumblr로 로그인을 한다. Login with Tumblr를 클릭하면 tumblr의 앱이 엑세스를 허락을 요구하는 화면이 나타난다 Allow를 선택해서 access 를 허용한다.</p>

<p><img src="http://cfile6.uf.tistory.com/image/251D303553969EE4351F40" alt="login {width:320px;}">
<img src="http://cfile26.uf.tistory.com/image/2631ED3553969EE5080D6E" alt="tumblr permission {width:320px;}"></p>

<p>앱의 엑세스를 허용한 이후 tumblr는 우리가 명시한 redirect URL로 다시 보내게 되는데 이때 우리가 생성한 앱(tubmlrAPIDemo)이 tumblr의 프로필을 가지고 와서 메인 블로그의 이름을 화면에 나타나게 한다. 그리고 세션이 유지되어   logout 메뉴가 보이는 것을 확인할 수 있다.
<img src="http://cfile1.uf.tistory.com/image/265DFF4553969FAB103B0D" alt="redirect"></p>

<h2 id="access-token-획득">Access Token 획득</h2>

<p>우리는 웹에서 인증을 완료했지만 우리가 원하는 것은 Node.js 로 tumblr.js 모듈을 사용해서 클라이언트에서 tumblr에 접근을 하고 싶어한다. 그래서 우리는 app.js에서 console.log(token)과 console.log(tokenSecret)을 출력하여 auth token key과 auth token secret key를 사용하여야 한다. express를 실행시킨 터미널로 가보자.</p>

<p><img src="http://cfile28.uf.tistory.com/image/2621E7505396AE090D699C" alt="get access token"></p>

<p>터미널에서는 우리가 passport-tumblr 모듈에서 인증처리 후 받은 token과 token secret을 출력시켰기 때문에 그 값이 console.log로 출력된 것을 확인할 수 있다.</p>

<p>이젠 우리는 tumblr API를 사용할 수 있는 인증처리를 모두 마쳤다.</p>

<h2 id="tumblr-api-사용">Tumblr API 사용</h2>

<p>tumblr.js를 이용하여 Node.js로 tumblr 데이터를 가져오는 코드를 작성해보자. 파일을 <code>bin/tumblrClient.js</code>로 생성하여 다음 코드를 저장한다. client를 만들기 위해서는 우리가 앱을 등록해서 획득한 consumer key, consumer secret과 그리고 우리가 인증후 획득한 token과 token secret이 필요하다.</p>

<h3 id="userinfo-api">userInfo API</h3>

<p>아래 예제 코드는 tumblr.js에서 제공하는 블로그의 정보를 가져오는 userInfo 중에서 블로그의 이름을 출력하는 코드이다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : tumblrClient.js</span>

<span class="kd">var</span> <span class="nx">tumblr</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;tumblr.js&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">tumblr</span><span class="p">.</span><span class="nx">createClient</span><span class="p">({</span>
  <span class="nx">consumer_key</span><span class="o">:</span> <span class="s1">&#39;SJqHooTujuLcRmxgYHZ3i...&#39;</span><span class="p">,</span>
  <span class="nx">consumer_secret</span><span class="o">:</span> <span class="s1">&#39;vWWvcPaILyzq8VdKuN...&#39;</span><span class="p">,</span>
  <span class="nx">token</span><span class="o">:</span> <span class="s1">&#39;tRQBv0uX3yxGu9dbhBiE1u...&#39;</span><span class="p">,</span>
  <span class="nx">token_secret</span><span class="o">:</span> <span class="s1">&#39;YBUVhmQj7Xxolpx...&#39;</span>
<span class="p">});</span>


<span class="nx">client</span><span class="p">.</span><span class="nx">userInfo</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">blogs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blog</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>우리가 만든 텀블러클라이언트를 실행해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">node bin/tumblrClient.js
</code></pre></div>
<p>tumblr는 개인이 여러개의 블로그를 가질 수 있는데 지금 <a href="http://saltfactorythings.tumblr.com%EC%9D%B4%EB%9D%BC%EB%8A%94">http://saltfactorythings.tumblr.com이라는</a> 블로그 하나만 가지고 있기 때문에 위의 코드를 실행하면 가지고 있는 블로그이 이름 saltfactorythings를 출력하게 된다.</p>

<p><img src="http://cfile22.uf.tistory.com/image/255DED375396A39D0CE7F9" alt="run tumblr client {width:320px;}"></p>

<p><img src="http://cfile30.uf.tistory.com/image/230FA44F5396A3F111D68D" alt="show tumblr {width:320px;}"></p>

<h3 id="bloginfo-api">blogInfo API</h3>

<p>블로그의 정보를 가져오는 코드를 추가해보자. tumblr.js에서 블로그의 정보를 가져오기 위해서는 blogname을 가지고 blogInfo 메소드를 사용한다. 현재 블로그의 글은 1건이 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : tumblrClient.js</span>

<span class="p">...</span> <span class="p">(</span><span class="err">생략</span><span class="p">)</span> <span class="p">...</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">userInfo</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">blogs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blog</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

    <span class="nx">client</span><span class="p">.</span><span class="nx">blogInfo</span><span class="p">(</span><span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">});</span>

  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><img src="http://cfile30.uf.tistory.com/image/230FA44F5396A3F111D68D" alt="blog {width:320px;}"></p>

<p><img src="http://cfile25.uf.tistory.com/image/247C483E5396A55912CC5E" alt="run blogInfo"></p>

<p>결과는 현재의 블로그에 있는 정보를 가져와서 블로그에 글이 1건 있는 것을 보여준다. 그리고 마지막 업데이트 날짜도 보여주고 여러가지 블로그에 관련된 정보를 가져올 수 있다.</p>

<h3 id="posts-api">posts API</h3>

<p>다음은 블로그의 posts를 가져오는 코드를 추가해보자. tumblr.js에서는 posts라는 함수를 이용해서 블로그의 posts 정보를 가져올 수 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : tumblrClient.js</span>

<span class="p">...</span> <span class="p">(</span><span class="err">생략</span><span class="p">)</span> <span class="p">...</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">userInfo</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">blogs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blog</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

    <span class="nx">client</span><span class="p">.</span><span class="nx">blogInfo</span><span class="p">(</span><span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">client</span><span class="p">.</span><span class="nx">posts</span><span class="p">(</span><span class="nx">blog</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">});</span>


  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><img src="http://cfile7.uf.tistory.com/image/27791A4B5396A65D07A31D" alt="get posts {width:320px;}"></p>

<h3 id="글쓰기-api">글쓰기 API</h3>

<p>다음은 블로그에 글을 포스팅해보자. 대표 블로그의 이름은 &#39;saltfactorythings&#39;이다. 이 곳에 text 블로그를 포스팅할 것이다. tumblr는 포스팅하는 미디어 타입들이 있다. text, photo, vedio, chat, link 등이 있는데 예제로 text를 포스팅 할 것이다. 이때 옵션으로 title과 body를 입력하는데 title은 컨텐츠의 제목이 되고 body는 HTML 코드를 포함하는 컨텐츠 내용이 된다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : tumblrClient.js</span>

<span class="p">...</span> <span class="p">(</span><span class="err">생략</span><span class="p">)</span> <span class="p">...</span>


<span class="c1">// client.userInfo(function (err, data) {</span>
<span class="c1">//   data.user.blogs.forEach(function (blog) {</span>
<span class="c1">//     console.log(blog.name);</span>
<span class="c1">//</span>
<span class="c1">//     client.blogInfo(blog.name, function(err, res){</span>
<span class="c1">//      console.log(res);</span>
<span class="c1">//     });</span>
<span class="c1">//</span>
<span class="c1">//     client.posts(blog.name, function(err, res){</span>
<span class="c1">//       console.log(res);</span>
<span class="c1">//     });</span>
<span class="c1">//</span>
<span class="c1">//   });</span>
<span class="c1">// });</span>

<span class="kd">var</span> <span class="nx">blogName</span> <span class="o">=</span> <span class="s1">&#39;saltfactorythings&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;tumblr API Demo&#39;</span><span class="p">,</span>
  <span class="nx">body</span><span class="o">:</span> <span class="s1">&#39;&lt;h2 style=&quot;color:red;&quot;&gt;Node.js를 이용하여 tumblr API 사용하기&lt;/h2&gt;&#39;</span>
<span class="p">};</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><img src="http://cfile1.uf.tistory.com/image/23308C475396A87114B4F4" alt="run write {width:320px;}"></p>

<p><img src="http://cfile3.uf.tistory.com/image/261C20475396A87217F6B8" alt="writed {width:320px;}"></p>

<p>실행하면 tumblr에 포스팅이 진행되고 완료가 되면 포스트의 ID 값을 리턴 받게 된다. 그리고 웹 사이트에서 확인을 해보면 우리가 작성한 내용이 포스팅 된 것을 확인할 수 있다.</p>

<h3 id="삭제-api">삭제 API</h3>

<p>삭제도 가능하다. 삭제는 deletePost라는 함수에 우리가 포스팅한 후 획득한 ID 값을 가지고 blogName에 해당하는 글을 삭제할 수 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// filename : tumblrClient.js</span>

<span class="p">...</span> <span class="p">(</span><span class="err">생략</span><span class="p">)</span> <span class="p">...</span>


<span class="kd">var</span> <span class="nx">blogName</span> <span class="o">=</span> <span class="s1">&#39;saltfactorythings&#39;</span><span class="p">;</span>
<span class="c1">// var options = {</span>
<span class="c1">//   title: &#39;tumblr API Demo&#39;,</span>
<span class="c1">//   body: &#39;&lt;h2 style=&quot;color:red;&quot;&gt;Node.js를 이용하여 tumblr API 사용하기&lt;/h2&gt;&#39;</span>
<span class="c1">// };</span>
<span class="c1">//</span>
<span class="c1">// client.text(blogName, options, function(err, res){</span>
<span class="c1">//   console.log(res);</span>
<span class="c1">// });</span>
<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="mi">88353862009</span><span class="p">;</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">deletePost</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><img src="http://cfile2.uf.tistory.com/image/2573FC3D5396A96D29CF67" alt="run delete {width:320px}"></p>

<p><img src="http://cfile21.uf.tistory.com/image/226F353D5396A96E0809C8" alt="blog {width:320px;}"></p>

<p>글 삭제가 성공적으로 마치게되면 삭제한 포스트의 ID 값을 다시 반환한다. 그리고 삭제가 완료된 이후 tumblr 블로그에 가보면 해당되는 글이 삭제된 것을 확인할 수 있다. tubmlr.js에서 tumblr API를 사용할 수 만들어둔 메소드는 다음과 같다. 많은 기능이 제공되고 있는데 인증이 완료된 이후 client를 만들어서 위에서 테스트한 것과 같이 사용하면 쉽게 tumblr API를 사용할 수 있다.</p>

<h2 id="user-method">User Method</h2>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Get information about the authenticating user &amp; their blogs</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">userInfo</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get dashboard for authenticating user</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">dashboard</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">dashboard</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get likes for authenticating user</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">likes</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">likes</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get followings for authenticating user</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">following</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">following</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Follow or unfollow a given blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">follow</span><span class="p">(</span><span class="nx">blogURL</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">unfollow</span><span class="p">(</span><span class="nx">blogURL</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Like or unlike a given post</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">like</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">reblogKey</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">unlike</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">reblogKey</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</code></pre></div>
<h2 id="blog-methods">Blog Methods</h2>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Get information about a given blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">blogInfo</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get a list of posts for a blog (with optional filtering)</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">posts</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">posts</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get the avatar URL for a blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">avatar</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">avatar</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get the likes for a blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">blogLikes</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">blogLikes</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get the followers for a blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">followers</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">followers</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get the queue for a blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get the drafts for a blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">drafts</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">drafts</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Get the submissions for a blog</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">submissions</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">submissions</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</code></pre></div>
<h2 id="post-methods">Post Methods</h2>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Edit a given post</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">edit</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Reblog a given post</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">reblog</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Delete a given psot</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">deletePost</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="c1">// Convenience methods for creating post types</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">photo</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">quote</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">link</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">audio</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">video</span><span class="p">(</span><span class="nx">blogName</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</code></pre></div>
<h2 id="tag-methods">Tag Methods</h2>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// View posts tagged with a certain tag</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">tagged</span><span class="p">(</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">tagged</span><span class="p">(</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</code></pre></div>
<h2 id="결론">결론</h2>

<p>국내 서비스는 API 제공을 그렇게 많이 지원하고 있지 않다. 하지만 국외 서비스에서는 API를 아주 많은 일을 가능하게 할 수 있게 대부분의 기능을 API로 제공하고 있다. tumblr는 아주 유명한 소셜 블로그 서비스이다. tumblr는 여러가지 강력한 블로그 기능 뿐만 아니라 API를 제공하고 있기 때문에 다양한 서비스를 만들어 낼 수 있는 강점을 가지고 있다. 특히 tumblr는 Node.js에서 사용할 수 있는 tumblr.js를 공식적으로 지원하고 있고, 이미 대부분의 API를 사용할 수 있는 메소드를 공개했다. Node.js의 모듈 중에 passort는 현재 존재하는 소셜 서비스의 대부분의 OAuth 인증을 쉽게 처리할 수 있는 모듈이다. OAuth는 웹 인증을하기 때문에 express를 이용해서 웹 서비스를 만들어 passort 모듈을 사용하여 인증을 하면 tumblr의 인증을 쉽게 처리할 수 있다. 이 때 passort-tumblr 미들웨어를 사용하면 효율적으로 서비스를 만들 수 있다.</p>

<h2 id="참고">참고</h2>

<ol>
<li><a href="https://www.tumblr.com/docs/en/api/v2">https://www.tumblr.com/docs/en/api/v2</a></li>
<li><a href="https://github.com/jaredhanson/passport-tumblr">https://github.com/jaredhanson/passport-tumblr</a></li>
<li><a href="http://passportjs.org/guide/">http://passportjs.org/guide/</a></li>
<li><a href="https://github.com/tumblr/tumblr.js">https://github.com/tumblr/tumblr.js</a></li>
</ol>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactoryblog';
    
    // 
    
     var disqus_identifier = 'http://blog.saltfactory.net/241'; 
    


    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  



</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">saltfactory's blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <!-- <li>saltfactory's blog</li> -->
          <li><img class="profile" src="/assets/images/profile.png"/></li>
          <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/saltfactory">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/saltfactory">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">@saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://facebook.com/salthub">
              <span class="icon icon--facebook">
                <!-- <svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
 -->
                <svg viewBox="0 0 16 28">
                  <path id="logo" d="M14.984 0.187v4.125h-2.453q-1.344 0-1.813 0.562t-0.469 1.687v2.953h4.578l-0.609 4.625h-3.969v11.859h-4.781v-11.859h-3.984v-4.625h3.984v-3.406q0-2.906 1.625-4.508t4.328-1.602q2.297 0 3.563 0.187z"></path>
                </svg>
              </span>
              <span class="username">salthub</span>
            </a>
          </li>

        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
