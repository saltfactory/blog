<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Rhino에서 64K 넘는 대용량 JavaScript 로드할 때 발생하는 문제와 Java method size limit</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="">
    <link rel="canonical" href="/series/javascript/java-method-size-limit-in-rhino.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/series/assets/css/main.css">
    <!-- <link rel='stylesheet' type='text/css' href='/assets/css/main.css' /> -->

    
</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/series/">saltfactory's series</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="/">saltfactory.net</a>
        <a class="page-link" href="/guestbook">Guestbook</a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Rhino에서 64K 넘는 대용량 JavaScript 로드할 때 발생하는 문제와 Java method size limit</h1>
    <p class="meta">Sep 26, 2012</p>
  </header>

  <article class="post-content">
  <h2 id="서론">서론</h2>

<p>Rhino에 대해서는 이전 포스팅을 읽어보면 Java기반의 Javascript Runtime 환경을 제공해 주기 때문에 브라우저 없이 Javascript 코드를 개발할 수 있다는 것을 알수 있다. Rhino는 생각보다 편리한 기능을 많이 포함하고 있고 Javascript 라이브러리를 개발하는데 매우 유용하다. 하지만 이런 Rhino에게 현재 버전에 치명적인 단점이 있다. 지금 Rhino1.7R4 버전에서 64K 이상크기의 Javascript를 로드하지 못하는 문제가 있다.</p>

<!--more-->

<p>현재 Envjs에서 배포하고 있는 env.rhino.1.2.js 파일은 64K 이상이다. Rhino1.7R4 버전에서 envjs를 로드하면 로드해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">java -jar js.jar
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">js&gt; load (&quot;env.rhino.1.2.js&quot;);
</code></pre></div>
<p><img src="http://cfile25.uf.tistory.com/image/175D37385062F1521B891F" alt=""></p>

<h2 id="java-method-size-limit">Java method size limit</h2>

<p>Rhino 1.7 R4에서는 <code>env.rhino.1.2.js</code>를 용량제한으로 로드를 하지 못한다는 에러가 나온다. 이게 무슨 말인가... 정말 황당한 문제 때문에 이유를 찾기 시작했다. 그중에서 다음 자료를 찾을 수가 있었다.</p>

<p><a href="http://www.coachwei.com/2008/09/01/the-64kb-java-language-problem-lesso-learnd-from-using-rhino-to-process-javascript/">http://www.coachwei.com/2008/09/01/the-64kb-java-language-problem-lesso-learnd-from-using-rhino-to-process-javascript/</a></p>

<p>글을 보면 Rhino가 Java 의 non-native, non-abstract 메소드의 제한인 <strong>65536</strong>에 최적화 하기 위해서 Rhino가 로드하는 javascript의 코드길이가 이 이상이 넘지 않게 구현되어 있다는 것이다. 이건 Rhino의 문제인지 Java의 문제인지 몰라서 자료를 좀 더 찾아보기로 했다.</p>

<ol>
<li><strong>maximum method size is too small (64k)</strong> : <a href="http://bugs.sun.com/view_bug.do?bug_id=4262078">http://bugs.sun.com/view_bug.do?bug_id=4262078</a></li>
<li><strong>method size limit in Java</strong> : <a href="http://eblog.chrononsystems.com/method-size-limit-in-java">http://eblog.chrononsystems.com/method-size-limit-in-java</a></li>
<li><strong>Java Tip #5 - Avoid 64KB method limit on JSP</strong> : <a href="http://futuretask.blogspot.kr/2005/01/java-tip-5-avoid-64kb-method-limit-on.html">http://futuretask.blogspot.kr/2005/01/java-tip-5-avoid-64kb-method-limit-on.html</a></li>
<li><strong>Workarounds for the 64K Size Limit for the Generated Java Method</strong> : <a href="http://docs.oracle.com/cd/A97688_16/generic.903/bp/j2ee.htm#1009526">http://docs.oracle.com/cd/A97688_16/generic.903/bp/j2ee.htm#1009526</a></li>
</ol>

<p>위 자료들을 보면 Java, JSP 등에서 code generation에 대한 Java method 의 Limit에 대해서 글들을 볼 수 있다. Java method에 대한 크기 제한이 있는것은 처음 알게 된 사실이다. Java 메소드를 그렇게 크게 만들어 본 적이 없기도 했을 뿐드러 Rhino에서 Javascript 파일을 로드하는데 그 소스코드가 문자열로 메소드안에서 code generation이 되는지는 생각도 하지 못했기 때문이다.</p>

<p>env.rhino.1.2.js 파일을 살펴보자. env.rhino.1.2.js는 64k가 넘는다는 것을 확인 할 수 있다.</p>

<p><img src="http://cfile23.uf.tistory.com/image/1864CF3D5063BB4317A472" alt=""></p>

<p>그래서 github.com/hns 에서 rhino를 fork 해서 코드를 수정했다. <a href="https://github.com/hns/rhino/commit/207bb86e63b452237fbf6004fee12b90980c67f3">https://github.com/hns/rhino/commit/207bb86e63b452237fbf6004fee12b90980c67f3</a> 커밋된 내용을 참조하거나 이 커밋의 rhino를 다운 받는다. 그리고 압축을 해지한 다음 ant를 이용해서 jar를 생성하기 위해서를 build를 한다. 그리고 en.rhino.1.2.js를 다시 로드한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cd hns-rhino-207bb86/
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">ant jar
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">cd hns-rhino-207bb86/build/rhino1_75pre/
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">java -jar js.jar
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">js &gt; load (&quot;env.rhino.1.2.js&quot;);
</code></pre></div>
<p>이젠 정상적으로 envjs 가 rhino에서 로드되어서 envjs를 사용할 수 있게 되었다.</p>

<h2 id="결론">결론</h2>

<p>rhino에서는 Java의 최적화를 위해서 미리 대용량 파일을 로드하지 못하게 한듯하다. 이렇게 수정된 코드가 과연 Java의 method limit에 문제가 되지 않고 이상없이 사용 할 수 있는지에 대한 테스트는 더 필요할 것 같다. 이번 rhino와 대용량 javascript 로드를 통해서 Java의 method limit에 대한 것을 알게 된 것 같다. 실제 Java에서 XML을 파싱하기 위해서 대용량 XML을 로드하면서 비슷한 경험을 했다는 사례들도 찾을 수 있었다. Java의 이러한 제한이 있다면 rhino에서 대용량 자바스크립트를 로드하는게 가능하지 않게 때문에 여러개의 Javascript 파일을 나누어서 로드를 해야할 것이다. 아니면 rhino에 로드하기 위해서 javascript compressor를 이용해야 할지도 모른다. github.com/hns에 수정한 코드로 로드를 할 수는 있지만 현재 발생하는 이 문제에 대한 근본적인 해결 방법이 필요할 것으로 예상이 된다. 이 문제 대한 해결방법이나 Java method limit에 대한 다른 의견이 있으면 언제든지 조언을 부탁드리고 싶다.</p>

<h2 id="참고">참고</h2>

<ol>
<li><a href="http://bugs.sun.com/view_bug.do?bug_id=4262078">http://bugs.sun.com/view_bug.do?bug_id=4262078</a></li>
<li><a href="http://eblog.chrononsystems.com/method-size-limit-in-java">http://eblog.chrononsystems.com/method-size-limit-in-java</a></li>
<li><a href="http://futuretask.blogspot.kr/2005/01/java-tip-5-avoid-64kb-method-limit-on.html">http://futuretask.blogspot.kr/2005/01/java-tip-5-avoid-64kb-method-limit-on.html</a></li>
<li><a href="http://docs.oracle.com/cd/A97688_16/generic.903/bp/j2ee.htm#1009526">http://docs.oracle.com/cd/A97688_16/generic.903/bp/j2ee.htm#1009526</a></li>
</ol>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  
  
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactorynet';
    
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <!-- <h2 class="footer-heading">saltfactory's series</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li><a href="http://saltfactory.net">www.saltfactory.net</a></li>
        <li><a href="http://blog.saltfactory.net">blog.saltfactory.net</a></li>
        <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/saltfactory">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
  c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
  c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
  c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
  C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
  c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
  c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
  c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
  c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://twitter.com/saltfactory">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
  c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
  c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
  C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
  c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
  c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://facebook.com/saltfactory">
            <span class="icon facebook">
          		<svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
		
        	</span>
        	<span class="username">salthub</span>
			</a>
        </li>

      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text"></p>
    </div>

  </div>

</footer>


	<script src="/series/assets/javascripts/jekyll-img-converter.js"></script>
    </body>
</html>
