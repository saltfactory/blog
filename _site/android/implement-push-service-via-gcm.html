<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>최신 Android Studio, GCM(Google Cloud Messaging), Node.js를 이용하여 Android 푸시 서비스 구현하기</title>
    <meta name="description" content="">

    <meta content="saltfactory's blog" property="og:site_name">
    
    <meta content="최신 Android Studio, GCM(Google Cloud Messaging), Node.js를 이용하여 Android 푸시 서비스 구현하기" property="og:title">
    
    
    <meta content="article" property="og:type">
    
    <!-- 서론

블로그에서 가장 많이 검색되는 글이 Node.js와 Google Play Service를 이용하여 안드로이드 푸시서비스 구현하기(GCM) 이다. 이 글은 2014년 1월에 작성한 글로 그동안 Google Cloud Messaging 서비스는 진화를 하여 더욱 편리하고 다르게 개발이 되고 있다. 오늘은 새롭게 바뀐 GCM 서비스를 개발하는 방법을 소개한다.

Android는 eclipse에서 Android Studio로 IDE를 바꾸었고, Ant 기반 빌드 방식을 Gradle로 변경하였다. 이에 따라 기존의 문서들을 참조해서 개발할때 혼란스러운 부분들이 있고 아직 이것을 반영한 자료들이 그렇게 많지 않기 때문에 이 글을 통해서 안드로이드 GCM 서비스를 개발하는데 도움이 되길 바란다.
 -->


    
    
    <meta content="http://blog.saltfactory.net/android/implement-push-service-via-gcm.html" property="og:url">
    
    
    <meta content="2015-06-09T00:00:00+09:00" property="article:published_time">
    <meta content="http://blog.saltfactory.net/about/" property="article:author">
    
    <!-- 
    <meta content="/img/logo-high-resolution.png" property="og:image">
     -->
    
    
    <meta content="android" property="article:section">
    
    
    
    
    <meta content="android" property="article:tag">
    
    <meta content="gcm" property="article:tag">
    
    <meta content="java" property="article:tag">
    
    <meta content="push" property="article:tag">
    
    <meta content="notification" property="article:tag">
    
    



    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://blog.saltfactory.net/android/implement-push-service-via-gcm.html">
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="/assets/foaf.rdf" />

    

    
      <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-8647285-2', 'auto');
ga('send', 'pageview');
</script>

    
</head>


  <body>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">saltfactory's blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
        viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
        <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
        h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
        <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
        h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
        <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
        c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
      </svg>
    </a>
    <div class="trigger">
      <!-- <a class="page-link" href="http://saltfactory.net">saltfactory.net</a> -->
      <!--
      
      <a class="page-link" href="/about/">About</a>
      
      
      
      
      
      
      
      <a class="page-link" href="/categories/">Categories</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a class="page-link" href="/guestbook/">GuestBook</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a class="page-link" href="/categories/ruby/">Articles by category: ruby</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      -->


      <a class="page-link" href="/about/">About</a>
      <a class="page-link" href="/categories/">Categories</a>
      <a class="page-link" href="/guestbook/">GuestBook</a>
      <a class="page-link" href="http://saltfactory.net">saltfactory.net</a>
    </div>

    </nav>
    <script>
(function() {
  var cx = '014516175331458470005:ze8dwrrwnac';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
  '//cse.google.com/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
</script>
<gcse:search></gcse:search>

</div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">최신 Android Studio, GCM(Google Cloud Messaging), Node.js를 이용하여 Android 푸시 서비스 구현하기</h1>
    <p class="post-meta">Jun 9, 2015</p>
  </header>

  <article class="post-content">
    <h2 id="서론">서론</h2>

<p>블로그에서 가장 많이 검색되는 글이 <a href="http://blog.saltfactory.net/node/implementing-push-notification-service-for-android-using-google-play-service.html">Node.js와 Google Play Service를 이용하여 안드로이드 푸시서비스 구현하기(GCM)</a> 이다. 이 글은 2014년 1월에 작성한 글로 그동안 <a href="https://developers.google.com/cloud-messaging/">Google Cloud Messaging</a> 서비스는 진화를 하여 더욱 편리하고 다르게 개발이 되고 있다. 오늘은 새롭게 바뀐 GCM 서비스를 개발하는 방법을 소개한다.</p>

<p>Android는 <a href="https://eclipse.org/">eclipse</a>에서 <a href="http://developer.android.com/tools/studio/index.html">Android Studio</a>로 IDE를 바꾸었고, <a href="http://ant.apache.org/">Ant</a> 기반 빌드 방식을 <a href="https://gradle.org/">Gradle</a>로 변경하였다. 이에 따라 기존의 문서들을 참조해서 개발할때 혼란스러운 부분들이 있고 아직 이것을 반영한 자료들이 그렇게 많지 않기 때문에 이 글을 통해서 안드로이드 GCM 서비스를 개발하는데 도움이 되길 바란다.</p>

<!--more-->

<h2 id="앱-만들기">앱 만들기</h2>

<p>GCM을 테스트하기 위한 Android 프로젝트를 하나 만들도록 한다. 완성된 예제는 <a href="https://github.com/saltfactory/saltfactory-android-tutorial/tree/gcm-demo">saltfactory-android-tutorial의 gcm-demo 브랜치</a>에서 받을 수 있다.</p>

<p><strong>Android Studio</strong>를 열어서 기본 프로젝트를 만든다.</p>

<h3 id="start-new-android-studio-project">Start New Android Studio project</h3>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%207_37_51%20PM.png?m=1433759886" alt="Start New Android Studio"></p>

<h3 id="new-project">New Project</h3>

<ul>
<li><strong>Application name</strong> : SF-GCM-DEMO</li>
<li><strong>Company Domain</strong> : saltfactory.net</li>
<li><strong>Package name</strong> : <strong>net.saltfactory.demo.gcm</strong></li>
<li><strong>Project location</strong> : /Projects/Repository/Saltfactory/saltfactory-android-tutorial/sf-gcm-demo</li>
</ul>

<p>으로 프로젝트를 만든다. 위 입력은 자신에 맞게 수정하여 입력한다. 주의할 점은 <strong>Pacakge name</strong>이다. Android의 어플리케이션의 유일한 identifier는 package name으로 인식하기 때문에 자신의 앱과 중복되지 않은 이름을 입력한다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%207_42_51%20PM.png?m=1433760924" alt="New Project"></p>

<h3 id="target-android-device">Target Android Device</h3>

<p>다음은 개발하고 싶은 <strong>SDK</strong>를 선택한다. 우리는 Android 스마트폰 GCM을 테스트할 예정이기 때문에 <strong>Phone and Tablet Minimum SDK</strong>를 선택한다. 현재 연구에 사용하고 있는 Android 디바이스가 최신형이 아니기 때문에 <strong>API 14(Android 4.0)</strong>을 선택했다. 자신에 맞는 SDK를 선택하면 된다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%207_46_26%20PM.png?m=1433760480" alt="Phone and Table Minimum SDK"></p>

<h3 id="add-an-activity-to-mobile">Add an activity to Mobile</h3>

<p>단순히 GCM을 테스트하기 위해서 우리는 <strong>Blank Activity</strong>를 선택한다. 실제 프로젝트를 새롭게 진행한다면 자신에게 필요한 Activity를 선택하면 된다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%207_49_07%20PM.png?m=1433760710" alt="Add an activity to Mobile"></p>

<h3 id="customize-the-activity">Customize the Activity</h3>

<p>특별히 다른 작업을 하지 않기 때문에 기본 Activity 이름을 그대로 사용하기로 한다. Title만 <strong>GCM demo</strong>로 입력한다.</p>

<ul>
<li><strong>Activity Name</strong> : MainActivity</li>
<li><strong>Layout Name</strong> : activity_name</li>
<li><strong>Title</strong> : <strong>GCM demo</strong></li>
<li><strong>Menu Resource Name</strong> : menu_main</li>
</ul>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%207_58_26%20PM.png?m=1433761123" alt="Customize the Activity"></p>

<p>간단하게 <strong>Gradle</strong> 기반의 Anroid 프로젝트가 만들어졌다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%208_13_37%20PM.png?m=1433762024" alt="created android project"></p>

<h2 id="앱-등록하기">앱 등록하기</h2>

<p>Android GCM 서비스를 개발하기 전에 GCM을 사용하기 위해 앱을 등록해야한다. Android GCM 사이트에 접속해보자. <a href="https://developers.google.com/cloud-messaging/">https://developers.google.com/cloud-messaging/</a></p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%207_18_24%20PM.png?m=1433759205" alt=""></p>

<p>Google Cloud Messasing은 이제 <strong>Android</strong> 디바이스 뿐만 아니라 <strong>iOS</strong> 디바이스에도 동일한 로직으로 GCM 서비스를 이용하여 메세지를 보낼 수 있다. <strong>iOS</strong>를 위한 GCM의 소개는 다음 포스트에서 소개하도록 하고 우선 <strong>Android GCM</strong>을 소개한다. Google의 서비스는 점차적으로 <a href="http://www.google.com/design/spec/material-design/introduction.html">Material Design</a>으로 디자인을 변경하고 있다. GCM 사이트 역시 <strong>Material Design</strong>이 적용되어 있다. <a href="https://developers.google.com/cloud-messaging/android/start">TRY IT ON ANDROID</a> 버튼을 클릭한다.</p>

<p>우리는 <strong>SF-GCM-demo</strong>라는 프로젝트를 이미 만들었고 GCM을 추가할 것이기 때문에 <a href="https://developers.google.com/cloud-messaging/android/client">add Cloud Messaging to your existing app</a>를 클릭한다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%208_16_41%20PM.png?m=1433762213" alt="add Cloud Messasing to your exsiting app"></p>

<h3 id="get-a-configuration-file">Get a configuration file</h3>

<p>앞에 설명은 각자 읽어보도록 하고 가운데 정도가면 <a href="https://developers.google.com/cloud-messaging/android/client#get-config">Get a configuration file</a>이 보일 것이다. <a href="https://developers.google.com/mobile/add?platform=android&amp;cntapi=gcm&amp;cnturl=https:%2F%2Fdevelopers.google.com%2Fcloud-messaging%2Fandroid%2Fclient&amp;cntlbl=Continue%20Adding%20GCM%20Support&amp;%3Fconfigured%3Dtrue">GET A CONFIGURATION FILE</a> 버튼을 클릭하자.</p>

<h3 id="enable-google-services-for-your-app">Enable Google services for your app</h3>

<p>페이지가 전환되면서 Android 앱을 등록하는 화면이 나온다. <strong>GCM</strong>을 사용하기 위해서 앱을 등록하는 화면이다.</p>

<ul>
<li><strong>App name</strong> : 앱 이름을 입력한다. 영문으로만 등록이 가능하다.</li>
<li><strong>Android package name</strong> : <strong>net.saltfactory.demo.gcm</strong></li>
</ul>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%208_22_35%20PM.png?m=1433762581" alt="Create or Choose an app"></p>

<p><strong>Continue Choose an configure services</strong> 버튼을 클릭한다. 등록하는 시간을 기다리면 다음과 같이 <strong>SF-GCM-DEMO</strong> 앱이 <strong>net.saltfactory.demo.gcm</strong> 패키지명으로 등록된 것을 확인할 수 있다. 앱을 등록하면 Google Sigin-in, Cloud Messaging, Analytics 서비스를 사용할 수 있다. 우리는  <strong>Cloud Messaging</strong>를 상용할 것이기 때문에 다른 설명은 생략한다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%208_24_10%20PM.png?m=1433762877" alt="Registration Android App"></p>

<p><strong>Google Cloud Messaging</strong> 탭을 보면 <strong>ENABLE GOOGLE CLOUD MESSAGING</strong> 버튼이 보인다. 이 버튼을 눌러줘야 GCM 서비스가 활성화 된다. 버튼을 클릭하자. 그러면 아래와 같이 GCM 서비스가 활성화 된 것을 확인할 수 있다. 이제 Google 서비스에 GCM에 관한 설정은 모두 마친 것이다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%208_30_33%20PM.png?m=1433763040" alt="Enable google cloud messaging"></p>

<p>아래에 보면 <strong>Generate configuration files</strong> 라는 버튼이 보인다. 이전 GCM에서의 복잡한 설정을 간단하게 configuration file로 처리를 할 수 있게 GCM 서비스가 업그레이드 되었다. 설정 파일을 만들어보자.</p>

<h3 id="generate-configuration-files">Generate Configuration files</h3>

<p>GCM 서비스가 업그레이드 되면서 설정하는 프로세스가 매우 직관적으로 변경되었다. 앞에서 설명하듯 차례차례 문서대로 진행하면 다음과 같이 <strong>Server API key</strong>와 <strong>Sender ID</strong>를 만들 수 있다. 이전에 블로그에 포스팅한 글의 가장 많은 질문이 <strong>Project ID</strong>를 어떻게 생성하는지에 대한 질문이였는데 GCM 업그레이드 이후 간단하게 생성할 수 있게 되었다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot_2015-06-08_at_8_32_01_PM.png?m=1433763179" alt=""></p>

<p>설정 파일 또한 쉽게 생성이 되었다. 상단에 <strong>Download google-services.json</strong> 버튼을 클릭해서 설정파일을 다운로드한다. 다운로드 받은 <code>google-services.json</code> 파일은 앞에서 만든 Android 프로젝트 디렉토리 안에 <code>app/</code> 디렉토리 안으로 복사한다. 이 파일이 <code>/app</code> 디렉토리안에 들어있지 않으면 GCM 프로젝트를 빌드할 때 <code>R.string.gcm_defaultSenderId</code> 리소스를 찾을 수 없다는 에러가 발생하면서 빌드가 되지 않는다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-08%20at%208_40_47%20PM.png?m=1433763667" alt="copy google-services.json"></p>

<h3 id="google-services.json">google-services.json</h3>

<p>설정 파일을 열어보자. 이전에 질문이 가장 많았던 <strong>Project ID</strong>와 <strong>Project Number</strong>가 자동으로 만들어진 것을 확인할 수 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;project_info&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;project_id&quot;</span><span class="o">:</span> <span class="s2">&quot;sf-gcm-demo-ae3be&quot;</span><span class="p">,</span>
    <span class="s2">&quot;project_number&quot;</span><span class="o">:</span> <span class="s2">&quot;636926190444&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SF-GCM-DEMO&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;client_info&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;client_id&quot;</span><span class="o">:</span> <span class="s2">&quot;android:net.saltfactory.demo.gcm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_type&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;android_client_info&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;package_name&quot;</span><span class="o">:</span> <span class="s2">&quot;net.saltfactory.demo.gcm&quot;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&quot;oauth_client&quot;</span><span class="o">:</span> <span class="p">[],</span>
      <span class="s2">&quot;services&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;analytics_service&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="s2">&quot;cloud_messaging_service&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s2">&quot;apns_config&quot;</span><span class="o">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="s2">&quot;appinvite_service&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s2">&quot;other_platform_oauth_client&quot;</span><span class="o">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="s2">&quot;google_signin_service&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="s2">&quot;ads_service&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="build.gradle-설정">build.gradle 설정</h2>

<p>다음은 <strong>Build</strong>를 설정해야한다. Android Studio로 Android 프로젝트를 개발하게 되면 이전과 다리 <strong>Gradle</strong>을 사용하게 되는데, 처음에는 복잡해 보일지 모르지만 기존의 <strong>Ant</strong> 방식과 달리 다양한 설정을 할 수 있고, 프로젝트에 필요한 <strong>dependencies</strong> 라이브러리를 자동으로 다운받기 때문에 <strong>classpath</strong>를 설정해주는 복잡한 과정을 생략할 수 있는 장점이 있다.</p>

<p>Google Cloud Messaging 문서에서는 <a href="https://developers.google.com/cloud-messaging/android/client#add-config">Add the configuration file to your project</a>를 참고한다.</p>

<p>Android Studio에서 <code>build.gradle</code> 파일을 열어서 아래와 같이 <code>classpath</code>를 추가한다. Android Studio에서 gradle 파일을 수정하면 자동으로 변경된 내용을 반영한다. 만약 자동으로 반영이 되지 않을 경우 Android Studio 오른쪽 Gradle Projects 패널을 열어서 <strong>새로 고침</strong> 버튼을 클릭하면 Gradle이 자동으로 갱신되어 필요한 라이브러리들을 다운받고 빌드를 진행할 준비를 하게 된다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// Top-level build file where you can add configuration options common to all sub-projects/modules.
buildscript {
    repositories {
        jcenter()
    }
    dependencies {
//        classpath &#39;com.android.tools.build:gradle:1.2.3&#39;
        classpath &#39;com.android.tools.build:gradle:1.3.0-beta1&#39;
        classpath &#39;com.google.gms:google-services:1.3.0-beta1&#39;
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}


allprojects {
    repositories {
        jcenter()
    }
}
</code></pre></div>
<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-09%20at%205_37_19%20PM.png?m=1433839059" alt="Android Studio gradle fresh button"></p>

<h2 id="set-up-google-play-services">Set Up Google Play Services</h2>

<p>GCM은 <strong>Google Play Services</strong>로 통합이 되었다. 이전 글에서도 Google Play Services 라이브러리를 사용하여 GCM 서비스를 만드는 방법을 소개했는데 Gradle을 사용하면 아주 쉽게 설정할 수 있다.</p>

<p><strong>app</strong>을 설정하는 <code>build.gradle</code>을 열어서 필요할 라이브러리 <code>play-services</code>를 다운 받기 위해서 다음과 같이 <code>dependencies</code>에  <code>compile &quot;com.google.android.gms:play-services:7.5.+”</code>을 추가한다. 이것은 컴파일할 때 <code>play-services</code> 라이브러리가 필요하니 없으면 다운 받아서 컴파일할 때 사용하라는 의미이다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">apply plugin: &#39;com.android.application&#39;
apply plugin: &#39;com.google.gms.google-services&#39;

android {
    compileSdkVersion 22
    buildToolsVersion &quot;22.0.1&quot;

    defaultConfig {
        applicationId &quot;net.saltfactory.demo.gcm&quot;
        minSdkVersion 14
        targetSdkVersion 22
        versionCode 1
        versionName &quot;1.0&quot;
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;
        }
    }
}

dependencies {
    compile fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])
    compile &#39;com.google.android.gms:play-services-gcm:7.5.+&#39;
    compile &#39;com.android.support:appcompat-v7:22.1.1&#39;

}
</code></pre></div>
<p>이제 필요한 <strong>라이브러리 설치</strong>와 <strong>클래스패스 설정</strong>을 모두 완료하였다. Gradle을 사용하여 아주 쉽게 설정을 하였다.</p>

<h2 id="androidmanifest.xml-설정">AndroidManifest.xml 설정</h2>

<p>이젠 Android 앱의 메타정보를 설정하는 <code>AndroidManifest.xml</code> 파일을 열어서 GCM 서비스를 만들기 위한 메타정보를 정의해야한다.</p>

<p><code>AndroidManifest.xml</code>에 추가해야할 핵심 내용은 다음과 같다.</p>

<ul>
<li><strong>GCM Permission</strong> : 디바이스에 GCM 서비스를 사용하기 위한 권한 설정</li>
<li><strong>GCM Receiver</strong> : GCM을 받았을 때 동작하기 위한 리시버</li>
<li><strong>GCM Listener Service</strong> : GCM을 요청을 대기하고 있는 리스너 서비스</li>
<li><strong>InstanceID Listener Service</strong> : InstanceID 요청을 대기하고 있는 리스너 서비스</li>
<li><strong>GCM Registration Service</strong> : GCM을 등록하기 위한 서비스</li>
</ul>

<p>위 내용을 입력하기 전에 우선 <code>&lt;!-- comment --&gt;</code>로 <code>AndroidManifest.xml</code>에 추가해보자.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">package=</span><span class="s">&quot;net.saltfactory.demo.gcm&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- [START gcm_permission] --&gt;</span>
    <span class="c">&lt;!-- [END gcm_permission] --&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span>
            <span class="na">android:name=</span><span class="s">&quot;.MainActivity&quot;</span>
            <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>

        <span class="c">&lt;!-- [START gcm_receiver] --&gt;</span>
        <span class="c">&lt;!-- [END gcm_receiver] --&gt;</span>

        <span class="c">&lt;!-- [START gcm_listener_service] --&gt;</span>
        <span class="c">&lt;!-- [END gcm_listener_service] --&gt;</span>

        <span class="c">&lt;!-- [START instanceId_listener_service] --&gt;</span>
        <span class="c">&lt;!-- [END instanceId_listener_service] --&gt;</span>

        <span class="c">&lt;!-- [START gcm_registration_service] --&gt;</span>
        <span class="c">&lt;!-- [END gcm_registration_service] --&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</code></pre></div>
<h3 id="uses-permission">uses-permission</h3>

<p>먼저 <strong>GCM Permission</strong>을 설정하자. 디바이스에서 GCM을 사용하기 위해서는 <code>com.google.android.c2dm.permission.RECEIVE</code>와 <code>android.permission.WAKE_LOCK</code> 권한이 필요하다.</p>

<ul>
<li><strong>com.google.android.c2dm.permission.RECEIVE</strong> : GCM은 원래 <a href="https://developers.google.com/android/c2dm/">c2dm</a> 이름으로 베타 운영되다가 정식으로 GCM 이름으로 변경이된다. 그래서 패키지 이름이 c2dm 그대로 유지하게 된듯핟.</li>
<li><strong>android.permission.WAKE_LOCK</strong> : 디바이스가 잠금이되어 화면이 꺼져있을 경우에도 GCM을 받을 수 있기 위해서 디바이스를 깨우는 권한이 필요하다.</li>
</ul>
<div class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="c">&lt;!-- [START gcm_permission] --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.c2dm.permission.RECEIVE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.WAKE_LOCK&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- [END gcm_permission] --&gt;</span>
</code></pre></div>
<h3 id="gcm-reciever">GCM Reciever</h3>

<p>GCM을 받기 위한 리시버를 만들어야하는데 GCM 리시버는 특별히 구현할 필요가 없다. GCM 라이브러리 안에 이미 구현체가 있기 때문에 정의만하면 된다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml">        <span class="c">&lt;!-- [START gcm_receiver] --&gt;</span>
        <span class="nt">&lt;receiver</span>
            <span class="na">android:name=</span><span class="s">&quot;com.google.android.gms.gcm.GcmReceiver&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;true&quot;</span>
            <span class="na">android:permission=</span><span class="s">&quot;com.google.android.c2dm.permission.SEND&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.c2dm.intent.RECEIVE&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/receiver&gt;</span>
        <span class="c">&lt;!-- [END gcm_receiver] --&gt;</span>
</code></pre></div>
<h3 id="gcm-listener-service">GCM Listener Service</h3>

<p>GCM 리스너 서비스는 GCM 메세지가 디바이스로 전송이되면 메세지를 받아서 처리하는 프로그램을 서비스로 정의한다. GCM 받아서 실제 Notification Center에 어떻게 나타내는지를 정의한다. 이후에 살펴볼 <code>MyGcmListenerService.java</code>에 내용을 구현할 것이다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml">        <span class="c">&lt;!-- [START gcm_listener_service] --&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm.MyGcmListenerService&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.c2dm.intent.RECEIVE&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
        <span class="c">&lt;!-- [END gcm_listener_service] --&gt;</span>
</code></pre></div>
<h3 id="instanceid-listener-service">InstanceID Listener Service</h3>

<p>최근 GCM 서비스에서는 <a href="https://developers.google.com/instance-id/">Instance ID</a>를 사용한다. 이것은 Android, iOS의 고유한 ID로 GCM에서 디바이스를 구분하기 위한 것이다. Instance ID를 위한 리서너를 <code>MyInstanceIDListener.java</code>에서 구현할 것이다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml">        <span class="c">&lt;!-- [START instanceId_listener_service] --&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm.MyInstanceIDListenerService&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.gms.iid.InstanceID&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
        <span class="c">&lt;!-- [END instanceId_listener_service] --&gt;</span>
</code></pre></div>
<h3 id="gcm-registration-service">GCM Registration Service</h3>

<p>실제 디바이스에서 <strong>Instance ID</strong>를 사용하여 디바이스를 GCM에 등록하고 <strong>디바이스 고유 토큰</strong>을 생성하기 위한 서비스를 <code>RegistrationIntentService.java</code>에서 구현할 것이다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml">        <span class="c">&lt;!-- [START gcm_registration_service] --&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm.RegistrationIntentService&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;&lt;/service&gt;</span>
        <span class="c">&lt;!-- [END gcm_registration_service] --&gt;</span>
</code></pre></div>
<h3 id="androidmanifest.xml">AndroidManifest.xml</h3>

<p>GCM을 사용하기 위한 메니페스트 파일 전체 내용은 다음과 같다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">package=</span><span class="s">&quot;net.saltfactory.demo.gcm&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- [START gcm_permission] --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.c2dm.permission.RECEIVE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.WAKE_LOCK&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- [END gcm_permission] --&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span>
            <span class="na">android:name=</span><span class="s">&quot;.MainActivity&quot;</span>
            <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>

        <span class="c">&lt;!-- [START gcm_receiver] --&gt;</span>
        <span class="nt">&lt;receiver</span>
            <span class="na">android:name=</span><span class="s">&quot;com.google.android.gms.gcm.GcmReceiver&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;true&quot;</span>
            <span class="na">android:permission=</span><span class="s">&quot;com.google.android.c2dm.permission.SEND&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.c2dm.intent.RECEIVE&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/receiver&gt;</span>
        <span class="c">&lt;!-- [END gcm_receiver] --&gt;</span>

        <span class="c">&lt;!-- [START gcm_listener_service] --&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm.MyGcmListenerService&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.c2dm.intent.RECEIVE&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
        <span class="c">&lt;!-- [END gcm_listener_service] --&gt;</span>

        <span class="c">&lt;!-- [START instanceId_listener_service] --&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm.MyInstanceIDListenerService&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.google.android.gms.iid.InstanceID&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
        <span class="c">&lt;!-- [END instanceId_listener_service] --&gt;</span>

        <span class="c">&lt;!-- [START gcm_registration_service] --&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">&quot;net.saltfactory.demo.gcm.RegistrationIntentService&quot;</span>
            <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;&lt;/service&gt;</span>
        <span class="c">&lt;!-- [END gcm_registration_service] --&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</code></pre></div>
<h2 id="gcm-demo">GCM Demo</h2>

<p><strong>GCM Demo</strong>를 좀더 사용할만한 데모 앱을 만들기 위해서 <a href="http://developer.android.com/reference/android/widget/Button.html">Button</a>, <a href="http://developer.android.com/reference/android/widget/TextView.html">TextView</a> 그리고 <a href="https://developer.android.com/reference/android/widget/ProgressBar.html">ProgressBar</a>를 사용하여 UI를 구성하였다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/device-2015-06-09-151902.png?m=1433830851" alt="GCM Demo start"></p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/device-2015-06-09-151926.png?m=1433830894" alt="GCM Demo finish"></p>

<h3 id="string.xml">string.xml</h3>

<p>데모에 사용하기 위한 스트링을 정의한 <code>app/src/main/res/values/string.xml</code>을 다음 내용으로 저장한다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;app_name&quot;</span><span class="nt">&gt;</span>GCM Demo<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;registering_message_ready&quot;</span><span class="nt">&gt;</span>InstanceID 토큰 가져오기<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;registering_message_generating&quot;</span><span class="nt">&gt;</span>InstanceID 토큰 생성중...<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;registering_message_complete&quot;</span><span class="nt">&gt;</span>완료!<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre></div>
<h3 id="style.xml">style.xml</h3>

<p>데모에 사용하기 위한 스타일을 정의한 <code>app/src/main/res/values/style.xml</code>을 다음 내용으로 저장한다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;resources&gt;</span>

    <span class="c">&lt;!-- Base application theme. --&gt;</span>
    <span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;AppTheme&quot;</span> <span class="na">parent=</span><span class="s">&quot;Theme.AppCompat.Light.DarkActionBar&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Customize your theme here. --&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textColor&quot;</span><span class="nt">&gt;</span>@android:color/white<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textSize&quot;</span><span class="nt">&gt;</span>16sp<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;/resources&gt;</span>
</code></pre></div>
<h3 id="demens.xml">demens.xml</h3>

<p>데모에 사용하기 위한 크기를 정의한 <code>app/src/main/res/values/dimens.xml</code>을 다음 내용으로 저장한다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;resources&gt;</span>
    <span class="c">&lt;!-- Default screen margins, per the Android Design guidelines. --&gt;</span>
    <span class="nt">&lt;dimen</span> <span class="na">name=</span><span class="s">&quot;activity_horizontal_margin&quot;</span><span class="nt">&gt;</span>16dp<span class="nt">&lt;/dimen&gt;</span>
    <span class="nt">&lt;dimen</span> <span class="na">name=</span><span class="s">&quot;activity_vertical_margin&quot;</span><span class="nt">&gt;</span>16dp<span class="nt">&lt;/dimen&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre></div>
<h3 id="layout.xml">layout.xml</h3>

<p><code>app/src/main/res/layout/activity_main.xml</code> 레이아웃 파일을 열어서 다음 내용을 입력하고 저장한다.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span> <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span> <span class="na">android:paddingLeft=</span><span class="s">&quot;@dimen/activity_horizontal_margin&quot;</span>
    <span class="na">android:paddingRight=</span><span class="s">&quot;@dimen/activity_horizontal_margin&quot;</span>
    <span class="na">android:paddingTop=</span><span class="s">&quot;@dimen/activity_vertical_margin&quot;</span>
    <span class="na">android:paddingBottom=</span><span class="s">&quot;@dimen/activity_vertical_margin&quot;</span>
    <span class="na">android:background=</span><span class="s">&quot;@color/blue_grey_700&quot;</span>
    <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span> <span class="na">tools:context=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;Button</span> <span class="na">android:id=</span><span class="s">&quot;@+id/registrationButton&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span> <span class="na">android:text=</span><span class="s">&quot;@string/registering_message_ready&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;TextView</span> <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/informationTextView&quot;</span>
        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;ProgressBar</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/registrationProgressBar&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre></div>
<h3 id="quickstartpreferences.java">QuickstartPreferences.java</h3>

<p>이 파일은 <strong>GCM Demo</strong>에서 사용하는 LocalBoardcast의 액션을 정의한 파일이다. <code>app/src/main/java/net/saltfactory/demo/gcm/QuickstartPreferences.java</code>에 아래내용을 저장한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">gcm</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by saltfactory on 6/8/15.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuickstartPreferences</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">REGISTRATION_READY</span> <span class="o">=</span> <span class="s">&quot;registrationReady&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">REGISTRATION_GENERATING</span> <span class="o">=</span> <span class="s">&quot;registrationGenerating&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">REGISTRATION_COMPLETE</span> <span class="o">=</span> <span class="s">&quot;registrationComplete&quot;</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div>
<h3 id="mainactivity.java">MainActivity.java</h3>

<p><strong>GCM Demo</strong>의 메인 엑티비티 클래스를 정의하자. <code>app/src/main/java/net/saltfactory/demo/gcm/MainActivity.java</code> 파일을 열어서 다음 내용을 추가한다. 핵심 메소드는 다음과 같다.</p>

<ul>
<li><strong>onCreate()</strong> : UI를 정의하고 이벤트와 핸들러를 정의한다.</li>
<li><strong>onResume()</strong> : 화면이 보여질때 LocalBroadcastManager를 정의한다.</li>
<li><strong>onPause()</strong> : 화면이 사라질때 LocalBoradcastManager에 등록된 것을 제거한다.</li>
<li><strong>checkPlayService()</strong> : Google Play Service를 사용할 수 있는 환경인지 체크한다.</li>
<li><strong>registBroadcastReciever()</strong> : LocalBroadcast 액션에 해당하는 작업을 정의한다.</li>
<li><strong>getInstanceIdToken()</strong> : GCM을 등록하고 Instance ID에 해당하는 token을 가져온다.</li>
</ul>

<p>자세한 내용은 코드의 주석으로 대신하고 다음 내용을 저장한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">gcm</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.IntentFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.content.LocalBroadcastManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.ProgressBar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.android.gms.common.ConnectionResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.common.GooglePlayServicesUtil</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">PLAY_SERVICES_RESOLUTION_REQUEST</span> <span class="o">=</span> <span class="mi">9000</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Button</span> <span class="n">mRegistrationButton</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ProgressBar</span> <span class="n">mRegistrationProgressBar</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BroadcastReceiver</span> <span class="n">mRegistrationBroadcastReceiver</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">mInformationTextView</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Instance ID를 이용하여 디바이스 토큰을 가져오는 RegistrationIntentService를 실행한다.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getInstanceIdToken</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">checkPlayServices</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// Start IntentService to register this application with GCM.</span>
            <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">RegistrationIntentService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * LocalBroadcast 리시버를 정의한다. 토큰을 획득하기 위한 READY, GENERATING, COMPLETE 액션에 따라 UI에 변화를 준다.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registBroadcastReceiver</span><span class="o">(){</span>
        <span class="n">mRegistrationBroadcastReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>


                <span class="k">if</span><span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_READY</span><span class="o">)){</span>
                    <span class="c1">// 액션이 READY일 경우</span>
                    <span class="n">mRegistrationProgressBar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">ProgressBar</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
                    <span class="n">mInformationTextView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_GENERATING</span><span class="o">)){</span>
                    <span class="c1">// 액션이 GENERATING일 경우</span>
                    <span class="n">mRegistrationProgressBar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">ProgressBar</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
                    <span class="n">mInformationTextView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
                    <span class="n">mInformationTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">registering_message_generating</span><span class="o">));</span>
                <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_COMPLETE</span><span class="o">)){</span>
                    <span class="c1">// 액션이 COMPLETE일 경우</span>
                    <span class="n">mRegistrationProgressBar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">ProgressBar</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
                    <span class="n">mRegistrationButton</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">registering_message_complete</span><span class="o">));</span>
                    <span class="n">mRegistrationButton</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
                    <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">);</span>
                    <span class="n">mInformationTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
                <span class="o">}</span>

            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">registBroadcastReceiver</span><span class="o">();</span>

        <span class="c1">// 토큰을 보여줄 TextView를 정의</span>
        <span class="n">mInformationTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">informationTextView</span><span class="o">);</span>
        <span class="n">mInformationTextView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
        <span class="c1">// 토큰을 가져오는 동안 인디케이터를 보여줄 ProgressBar를 정의</span>
        <span class="n">mRegistrationProgressBar</span> <span class="o">=</span> <span class="o">(</span><span class="n">ProgressBar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">registrationProgressBar</span><span class="o">);</span>
        <span class="n">mRegistrationProgressBar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">ProgressBar</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
        <span class="c1">// 토큰을 가져오는 Button을 정의</span>
        <span class="n">mRegistrationButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">registrationButton</span><span class="o">);</span>
        <span class="n">mRegistrationButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/**</span>
<span class="cm">             * 버튼을 클릭하면 토큰을 가져오는 getInstanceIdToken() 메소드를 실행한다.</span>
<span class="cm">             * @param view</span>
<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">getInstanceIdToken</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 앱이 실행되어 화면에 나타날때 LocalBoardcastManager에 액션을 정의하여 등록한다.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">registerReceiver</span><span class="o">(</span><span class="n">mRegistrationBroadcastReceiver</span><span class="o">,</span>
                <span class="k">new</span> <span class="nf">IntentFilter</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_READY</span><span class="o">));</span>
        <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">registerReceiver</span><span class="o">(</span><span class="n">mRegistrationBroadcastReceiver</span><span class="o">,</span>
                <span class="k">new</span> <span class="nf">IntentFilter</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_GENERATING</span><span class="o">));</span>
        <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">registerReceiver</span><span class="o">(</span><span class="n">mRegistrationBroadcastReceiver</span><span class="o">,</span>
                <span class="k">new</span> <span class="nf">IntentFilter</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_COMPLETE</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 앱이 화면에서 사라지면 등록된 LocalBoardcast를 모두 삭제한다.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">unregisterReceiver</span><span class="o">(</span><span class="n">mRegistrationBroadcastReceiver</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="cm">/**</span>
<span class="cm">     * Google Play Service를 사용할 수 있는 환경이지를 체크한다.</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">checkPlayServices</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">resultCode</span> <span class="o">=</span> <span class="n">GooglePlayServicesUtil</span><span class="o">.</span><span class="na">isGooglePlayServicesAvailable</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">resultCode</span> <span class="o">!=</span> <span class="n">ConnectionResult</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">GooglePlayServicesUtil</span><span class="o">.</span><span class="na">isUserRecoverableError</span><span class="o">(</span><span class="n">resultCode</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">GooglePlayServicesUtil</span><span class="o">.</span><span class="na">getErrorDialog</span><span class="o">(</span><span class="n">resultCode</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span>
                        <span class="n">PLAY_SERVICES_RESOLUTION_REQUEST</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;This device is not supported.&quot;</span><span class="o">);</span>
                <span class="n">finish</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h3 id="registrationintentservice.java">RegistrationIntentService.java</h3>

<p>이 파일은 <strong>Instance ID</strong>를 가지고 <strong>토큰</strong>을 가져오는 작업을 한다. <strong>GCM Demo</strong> 앱을 위해 토큰을 가져오기 전에 <strong>ProgressBar</strong>를 동작시키고, 토큰을 가져오는 작업을 완료하면 ProgressBar를 멈추고 <strong>TextView</strong>에 토큰 정보를 업데이트하기 위한 <strong>LocalBoardcast</strong> 액션을 추가하였다.  <code>app/src/main/java/net/saltfactory/demo/gcm/RegistrationIntentService.java</code>  파일에 아래 내용을 저장한다. 자세한 내용은 주석으로 대신한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">gcm</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.annotation.SuppressLint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.IntentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.content.LocalBroadcastManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.android.gms.gcm.GoogleCloudMessaging</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.iid.InstanceID</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by saltfactory on 6/8/15.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RegistrationIntentService</span> <span class="kd">extends</span> <span class="n">IntentService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;RegistrationIntentService&quot;</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">RegistrationIntentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">TAG</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * GCM을 위한 Instance ID의 토큰을 생성하여 가져온다.</span>
<span class="cm">     * @param intent</span>
<span class="cm">     */</span>
    <span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">&quot;LongLogTag&quot;</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onHandleIntent</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// GCM Instance ID의 토큰을 가져오는 작업이 시작되면 LocalBoardcast로 GENERATING 액션을 알려 ProgressBar가 동작하도록 한다.</span>
        <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
                <span class="o">.</span><span class="na">sendBroadcast</span><span class="o">(</span><span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_GENERATING</span><span class="o">));</span>

        <span class="c1">// GCM을 위한 Instance ID를 가져온다.</span>
        <span class="n">InstanceID</span> <span class="n">instanceID</span> <span class="o">=</span> <span class="n">InstanceID</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">TAG</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// GCM 앱을 등록하고 획득한 설정파일인 google-services.json을 기반으로 SenderID를 자동으로 가져온다.</span>
                <span class="n">String</span> <span class="n">default_senderId</span> <span class="o">=</span> <span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">gcm_defaultSenderId</span><span class="o">);</span>
                <span class="c1">// GCM 기본 scope는 &quot;GCM&quot;이다.</span>
                <span class="n">String</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">GoogleCloudMessaging</span><span class="o">.</span><span class="na">INSTANCE_ID_SCOPE</span><span class="o">;</span>
                <span class="c1">// Instance ID에 해당하는 토큰을 생성하여 가져온다.</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">instanceID</span><span class="o">.</span><span class="na">getToken</span><span class="o">(</span><span class="n">default_senderId</span><span class="o">,</span> <span class="n">scope</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

                <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;GCM Registration Token: &quot;</span> <span class="o">+</span> <span class="n">token</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">// GCM Instance ID에 해당하는 토큰을 획득하면 LocalBoardcast에 COMPLETE 액션을 알린다.</span>
        <span class="c1">// 이때 토큰을 함께 넘겨주어서 UI에 토큰 정보를 활용할 수 있도록 했다.</span>
        <span class="n">Intent</span> <span class="n">registrationComplete</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">QuickstartPreferences</span><span class="o">.</span><span class="na">REGISTRATION_COMPLETE</span><span class="o">);</span>
        <span class="n">registrationComplete</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>
        <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">sendBroadcast</span><span class="o">(</span><span class="n">registrationComplete</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h2 id="myinstanceidlistenerservice.java">MyInstanceIDListenerService.java</h2>

<p>이 파일은 <strong>Instance ID</strong>를 획득하기 위한 리스너를 상속받아서 토큰을 갱신하는 코드를 추가한다. <code>app/src/main/java/net/saltfactory/demo/gcm/MyInstanceIDListenerService.java</code> 파일에 아래 내용을 저장한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">gcm</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.android.gms.iid.InstanceIDListenerService</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by saltfactory on 6/8/15.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyInstanceIDListenerService</span> <span class="kd">extends</span> <span class="n">InstanceIDListenerService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MyInstanceIDLS&quot;</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTokenRefresh</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">RegistrationIntentService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h3 id="mygcmlistenerservice.java">MyGcmListenerService.java</h3>

<p>이 파일은 GCM으로 메시지가 도착하면 디바이스에 받은 메세지를 어떻게 사용할지에 대한 내용을 정의하는 클래스이다.
* <strong>onMessageReceived()</strong> : GCM으로부터 이 함수를 통해 메세지를 받는다. 이때 전송한 <strong>SenderID</strong>와 <code>Set</code> 타입의 데이터 컬렉션 형태로 받게된다.
* <strong>sendNotification()</strong> : GCM으로부터 받은 메세지를 디바이스에 알려주는 함수이다.
<code>app/src/main/java/net/saltfactory/demo/gcm/MyGcmListenerService.java</code> 파일에 아래 내용을 저장한다. 자세한 내용은 주석으로 대신한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">gcm</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.NotificationManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.PendingIntent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.media.RingtoneManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.app.NotificationCompat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.android.gms.gcm.GcmListenerService</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by saltfactory on 6/8/15.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyGcmListenerService</span> <span class="kd">extends</span> <span class="n">GcmListenerService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MyGcmListenerService&quot;</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     *</span>
<span class="cm">     * @param from SenderID 값을 받아온다.</span>
<span class="cm">     * @param data Set형태로 GCM으로 받은 데이터 payload이다.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessageReceived</span><span class="o">(</span><span class="n">String</span> <span class="n">from</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;message&quot;</span><span class="o">);</span>

        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;From: &quot;</span> <span class="o">+</span> <span class="n">from</span><span class="o">);</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">title</span><span class="o">);</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Message: &quot;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>

        <span class="c1">// GCM으로 받은 메세지를 디바이스에 알려주는 sendNotification()을 호출한다.</span>
        <span class="n">sendNotification</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="cm">/**</span>
<span class="cm">     * 실제 디바에스에 GCM으로부터 받은 메세지를 알려주는 함수이다. 디바이스 Notification Center에 나타난다.</span>
<span class="cm">     * @param title</span>
<span class="cm">     * @param message</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendNotification</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_CLEAR_TOP</span><span class="o">);</span>
        <span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span> <span class="cm">/* Request code */</span><span class="o">,</span> <span class="n">intent</span><span class="o">,</span>
                <span class="n">PendingIntent</span><span class="o">.</span><span class="na">FLAG_ONE_SHOT</span><span class="o">);</span>

        <span class="n">Uri</span> <span class="n">defaultSoundUri</span><span class="o">=</span> <span class="n">RingtoneManager</span><span class="o">.</span><span class="na">getDefaultUri</span><span class="o">(</span><span class="n">RingtoneManager</span><span class="o">.</span><span class="na">TYPE_NOTIFICATION</span><span class="o">);</span>
        <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_stat_ic_notification</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setSound</span><span class="o">(</span><span class="n">defaultSoundUri</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">);</span>

        <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span>
                <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>

        <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="mi">0</span> <span class="cm">/* ID of notification */</span><span class="o">,</span> <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>기타 필요한 resources들은 github에 올려놓은 예제에서 받아서 복사하여 사용하면 된다.</p>

<h2 id="gcm-demo-실행">GCM Demo 실행</h2>

<p>이제 GCM 서비스를 만들기 위한 Android에 관한 모든 설정이 끝났다. <strong>gradle</strong>을 사용하여 디바이스로 실행하면 앱이 실행이 될 것이다. 간단하게 Android Studio에서 Run을 실행하면 된다. 앱을 실행하여 토큰을 획득하면 아래와 같이 <strong>Instance ID</strong>에 해당하는 <strong>token</strong>을 가져올 것이다.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/device-2015-06-09-151926.png?m=1433830894" alt="GCM Demo finish"></p>

<h2 id="node.js를-이용한-gcm-provider-만들기">Node.js를 이용한 GCM Provider 만들기</h2>

<p>Android 디바이스에서 GCM을 사용하기 위한 <strong>토큰</strong>을 획득하였다. 이제 서버에서 Android 디바이스에 GCM을 사용하여 메세지를 보내도록 하자. 이전 블로그에서도 Node.js로 GCM을 사용하여 메세지를 보내기 위한 코드를 소개한적이 있는데 그대로 사용하면 된다.</p>

<p>우선 <a href="https://github.com/ToothlessGear/node-gcm">node-gcm</a> 이 필요하기 때문에 설치를 한다. (시스템에 node.js가 설치되어 있다고 가정한다.)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install node-gcm
</code></pre></div>
<p>이제 GCM을 사용하여 메세지를 보내기 위한 간단한 provider 소스코드를 작성하자. <code>gcm-provider.js</code>라는 파일로 다음 내용을 저장한다. 서버에서 GCM을 사용하여 메세지를 보낼때 2가지 중요한 변수가 있다.</p>

<ul>
<li><strong>Server API Key</strong> : 처음 GCM 웹 페이지에서 앱을 등록하고 획득한 Server API Key 이다.</li>
<li><strong>InstanceID token</strong> : Android 디바이스에서 Instance ID의 token을 획득한 것을 사용한다.</li>
</ul>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot_2015-06-08_at_8_32_01_PM.png?m=1433763179" alt=""></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">gcm</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-gcm&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gcm</span><span class="p">.</span><span class="nx">Message</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gcm</span><span class="p">.</span><span class="nx">Message</span><span class="p">({</span>
    <span class="nx">collapseKey</span><span class="o">:</span> <span class="s1">&#39;demo&#39;</span><span class="p">,</span>
    <span class="nx">delayWhileIdle</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">timeToLive</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;saltfactory GCM demo&#39;</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Google Cloud Messaging 테스트’,</span>
<span class="s1">        custom_key1: &#39;</span><span class="nx">custom</span> <span class="nx">data1</span><span class="s1">&#39;,</span>
<span class="s1">        custom_key2: &#39;</span><span class="nx">custom</span> <span class="nx">data2</span><span class="err">&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">server_api_key</span> <span class="o">=</span> <span class="err">‘</span><span class="nx">GCM</span> <span class="err">앱을</span> <span class="err">등록할때</span> <span class="err">획득한</span> <span class="nx">Server</span> <span class="nx">API</span> <span class="nx">Key</span><span class="err">’</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">sender</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gcm</span><span class="p">.</span><span class="nx">Sender</span><span class="p">(</span><span class="nx">server_api_key</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">registrationIds</span> <span class="o">=</span> <span class="p">[];</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="err">‘</span><span class="nx">Android</span> <span class="err">디바이스에서</span> <span class="nx">Instance</span> <span class="nx">ID</span><span class="err">의</span> <span class="nx">token</span><span class="err">’</span><span class="p">;</span>
<span class="nx">registrationIds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>

<span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">registrationIds</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>이제 메세지를 발송해보자. 정상적으로 발송되면 아래와 같은 화면이 나타난다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">node gcm_provider.js
</code></pre></div>
<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-09%20at%204_24_34%20PM.png?m=1433834682" alt="gcm_provider"></p>

<p>이제 Android 디바이스에 GCM으로 메세지가 전송되었는지 Notification Center를 확인하자.</p>

<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/device-2015-06-09-162526.png?m=1433834834" alt="GCM message"></p>

<h2 id="http-connection-server">HTTP Connection Server</h2>

<p><strong>GCM</strong> 서비스가 지속적으로 업그레이드되면서 더이상 GCM 서버를 만들 필요가 없게 되었다. 이제 서버구현없이 <a href="https://developers.google.com/cloud-messaging/http">HTTP</a>로 바로 GCM 메시지 전송을 보낼 수 있기 때문이다. 아래와 같이 GCM에서 제공하는 <strong>HTTP Conection Server</strong>를 사용하기 위해서 터미널에서 특별한 프로그램없이 바로 GCM을 사용할 수 있다. <strong>Server API Key</strong>만 있으면 <a href="https://gcm-http.googleapis.com/gcm/send">https://gcm-http.googleapis.com/gcm/send</a> 로 인증과 함께 메세지를 바로 전송할 수 있다.</p>

<ul>
<li><strong>$server_api_key</strong> : GCM에 앱을 등록할 때 획득한 Server API Key</li>
<li><strong>$token</strong> : 디바이스 Instance ID의 token 값</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl --header <span class="s2">&quot;Authorization: key=$server_api_key&quot;</span> <span class="se">\</span>
--header Content-Type:<span class="s2">&quot;application/json&quot;</span> <span class="se">\</span>
https://gcm-http.googleapis.com/gcm/send <span class="se">\</span>
-d <span class="s2">&quot;{\&quot;data\&quot;:{\&quot;title\&quot;:\&quot;saltfactory GCM demo\&quot;,\&quot;message\&quot;:\&quot;Google Cloud Messaging 테스트\&quot;},\&quot;to\&quot;:\&quot;$token\&quot;}&quot;</span>
</code></pre></div>
<p><img src="http://assets.hibrainapps.net/images/var/albums/hbncloud/public/Screen_Shot%202015-06-09%20at%204_59_18%20PM.png?m=1433836765" alt="HTTP Connection Server"></p>

<h2 id="결론">결론</h2>

<p>이전에 블로그에 <a href="http://blog.saltfactory.net/node/implementing-push-notification-service-for-android-using-google-play-service.html">Node.js와 Google Play Service를 이용하여 안드로이드 푸시서비스 구현하기(GCM)</a> 라는 글을 작성하고 많은 질문을 받았다. Google의 푸시 서비스는 <a href="https://developers.google.com/android/c2dm/">C2DM</a> 부터 설정이 꽤 복잡했다. GCM이라는 이름을 변경하고 <strong>Google Play Service</strong>로 GCM을 통합하면서 <code>gcm.jar</code>를 사용하여 그 방법을 개선하다가, Android Studio와 <strong>Gradle</strong>의 조합으로 최근에 GCM 서비스를 개발하기에는 매우 간편해졌다. (아직 조금은 복잡하지만) 이 블로그의 글로 최신 GCM을 사용하는데 조금이라도 도움이 되길 바란다. 이번 GCM 업데이트에서는 <a href="https://developers.google.com/instance-id/">Instance ID</a>와 <a href="https://developers.google.com/cloud-messaging/http">HTTP connection Server</a>의 등장으로 GCM을 위한 서버를 구축하지 않아도 되어 GCM 서비스를 구축하는데 더욱 간편해졌다. 한간지 더! 이번 GCM 업데이트로 iOS도 GCM으로 푸시서비스를 구현할 수 있다는 것이다. 이제 Android, iOS 디바이스로 푸시를 발송하기 위해서 따로 푸시 서버(Push Provider)를 구축하지 않아도 된다는 말이다. iOS 디바이스에 GCM을 사용하여 푸시 서비스를 구현하는 방법은 이후에 블로그를 통해 소개할 예정이다.</p>

<h2 id="소스코드">소스코드</h2>

<ul>
<li><a href="https://github.com/saltfactory/saltfactory-android-tutorial/tree/gcm-demo">https://github.com/saltfactory/saltfactory-android-tutorial/tree/gcm-demo</a></li>
</ul>

<h2 id="참고">참고</h2>

<ol>
<li><a href="http://blog.saltfactory.net/node/implementing-push-notification-service-for-android-using-google-play-service.html">http://blog.saltfactory.net/node/implementing-push-notification-service-for-android-using-google-play-service.html</a></li>
<li><a href="https://developers.google.com/cloud-messaging/">https://developers.google.com/cloud-messaging/</a></li>
<li><a href="https://developers.google.com/cloud-messaging/android/start">https://developers.google.com/cloud-messaging/android/start</a></li>
<li><a href="https://developers.google.com/cloud-messaging/registration">https://developers.google.com/cloud-messaging/registration</a></li>
<li><a href="https://developers.google.com/cloud-messaging/android/client">https://developers.google.com/cloud-messaging/android/client</a></li>
<li><a href="https://developers.google.com/cloud-messaging/http">https://developers.google.com/cloud-messaging/http</a></li>
</ol>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

<h2 id="기부">기부</h2>

<p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=NR99D2BERKK8Y&amp;lc=KR&amp;item_name=donate%2esaltfactory%2enet&amp;item_number=net%2esaltfactory%2edonate&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted"><img src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" alt="paypal button"></a></p>

  </article>

  <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_sharing_toolbox"></div>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55706d7f707f75ff" async="async"></script>



<!-- <div class='shareaholic-canvas' data-app='share_buttons' data-app-id=''></div>
<script type="text/javascript">
//<![CDATA[
  (function() {
    var shr = document.createElement('script');
    shr.setAttribute('data-cfasync', 'false');
    shr.src = '//dsms0mj1bbhn4.cloudfront.net/assets/pub/shareaholic.js';
    shr.type = 'text/javascript'; shr.async = 'true';
    shr.onload = shr.onreadystatechange = function() {
      var rs = this.readyState;
      if (rs && rs != 'complete' && rs != 'loaded') return;
      var site_id = 'fd3b2a079d78a86b57bffbfc4e3ee42d';
      try { Shareaholic.init(site_id); } catch (e) {}
    };
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(shr, s);
  })();
//]]>
</script> -->

  
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactoryblog';
    
    // 
    

    
      var disqus_identifier = 'http://blog.saltfactory.net/android/implement-push-service-via-gcm.html';
    

    
      var disqus_url = 'http://blog.saltfactory.net/android/implement-push-service-via-gcm.html';
    


    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  



</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">saltfactory's blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <!-- <li>saltfactory's blog</li> -->
          <li><img class="profile" src="/assets/images/profile.png"/></li>
          <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
          <li><a href="http://saltfactory.net">saltfactory.net</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/saltfactory">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/saltfactory">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">@saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://facebook.com/salthub">
              <span class="icon icon--facebook">
                <!-- <svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
 -->
                <svg viewBox="0 0 16 28">
                  <path id="logo" d="M14.984 0.187v4.125h-2.453q-1.344 0-1.813 0.562t-0.469 1.687v2.953h4.578l-0.609 4.625h-3.969v11.859h-4.781v-11.859h-3.984v-4.625h3.984v-3.406q0-2.906 1.625-4.508t4.328-1.602q2.297 0 3.563 0.187z"></path>
                </svg>
              </span>
              <span class="username">salthub</span>
            </a>
          </li>

        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
