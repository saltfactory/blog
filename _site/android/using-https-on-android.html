<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>안드로이드에서 https 요청 구현하기</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="">
    <link rel="canonical" href="/series/android/using-https-on-android.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/series/assets/css/main.css">
    <!-- <link rel='stylesheet' type='text/css' href='/assets/css/main.css' /> -->

    
</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/series/">saltfactory's series</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="/">saltfactory.net</a>
        <a class="page-link" href="/guestbook">Guestbook</a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>안드로이드에서 https 요청 구현하기</h1>
    <p class="meta">Jan 29, 2014</p>
  </header>

  <article class="post-content">
  <h2 id="서론">서론</h2>

<p>현재 시중에 나와 있는 안드로이드 책은 모두 Http로 데이터를 요청하는 예제만 수록하고 있다. 하지만 안드로이드 앱을 개발할 때 http 요청만 처리하는 것이 아니다. https 요청을 http와 동일하게 사용할수는 없다. 이번 프로젝트에서 https로 로그인 관련 작업을 하면서 우리가 안드로이드를 개발할 때 흔히 사용하는 <strong>HttpClient</strong>로 https를 요청할 수 없다는 것을 확인하고 방법을 찾아서 해결했는데 그 방법에 대해서 포스팅하고자 한다.</p>

<!--more-->

<h3 id="https-서버구축">Https 서버구축</h3>

<p>첫번째로 우리가 해야할 일은 Https 서버를 구축해야한다. 하지만 개인 앱 개발자는 대부분 서버를 가지고 있지 않거나, 서버 작업을 하기 힘든 상황이다. 그래서 이전 포스팅에 OpenSSL과 Node.js를 사용해서 Https 서버를 구축할 수 있는 방법을 소개했다. <a href="http://blog.saltfactory.net/221">http://blog.saltfactory.net/221</a> 글을 참조해서 Https 서버를 만들어보자. https로 로그인하는 예제를 만들것이기 때문에 다음과 같이 POST로 /login 요청이 들어오는 부분을 수정한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
    <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">),</span>
    <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">),</span>
    <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">key</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;key.pem&#39;</span><span class="p">),</span>
    <span class="nx">cert</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;cert.pem&#39;</span><span class="p">)</span>
<span class="p">};</span>


<span class="kd">var</span> <span class="nx">port1</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">port2</span> <span class="o">=</span> <span class="mi">443</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">());</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port1</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Express server listening on port &quot;</span> <span class="o">+</span> <span class="nx">port1</span><span class="p">);</span>
<span class="p">});</span>


<span class="nx">https</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port2</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Express server listening on port &quot;</span> <span class="o">+</span> <span class="nx">port2</span><span class="p">);</span>
<span class="p">});</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;h3&gt;Welcome&lt;/h3&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;/login&quot;&gt;Please login&lt;/a&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;h3&gt;Login&lt;/h3&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;form method=&quot;POST&quot; action=&quot;/login&quot;&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;label name=&quot;userId&quot;&gt;UserId : &lt;/label&gt;&#39;</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; name=&quot;userId&quot;&gt;&lt;br/&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;label name=&quot;password&quot;&gt;Password : &lt;/label&gt;&#39;</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br/&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;submit&quot; name=&quot;login&quot; value=&quot;Login&quot;&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;/form&gt;&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">})</span>

<span class="c1">// app.post(&#39;/login&#39;, function (req, res){</span>
<span class="c1">//  var userId = req.param(&quot;userId&quot;);</span>
<span class="c1">//  var password = req.param(&quot;password&quot;)</span>
<span class="c1">//</span>
<span class="c1">//  res.writeHead(200, {&#39;Content-Type&#39;: &#39;text/html&#39;});</span>
<span class="c1">//  res.write(&#39;Thank you, &#39;+userId+&#39;, you are now logged in.&#39;);</span>
<span class="c1">//  res.write(&#39;&lt;p&gt;&lt;a href=&quot;/&quot;&gt; back home&lt;/a&gt;&#39;);</span>
<span class="c1">//  res.end();</span>
<span class="c1">// });</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">userId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s2">&quot;userId&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="nx">userId</span><span class="o">:</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span><span class="nx">password</span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="테스트-프로젝트-생성-및-httpclient-요청">테스트 프로젝트 생성 및 HttpClient 요청</h3>

<p>Https 요청을 테스트하기 위해서 간단한 안드로이드 프로젝트를 생성한다. 버튼을 가지고 있고 버튼을 누르면 https를 요청하는 간단한 예제이다. 최종 소스코드는 github에 공개할 예정이다. 우선 간단히 안드로이드 프로젝트를 생성해서 onCreate 메소드 안에 다음과 같이 버튼을 클릭할때 온클릭 리스너를 등록한다. 서버로 넘기는 데이터는 userId와 password 이다. 서버로 데이터를 넘기면 json 데이터를 받아와서 console에 출력하는 간단한 코드이다.</p>

<h4 id="httpclient를-defaulthttpclient로-요청">HttpClient를 DefaultHttpClient로 요청</h4>

<p>흔히 우리가 http 요청을 처리할 때 DefaultHttpClient를 사용한다. 다음 코드는 HttpClient를 DefaultHttpClient로 사용하는 예제이다.
여기서 urlString은 여러분들이 테스트하는 ip를 입력하면 된다. 공유기로 사설네트워크에서 테스트를 진행했기 때문에 현재 맥북프로의 http 서버 ip는 192.168.1.101 이다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;saltfactory.net&quot;</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Called when the activity is first created.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>

        <span class="n">Button</span> <span class="n">buttonGet</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sf_button_post</span><span class="o">);</span>
        <span class="n">buttonGet</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>


                <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DefaultHttpClient</span><span class="o">();</span>


                        <span class="n">String</span> <span class="n">urlString</span> <span class="o">=</span> <span class="s">&quot;http://192.168.1.101/login&quot;</span><span class="o">;</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">URI</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URI</span><span class="o">(</span><span class="n">urlString</span><span class="o">);</span>

                            <span class="n">HttpPost</span> <span class="n">httpPost</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HttpPost</span><span class="o">();</span>
                            <span class="n">httpPost</span><span class="o">.</span><span class="na">setURI</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

                            <span class="n">List</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;</span> <span class="n">nameValuePairs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;(</span><span class="mi">2</span><span class="o">);</span>
                            <span class="n">nameValuePairs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">BasicNameValuePair</span><span class="o">(</span><span class="s">&quot;userId&quot;</span><span class="o">,</span> <span class="s">&quot;saltfactory&quot;</span><span class="o">));</span>
                            <span class="n">nameValuePairs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">BasicNameValuePair</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;password&quot;</span><span class="o">));</span>

                            <span class="n">httpPost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="nf">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">nameValuePairs</span><span class="o">));</span>


                            <span class="n">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpPost</span><span class="o">);</span>
                            <span class="n">String</span> <span class="n">responseString</span> <span class="o">=</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(),</span> <span class="n">HTTP</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>

                            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">responseString</span><span class="o">);</span>

                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">URISyntaxException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClientProtocolException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>

                    <span class="o">}</span>
                <span class="o">};</span>


                <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>결과는 다음과 같다. 단순하게 http요청을 DefaultHttpClient로 요청한 데이터는 POST를 정상적으로 처리하고 응답을 json으로 받아 왔다.</p>

<p><img src="http://cfile1.uf.tistory.com/image/227C383452E7798829DF8F" alt=""></p>

<p>그러면 http 요청이 아닌 https를 DefaultHttpClient로 요청하면 어떤 결과가 나타나는지 살펴보자. urlString을 <a href="http://%EC%97%90%EC%84%9C">http://에서</a> <a href="https://%EB%A1%9C">https://로</a> 변경하고 실행한다.</p>

<p><img src="http://cfile27.uf.tistory.com/image/2722EE3652E77A073327CA" alt=""></p>

<p>결과는 No Peer Certificate라는 에러를 발생시키면서 요청을 제대로 완료하지 못한다는 것을 확인할 수 있다. 왜냐면 https는 인증서를 인증하는 과정이 있어야하는데 http는 단순 http 요청만 처리하기 때문이다.</p>

<h4 id="httpclient에-sslsocketfactory-속성-추가">HttpClient에 SSLSocketFactory 속성 추가</h4>

<p>흔히 우리가 Http 요청을 할 때 사용하는 HttpClient는 DefaultHttpClient 이다. 하지만 이렇게 구현하면 Https 요청을 할 수 없다. 그래서 HttpClient에 SSLSocketFactory를 사용해서 SSL 인증을 할 수 있도록 속성을 추가한다. 먼저 SSLSocketFactory를 상속받아 다음과 같이 SSLSocketFactory를 만든다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">httpsdemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.conn.ssl.SSLSocketFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.net.ssl.SSLContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.net.ssl.TrustManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.net.ssl.X509TrustManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.UnknownHostException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.cert.CertificateException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.cert.X509Certificate</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Created by saltfactory on 1/27/14.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SFSSLSocketFactory</span> <span class="kd">extends</span> <span class="n">SSLSocketFactory</span> <span class="o">{</span>
    <span class="n">SSLContext</span> <span class="n">sslContext</span> <span class="o">=</span> <span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">SFSSLSocketFactory</span><span class="o">(</span><span class="n">KeyStore</span> <span class="n">truststore</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span> <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">UnrecoverableKeyException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">truststore</span><span class="o">);</span>

        <span class="n">TrustManager</span> <span class="n">tm</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">X509TrustManager</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkClientTrusted</span><span class="o">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="o">,</span> <span class="n">String</span> <span class="n">authType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">CertificateException</span> <span class="o">{</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkServerTrusted</span><span class="o">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="o">,</span> <span class="n">String</span> <span class="n">authType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">CertificateException</span> <span class="o">{</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="n">X509Certificate</span><span class="o">[]</span> <span class="nf">getAcceptedIssuers</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>


        <span class="o">};</span>

        <span class="n">sslContext</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="n">TrustManager</span><span class="o">[]{</span><span class="n">tm</span><span class="o">},</span> <span class="kc">null</span><span class="o">);</span>
<span class="c1">//        sslContext.init(null, new TrustManager[] { tm }, new SecureRandom());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Socket</span> <span class="nf">createSocket</span><span class="o">(</span><span class="n">Socket</span> <span class="n">socket</span><span class="o">,</span> <span class="n">String</span> <span class="n">host</span><span class="o">,</span> <span class="kt">int</span> <span class="n">port</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">autoClose</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">UnknownHostException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sslContext</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">().</span><span class="na">createSocket</span><span class="o">(</span><span class="n">socket</span><span class="o">,</span> <span class="n">host</span><span class="o">,</span> <span class="n">port</span><span class="o">,</span> <span class="n">autoClose</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Socket</span> <span class="nf">createSocket</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sslContext</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">().</span><span class="na">createSocket</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>다음은 https를 요청하기 위해서 DefaultHttpClient를 생성한 곳에 다음과 같이 수정한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">httpsdemo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpVersion</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.HttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.entity.UrlEncodedFormEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.conn.ClientConnectionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.conn.scheme.PlainSocketFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.conn.scheme.Scheme</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.conn.scheme.SchemeRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.conn.ssl.SSLSocketFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.DefaultHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.params.BasicHttpParams</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.params.HttpParams</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.params.HttpProtocolParams</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.protocol.HTTP</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URI</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URISyntaxException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.KeyStore</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;saltfactory.net&quot;</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Called when the activity is first created.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>

        <span class="n">Button</span> <span class="n">buttonGet</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sf_button_post</span><span class="o">);</span>
        <span class="n">buttonGet</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>


                <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="c1">//HttpClient HttpClient = new DefaultHttpClient();</span>
                        <span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="n">getHttpClient</span><span class="o">();</span>


                        <span class="n">String</span> <span class="n">urlString</span> <span class="o">=</span> <span class="s">&quot;https://192.168.1.101/login&quot;</span><span class="o">;</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">URI</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URI</span><span class="o">(</span><span class="n">urlString</span><span class="o">);</span>

                            <span class="n">HttpPost</span> <span class="n">httpPost</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HttpPost</span><span class="o">();</span>
                            <span class="n">httpPost</span><span class="o">.</span><span class="na">setURI</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

                            <span class="n">List</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;</span> <span class="n">nameValuePairs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;(</span><span class="mi">2</span><span class="o">);</span>
                            <span class="n">nameValuePairs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">BasicNameValuePair</span><span class="o">(</span><span class="s">&quot;userId&quot;</span><span class="o">,</span> <span class="s">&quot;saltfactory&quot;</span><span class="o">));</span>
                            <span class="n">nameValuePairs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">BasicNameValuePair</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;password&quot;</span><span class="o">));</span>

                            <span class="n">httpPost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="nf">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">nameValuePairs</span><span class="o">));</span>


                            <span class="n">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpPost</span><span class="o">);</span>
                            <span class="n">String</span> <span class="n">responseString</span> <span class="o">=</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(),</span> <span class="n">HTTP</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>

                            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">responseString</span><span class="o">);</span>

                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">URISyntaxException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClientProtocolException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>

                    <span class="o">}</span>
                <span class="o">};</span>

                <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>


    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">HttpClient</span> <span class="nf">getHttpClient</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">KeyStore</span> <span class="n">trustStore</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getDefaultType</span><span class="o">());</span>
            <span class="n">trustStore</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

            <span class="n">SSLSocketFactory</span> <span class="n">sf</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SFSSLSocketFactory</span><span class="o">(</span><span class="n">trustStore</span><span class="o">);</span>
            <span class="n">sf</span><span class="o">.</span><span class="na">setHostnameVerifier</span><span class="o">(</span><span class="n">SSLSocketFactory</span><span class="o">.</span><span class="na">ALLOW_ALL_HOSTNAME_VERIFIER</span><span class="o">);</span>

            <span class="n">HttpParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BasicHttpParams</span><span class="o">();</span>
            <span class="n">HttpProtocolParams</span><span class="o">.</span><span class="na">setVersion</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="n">HttpVersion</span><span class="o">.</span><span class="na">HTTP_1_1</span><span class="o">);</span>
            <span class="n">HttpProtocolParams</span><span class="o">.</span><span class="na">setContentCharset</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="n">HTTP</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>

            <span class="n">SchemeRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SchemeRegistry</span><span class="o">();</span>
            <span class="n">registry</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="nf">Scheme</span><span class="o">(</span><span class="s">&quot;http&quot;</span><span class="o">,</span> <span class="n">PlainSocketFactory</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">(),</span> <span class="mi">80</span><span class="o">));</span>
            <span class="n">registry</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="nf">Scheme</span><span class="o">(</span><span class="s">&quot;https&quot;</span><span class="o">,</span> <span class="n">sf</span><span class="o">,</span> <span class="mi">443</span><span class="o">));</span>

            <span class="n">ClientConnectionManager</span> <span class="n">ccm</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ThreadSafeClientConnManager</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="n">registry</span><span class="o">);</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultHttpClient</span><span class="o">(</span><span class="n">ccm</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultHttpClient</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>이렇게 코드를 SFSSLFactory를 추가해서 HttpClient에 Scheme을 두가지로 추가했다. http와 https를 처리할 수 있는 Scheme을 가지게 하였고 SSL 인증을 TLS로 HostNameVerifier를 처리하게 했다. 이제 다시 실행을 해보자.</p>

<p><img src="http://cfile2.uf.tistory.com/image/274A484752E848712B868D" alt=""></p>

<p>정상적으로 https로 데이터를 요청해서 응답을 받아 온 것을 확인할 수 있다. WireShark로 패킷을 캡쳐해보면 테스트를 진행한 안드로이드 디바이스에서 https로 요청했고 TLS로 보안 요청을 처리한 것을 확인할 수 있다.</p>

<p><img src="http://cfile3.uf.tistory.com/image/2279234252E848FA261CE4" alt=""></p>

<h3 id="httpurlconnection-사용">HttpURLConnection 사용</h3>

<p>안드로이드에서 Http 요청을 처리하는데 HttpClient를 사용하는 방법 말고 또다른 방법이 있는데 바로 HttpURLConnection을 사용하는 방법이다. 위에서 DefaultHttpClient를 사용한 코드를 다음과 같이 HttpURLConnection으로 변경한다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>

        <span class="n">Button</span> <span class="n">buttonGet</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sf_button_post</span><span class="o">);</span>
        <span class="n">buttonGet</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>


                <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
<span class="c1">//                      HttpClient HttpClient = new DefaultHttpClient();</span>


                        <span class="n">String</span> <span class="n">urlString</span> <span class="o">=</span> <span class="s">&quot;http://192.168.1.101/login&quot;</span><span class="o">;</span>
<span class="c1">//                        try {</span>
<span class="c1">//                            URI url = new URI(urlString);</span>
<span class="c1">//</span>
<span class="c1">//                            HttpPost httpPost = new HttpPost();</span>
<span class="c1">//                            httpPost.setURI(url);</span>
<span class="c1">//</span>
<span class="c1">//                            List&lt;BasicNameValuePair&gt; nameValuePairs = new ArrayList&lt;BasicNameValuePair&gt;(2);</span>
<span class="c1">//                            nameValuePairs.add(new BasicNameValuePair(&quot;userId&quot;, &quot;saltfactory&quot;));</span>
<span class="c1">//                            nameValuePairs.add(new BasicNameValuePair(&quot;password&quot;, &quot;password&quot;));</span>
<span class="c1">//</span>
<span class="c1">//                            httpPost.setEntity(new UrlEncodedFormEntity(nameValuePairs));</span>
<span class="c1">//</span>
<span class="c1">//</span>
<span class="c1">//                            HttpResponse response = httpClient.execute(httpPost);</span>
<span class="c1">//                            String responseString = EntityUtils.toString(response.getEntity(), HTTP.UTF_8);</span>
<span class="c1">//</span>
<span class="c1">//                            Log.d(TAG, responseString);</span>
<span class="c1">//</span>
<span class="c1">//                        } catch (URISyntaxException e) {</span>
<span class="c1">//                            Log.e(TAG, e.getLocalizedMessage());</span>
<span class="c1">//                            e.printStackTrace();</span>
<span class="c1">//                        } catch (ClientProtocolException e) {</span>
<span class="c1">//                            Log.e(TAG, e.getLocalizedMessage());</span>
<span class="c1">//                            e.printStackTrace();</span>
<span class="c1">//                        } catch (IOException e) {</span>
<span class="c1">//                            Log.e(TAG, e.getLocalizedMessage());</span>
<span class="c1">//                            e.printStackTrace();</span>
<span class="c1">//                        }</span>
<span class="c1">//</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="n">urlString</span><span class="o">);</span>

                            <span class="n">HttpURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
                            <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
                            <span class="n">connection</span><span class="o">.</span><span class="na">setDoInput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                            <span class="n">connection</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

                            <span class="n">List</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;</span> <span class="n">nameValuePairs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;(</span><span class="mi">2</span><span class="o">);</span>
                            <span class="n">nameValuePairs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">BasicNameValuePair</span><span class="o">(</span><span class="s">&quot;userId&quot;</span><span class="o">,</span> <span class="s">&quot;saltfactory&quot;</span><span class="o">));</span>
                            <span class="n">nameValuePairs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">BasicNameValuePair</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;password&quot;</span><span class="o">));</span>

                            <span class="n">OutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                            <span class="n">BufferedWriter</span> <span class="n">bufferedWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="nf">OutputStreamWriter</span><span class="o">(</span><span class="n">outputStream</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">));</span>
                            <span class="n">bufferedWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">getURLQuery</span><span class="o">(</span><span class="n">nameValuePairs</span><span class="o">));</span>
                            <span class="n">bufferedWriter</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                            <span class="n">bufferedWriter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                            <span class="n">outputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

                            <span class="n">connection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>


                            <span class="n">StringBuilder</span> <span class="n">responseStringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="o">();</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">==</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">){</span>
                                <span class="n">BufferedReader</span> <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nf">InputStreamReader</span><span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
                                <span class="k">for</span> <span class="o">(;;){</span>
                                    <span class="n">String</span> <span class="n">stringLine</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                    <span class="k">if</span> <span class="o">(</span><span class="n">stringLine</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="k">break</span><span class="o">;</span>
                                    <span class="n">responseStringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">stringLine</span> <span class="o">+</span> <span class="sc">&#39;\n&#39;</span><span class="o">);</span>
                                <span class="o">}</span>
                                <span class="n">bufferedReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                            <span class="o">}</span>

                            <span class="n">connection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>

                            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">responseStringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>



                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>


                    <span class="o">}</span>
                <span class="o">};</span>

                <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getURLQuery</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BasicNameValuePair</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">){</span>
        <span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">first</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">BasicNameValuePair</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">params</span><span class="o">)</span>
        <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">)</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="k">else</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&amp;&quot;</span><span class="o">);</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">));</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;=&quot;</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getValue</span><span class="o">(),</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">));</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">stringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div>
<p>디바이스에서 실행을 해보자. 앞에서 HttpClient에 DefaultHttpClient로 요청한 결과를 HttpURLConnection으로 동일하게 받을 수 있는 것을 확인할 수 있다.</p>

<p><img src="http://cfile30.uf.tistory.com/image/2525A03C52E84E7E1A0DEC" alt=""></p>

<h3 id="httpsurlconnection을-사용하기">HttpsURLConnection을 사용하기</h3>

<p>앞에서 살펴봤듯 안드로이드에서 http요청을 HttpClient를 사용하는 대신에 HttpURLConnection을 사용하듯, Https를 요청하는 방법은 HttpClient를 SSLSocketFactory를 사용하는 방법 말고도 HttpsURLConnection을 이용하는 방법이 있다. 위의 HttpURLConnection을 사용한 코드를 다음과 같이 수정한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">package</span> <span class="nx">net</span><span class="p">.</span><span class="nx">saltfactory</span><span class="p">.</span><span class="nx">tutorial</span><span class="p">.</span><span class="nx">httpsdemo</span><span class="p">;</span>

<span class="kr">import</span> <span class="nx">android</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">Activity</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">android</span><span class="p">.</span><span class="nx">os</span><span class="p">.</span><span class="nx">Bundle</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">android</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Log</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">android</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">View</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">android</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">Button</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">HttpResponse</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">HttpVersion</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">ClientProtocolException</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">HttpClient</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">UrlEncodedFormEntity</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">HttpGet</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">HttpPost</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">ClientConnectionManager</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">scheme</span><span class="p">.</span><span class="nx">PlainSocketFactory</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">scheme</span><span class="p">.</span><span class="nx">Scheme</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">scheme</span><span class="p">.</span><span class="nx">SchemeRegistry</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">ssl</span><span class="p">.</span><span class="nx">SSLSocketFactory</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">impl</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">DefaultHttpClient</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">impl</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">tsccm</span><span class="p">.</span><span class="nx">ThreadSafeClientConnManager</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">BasicNameValuePair</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">BasicHttpParams</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">HttpParams</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">HttpProtocolParams</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">protocol</span><span class="p">.</span><span class="nx">HTTP</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">EntityUtils</span><span class="p">;</span>

<span class="kr">import</span> <span class="nx">javax</span><span class="p">.</span><span class="nx">net</span><span class="p">.</span><span class="nx">ssl</span><span class="p">.</span><span class="o">*</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="o">*</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">net</span><span class="p">.</span><span class="o">*</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">KeyStore</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ArrayList</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">List</span><span class="p">;</span>

<span class="kr">public</span> <span class="kr">class</span> <span class="nx">MyActivity</span> <span class="kr">extends</span> <span class="nx">Activity</span> <span class="p">{</span>
    <span class="kr">final</span> <span class="nb">String</span> <span class="nx">TAG</span> <span class="o">=</span> <span class="s2">&quot;saltfactory.net&quot;</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Called when the activity is first created.</span>
<span class="cm">     */</span>
    <span class="err">@</span><span class="nx">Override</span>
    <span class="kr">public</span> <span class="k">void</span> <span class="nx">onCreate</span><span class="p">(</span><span class="nx">Bundle</span> <span class="nx">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">.</span><span class="nx">onCreate</span><span class="p">(</span><span class="nx">savedInstanceState</span><span class="p">);</span>
        <span class="nx">setContentView</span><span class="p">(</span><span class="nx">R</span><span class="p">.</span><span class="nx">layout</span><span class="p">.</span><span class="nx">main</span><span class="p">);</span>

        <span class="nx">Button</span> <span class="nx">buttonGet</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Button</span><span class="p">)</span> <span class="nx">findViewById</span><span class="p">(</span><span class="nx">R</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">sf_button_post</span><span class="p">);</span>
        <span class="nx">buttonGet</span><span class="p">.</span><span class="nx">setOnClickListener</span><span class="p">(</span><span class="k">new</span> <span class="nx">View</span><span class="p">.</span><span class="nx">OnClickListener</span><span class="p">()</span> <span class="p">{</span>
            <span class="err">@</span><span class="nx">Override</span>
            <span class="kr">public</span> <span class="k">void</span> <span class="nx">onClick</span><span class="p">(</span><span class="nx">View</span> <span class="nx">view</span><span class="p">)</span> <span class="p">{</span>


                <span class="nx">Thread</span> <span class="nx">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thread</span><span class="p">()</span> <span class="p">{</span>
                    <span class="err">@</span><span class="nx">Override</span>
                    <span class="kr">public</span> <span class="k">void</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
                        <span class="c1">//HttpClient HttpClient = new DefaultHttpClient();</span>
<span class="c1">//                        HttpClient httpClient = getHttpClient();</span>

                        <span class="nb">String</span> <span class="nx">urlString</span> <span class="o">=</span> <span class="s2">&quot;https://192.168.1.101/login&quot;</span><span class="p">;</span>

                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">URL</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">urlString</span><span class="p">);</span>

<span class="c1">//                            HttpURLConnection connection = (HttpURLConnection) url.openConnection();</span>

                            <span class="nx">trustAllHosts</span><span class="p">();</span>

                            <span class="nx">HttpsURLConnection</span> <span class="nx">httpsURLConnection</span> <span class="o">=</span> <span class="p">(</span><span class="nx">HttpsURLConnection</span><span class="p">)</span> <span class="nx">url</span><span class="p">.</span><span class="nx">openConnection</span><span class="p">();</span>
                            <span class="nx">httpsURLConnection</span><span class="p">.</span><span class="nx">setHostnameVerifier</span><span class="p">(</span><span class="k">new</span> <span class="nx">HostnameVerifier</span><span class="p">()</span> <span class="p">{</span>
                                <span class="err">@</span><span class="nx">Override</span>
                                <span class="kr">public</span> <span class="kr">boolean</span> <span class="nx">verify</span><span class="p">(</span><span class="nb">String</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">SSLSession</span> <span class="nx">sslSession</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                                <span class="p">}</span>
                            <span class="p">});</span>

                            <span class="nx">HttpURLConnection</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">httpsURLConnection</span><span class="p">;</span>

                            <span class="nx">connection</span><span class="p">.</span><span class="nx">setRequestMethod</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">);</span>
                            <span class="nx">connection</span><span class="p">.</span><span class="nx">setDoInput</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                            <span class="nx">connection</span><span class="p">.</span><span class="nx">setDoOutput</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

                            <span class="nx">List</span><span class="o">&lt;</span><span class="nx">BasicNameValuePair</span><span class="o">&gt;</span> <span class="nx">nameValuePairs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayList</span><span class="o">&lt;</span><span class="nx">BasicNameValuePair</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
                            <span class="nx">nameValuePairs</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">BasicNameValuePair</span><span class="p">(</span><span class="s2">&quot;userId&quot;</span><span class="p">,</span> <span class="s2">&quot;saltfactory&quot;</span><span class="p">));</span>
                            <span class="nx">nameValuePairs</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">BasicNameValuePair</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">));</span>

                            <span class="nx">OutputStream</span> <span class="nx">outputStream</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getOutputStream</span><span class="p">();</span>
                            <span class="nx">BufferedWriter</span> <span class="nx">bufferedWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BufferedWriter</span><span class="p">(</span><span class="k">new</span> <span class="nx">OutputStreamWriter</span><span class="p">(</span><span class="nx">outputStream</span><span class="p">,</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">));</span>
                            <span class="nx">bufferedWriter</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">getURLQuery</span><span class="p">(</span><span class="nx">nameValuePairs</span><span class="p">));</span>
                            <span class="nx">bufferedWriter</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
                            <span class="nx">bufferedWriter</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
                            <span class="nx">outputStream</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

                            <span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>


                            <span class="nx">StringBuilder</span> <span class="nx">responseStringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StringBuilder</span><span class="p">();</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">getResponseCode</span><span class="p">()</span> <span class="o">==</span> <span class="nx">HttpURLConnection</span><span class="p">.</span><span class="nx">HTTP_OK</span><span class="p">){</span>
                                <span class="nx">BufferedReader</span> <span class="nx">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BufferedReader</span><span class="p">(</span><span class="k">new</span> <span class="nx">InputStreamReader</span><span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">getInputStream</span><span class="p">()));</span>
                                <span class="k">for</span> <span class="p">(;;){</span>
                                    <span class="nb">String</span> <span class="nx">stringLine</span> <span class="o">=</span> <span class="nx">bufferedReader</span><span class="p">.</span><span class="nx">readLine</span><span class="p">();</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">stringLine</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
                                    <span class="nx">responseStringBuilder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">stringLine</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">);</span>
                                <span class="p">}</span>
                                <span class="nx">bufferedReader</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
                            <span class="p">}</span>

                            <span class="nx">connection</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>

                            <span class="nx">Log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">TAG</span><span class="p">,</span> <span class="nx">responseStringBuilder</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>



                        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">MalformedURLException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
                        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">IOException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
                        <span class="p">}</span>


                    <span class="p">}</span>
                <span class="p">};</span>

                <span class="nx">thread</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">});</span>

    <span class="p">}</span>

    <span class="kr">private</span> <span class="kr">static</span> <span class="k">void</span> <span class="nx">trustAllHosts</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Create a trust manager that does not validate certificate chains</span>
        <span class="nx">TrustManager</span><span class="p">[]</span> <span class="nx">trustAllCerts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TrustManager</span><span class="p">[]{</span><span class="k">new</span> <span class="nx">X509TrustManager</span><span class="p">()</span> <span class="p">{</span>
            <span class="kr">public</span> <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">cert</span><span class="p">.</span><span class="nx">X509Certificate</span><span class="p">[]</span> <span class="nx">getAcceptedIssuers</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">cert</span><span class="p">.</span><span class="nx">X509Certificate</span><span class="p">[]{};</span>
            <span class="p">}</span>

            <span class="err">@</span><span class="nx">Override</span>
            <span class="kr">public</span> <span class="k">void</span> <span class="nx">checkClientTrusted</span><span class="p">(</span>
                    <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">cert</span><span class="p">.</span><span class="nx">X509Certificate</span><span class="p">[]</span> <span class="nx">chain</span><span class="p">,</span>
                    <span class="nb">String</span> <span class="nx">authType</span><span class="p">)</span>
                    <span class="kr">throws</span> <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">cert</span><span class="p">.</span><span class="nx">CertificateException</span> <span class="p">{</span>
                <span class="c1">// TODO Auto-generated method stub</span>

            <span class="p">}</span>

            <span class="err">@</span><span class="nx">Override</span>
            <span class="kr">public</span> <span class="k">void</span> <span class="nx">checkServerTrusted</span><span class="p">(</span>
                    <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">cert</span><span class="p">.</span><span class="nx">X509Certificate</span><span class="p">[]</span> <span class="nx">chain</span><span class="p">,</span>
                    <span class="nb">String</span> <span class="nx">authType</span><span class="p">)</span>
                    <span class="kr">throws</span> <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">cert</span><span class="p">.</span><span class="nx">CertificateException</span> <span class="p">{</span>
                <span class="c1">// TODO Auto-generated method stub</span>

            <span class="p">}</span>
        <span class="p">}};</span>

        <span class="c1">// Install the all-trusting trust manager</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">SSLContext</span> <span class="nx">sc</span> <span class="o">=</span> <span class="nx">SSLContext</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">(</span><span class="s2">&quot;TLS&quot;</span><span class="p">);</span>
            <span class="nx">sc</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">trustAllCerts</span><span class="p">,</span> <span class="k">new</span> <span class="nx">java</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">SecureRandom</span><span class="p">());</span>
            <span class="nx">HttpsURLConnection</span>
                    <span class="p">.</span><span class="nx">setDefaultSSLSocketFactory</span><span class="p">(</span><span class="nx">sc</span><span class="p">.</span><span class="nx">getSocketFactory</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="nb">String</span> <span class="nx">getURLQuery</span><span class="p">(</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">BasicNameValuePair</span><span class="o">&gt;</span> <span class="nx">params</span><span class="p">){</span>
        <span class="nx">StringBuilder</span> <span class="nx">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StringBuilder</span><span class="p">();</span>
        <span class="kr">boolean</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">BasicNameValuePair</span> <span class="nx">pair</span> <span class="o">:</span> <span class="nx">params</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">)</span>
                <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">);</span>

            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">URLEncoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">getName</span><span class="p">(),</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">));</span>
                <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">);</span>
                <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">URLEncoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(),</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">UnsupportedEncodingException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">printStackTrace</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="p">}</span>


<span class="p">}</span>
</code></pre></div>
<p>이제 디바이스에서 실행을 해보자. 다음과 같이 HttpURLConnection을 실행한 결과와 동일하게 동작하는 것을 확인 할 수 있다.</p>

<p><img src="http://cfile30.uf.tistory.com/image/2525A03C52E84E7E1A0DEC" alt=""></p>

<h2 id="결론">결론</h2>

<p>우리는 안드로이드 앱을 개발할 때 Http 요청을 HttpClient를 사용했다. 그리고 DefaultHttpClient를 사용해서 POST나 GET 요청을 했는데 Http 요청은  HttpURLConnection으로도 할 수 있다는 것을 확인 했다. 하지만 Https는 DefaultHttpClient와 HttpURLConnection을 사용할 수 없다. 이유는 인증처리하는 속성이 있어야하는데 DefaultHttpClient와 HttpURLConnection은 SSL 인증 처리가 없기 때문이다. 그래서 HttpClient에 SSLSocketFactory를 사용했고 HttpURLConnection을 HttpsURLConnection으로 사용해서 인증처리 속성을 가지게 할 수 있다는 것을 확인했다.</p>

<h2 id="소스코드">소스코드</h2>

<ul>
<li><a href="https://github.com/saltfactory/saltfactory-android-tutorial/tree/sf-https-demo">https://github.com/saltfactory/saltfactory-android-tutorial/tree/sf-https-demo</a></li>
</ul>

<h2 id="참고">참고</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/9767952/how-to-add-parameters-to-httpurlconnection-using-post">http://stackoverflow.com/questions/9767952/how-to-add-parameters-to-httpurlconnection-using-post</a></li>
<li><a href="http://cafe.naver.com/jzsdn/21091">http://cafe.naver.com/jzsdn/21091</a></li>
<li><a href="http://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https">http://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https</a></li>
</ol>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  
  
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactorynet';
    
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <!-- <h2 class="footer-heading">saltfactory's series</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li><a href="http://saltfactory.net">www.saltfactory.net</a></li>
        <li><a href="http://blog.saltfactory.net">blog.saltfactory.net</a></li>
        <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/saltfactory">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
  c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
  c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
  c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
  C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
  c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
  c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
  c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
  c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://twitter.com/saltfactory">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
  <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
  c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
  c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
  C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
  c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
  c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
</svg>

            </span>
            <span class="username">saltfactory</span>
          </a>
        </li>

        <li>
          <a href="https://facebook.com/saltfactory">
            <span class="icon facebook">
          		<svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
		
        	</span>
        	<span class="username">salthub</span>
			</a>
        </li>

      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text"></p>
    </div>

  </div>

</footer>


	<script src="/series/assets/javascripts/jekyll-img-converter.js"></script>
    </body>
</html>
