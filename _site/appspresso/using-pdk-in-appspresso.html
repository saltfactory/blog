<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Appspresso를 사용하여 하이브리드앱 개발하기 - 5.PDK(Plugin Development Kit)를 이용하여 네이티브 코드 사용</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="/appspresso/using-pdk-in-appspresso.html">
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="/assets/foaf.rdf" />

    

    
      <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-8647285-2', 'auto');
ga('send', 'pageview');
</script>

    
</head>


  <body>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">saltfactory's blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
        viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
        <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
        h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
        <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
        h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
        <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
        c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
      </svg>
    </a>
    <div class="trigger">
      <!-- <a class="page-link" href="http://saltfactory.net">saltfactory.net</a> -->
      <!--
      
      <a class="page-link" href="/about/">About</a>
      
      
      
      
      
      
      
      <a class="page-link" href="/categories/">Categories</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a class="page-link" href="/guestbook/">Guestbook</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a class="page-link" href="/categories/ruby/">Articles by category: ruby</a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      -->

      <a class="page-link" href="/about/">About</a>
      <a class="page-link" href="/categories/">Categories</a>
      <a class="page-link" href="/guestbook/">GuestBook</a>
    </div>

    </nav>
    <script>
(function() {
  var cx = '014516175331458470005:ze8dwrrwnac';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
  '//cse.google.com/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
</script>
<gcse:search></gcse:search>

</div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Appspresso를 사용하여 하이브리드앱 개발하기 - 5.PDK(Plugin Development Kit)를 이용하여 네이티브 코드 사용</h1>
    <p class="post-meta">Apr 30, 2012</p>
  </header>

  <article class="post-content">
    <h2 id="서론">서론</h2>

<p>이번 포스팅은 두가지 관점에서 포스팅을 한다. 하나는 앞에서 사용한 ax.ext.net 대신에 네이티브코드로 원격 데이터를 요청하는 것이고 다른 하나는 Appspresso에서 Native Code를 사용하는 것이다. Hybrid의 최고의 약점은 바로 브라우저에 내장되어 있는 javascript 엔진이다. 사실 그 성능에 대해서는 정확한 벤치마킹이 있어야하지만 보통 네이티브에서 처리하는 것이 webkit의 자바스크립트로 처리하는 것보다 성능이 좋다고 알려져 있다. 이러한 이유로 하이브리드 앱에서 성능이 요구되는 일은 네이티브 프로그램으로 처리하길 원하게 될 것이다. 그래서 Appspresso에서 네이티브 코드를 사용할 수 있게 하는 PDK (Plugin Development Kit)을 어떻게 사용할 수 있는냐는 것을 바탕으로 이전에 포스팅한 예제를 ax.ext.net 플러그인 대신에 네이티브 코드로 URL을 요청을 하는 방법에 대해서 포스팅 한다.</p>

<!--more-->

<h2 id="pdk(plugin-development-kit)">PDK(Plugin Development Kit)</h2>

<p>모바일 브라우저가 아닌 네이티브 코드로 프로그램을 실행시키고 싶을 경우가 있다. 네이티브 코드가 가지는 빠른 퍼포먼스와 C 라이브러리를 사용할 수 있기 때문에 하이브리드 앱을 만들 때 네이티브 코드를 재사용하거나 무거운 처리를 Objective-C로 처리하는 경우가 좋을 때도 있기 때문이다. ajax의 cross domain 문제도 NSURLConnection을 이용해서 URL 요청을 할 수 있다. ax.ext.net을 사용할 때 보다 복잡한 과정이 필요하다. 하지만 꼭 URL 요청 문제가 아니라 네이티브 프로그램을 어떻게 사용할 수 있는지 경험할 수 있을거라 예상한다. Appsresso에서는 네이티브코드 iOS에서 사용하는 Objective-C나 Android에 사용하는 Java를 플러그인으로 사용하여 연결하도록 하는데 Appspresso Plugin Development Kit (PDK) 로 만들 수 있다.</p>

<p>Appspresso의 workspace에 다른 Plugin Project를 생성한다.</p>

<p><img src="http://cfile30.uf.tistory.com/image/130D2E404F9E3DCD187DE6" alt=""></p>

<p>새로운 Plugin 프로젝트를 만들때 Project Name을 입력하고 나중에 plugin의 유일한 식별을 하기 위해서 ID를 지정하고 버전 정보를 입력한다.</p>

<p><img src="http://cfile4.uf.tistory.com/image/1642853D4F9E3F6F150987" alt=""></p>

<p>다음은 iOS 버전의 네이티브 모듈 plugin을 만들 것인지, Android 네이티브 모듈 plugin을 만들 것인지 선택을 한다. 두가지 모두 선택하면 두가지 모듈 프로젝트가 workspace에 추가된다.</p>

<p><img src="http://cfile23.uf.tistory.com/image/1537FD3D4F9E3F6F2058F2" alt=""></p>

<p>첫번재로 Android 모듈을 설정하는 화면이다. plugin project에서 새로운 module project를 사용하게 되는데 이때 안드로이드 버전의 모듈 프로젝트를 생성한다.</p>

<p><img src="http://cfile25.uf.tistory.com/image/133DA53D4F9E3F6F25EE4C" alt=""></p>

<p>안드로이드 모듈에서 사용될 메인 클래스를 지정한다. 이름은 어떻게 주어지든 상관 없지만 인식의 편리를 위해서 plugin을 만들 때 사용한 ID를 기반으로 메인 클래스 이름을 만들었다. 그리고 Android SDK의 레벨을 지정한다.</p>

<p><img src="http://cfile7.uf.tistory.com/image/18426D3D4F9E3F6E1507C9" alt=""></p>

<p>우리는 위에서 Android와 iOS 두가지 모듈 모두를 사용하는 plugin을 만든다고 체크하였기 때문에 이번에는 iOS 모듈을 설정하는 화면이 나타난다.</p>

<p><img src="http://cfile1.uf.tistory.com/image/1440D23D4F9E3F701756C0" alt=""></p>

<p>안드로이드 모듈의 메인클리스와 달리 iOS에서는 네이밍 규칙에 클래스 파일에 .을 사용하기 보다 다음과 같이 사용하기 때문에 다음과 같은 형태로 자동으로 만들어진다.</p>

<p><img src="http://cfile7.uf.tistory.com/image/1445583D4F9E3F6E0F6975" alt=""></p>

<p>이렇게 plugin project를 생성하고 각가의 네이티브 서브 모듈들을 설정하면 다음과 같이 workspace에 plugin project와 Android Module Project, iOS Module Project를 생성할 거라는 요약정보를 알려준다.</p>

<p><img src="http://cfile9.uf.tistory.com/image/163E8C3F4F9E3F6D31DD3C" alt=""></p>

<p>이렇게 plugin project를 생성하는 과정이 끝나면 현재 열려져 있는 workspaces에 다음과 같이 Application Project, Plugin Project, android Module Project, iOS Module Project 총 4가지 프로젝트가 존재하게 된다.</p>

<p><img src="http://cfile8.uf.tistory.com/image/182B69364F9E4309032AD7" alt=""></p>

<p>그런데 잘 살펴보면 Android Module Project 에 에러가 발생한 것을 볼 수 있다. 이유는 Java SDK나 JRE가 연결되지 못해서 그런것이기 때문에 Android Module Project를 선택하고 오른쪽 마우스를 클릭해서 build Path &gt; Configure build path를 선택하여 JRE를 연결한다.</p>

<p><img src="http://cfile9.uf.tistory.com/image/137208374F9E43D7075715" alt=""></p>

<p><img src="http://cfile27.uf.tistory.com/image/205AC83F4F9E3F6C016F54" alt=""></p>

<p><img src="http://cfile25.uf.tistory.com/image/16471D3F4F9E3F6B236418" alt=""></p>

<p><img src="http://cfile25.uf.tistory.com/image/134C483F4F9E3F6B1BDF36" alt=""></p>

<p><img src="http://cfile10.uf.tistory.com/image/1152933F4F9E3F6B122E8C" alt=""></p>

<p>이렇게 JRE를 설정해주면 에러가 났던 문제는 해결이 된다.</p>

<p>이젠 Application Project에서 어떻게하면 PDK로 만든 사용자가 새롭게 만든 plugin을 사용할 수 있느냐는 것이다. Application Project에서 project.xml 파일을 연다. 그리고 common 이라는 탭에서 plugin을 관리하는 패널이 나타나는데, 여기서 Add Plugin Project 버턴을 선택하여 방금 생성한 plugin project의 폴더를 지정한다.</p>

<p><img src="http://cfile24.uf.tistory.com/image/193E3C3F4F9E3F6A32B2FE" alt=""></p>

<p>이제 plugin project를 만들고 Application Project에서 사용자가 생성한 plugin을 사용할 모든 준비를 마쳤다.
이젠 코드를 실행시켜보자. 아마 샘플로 만들어진 코드는 message를 echo하는 소스코드가 샘플로 만들어질 것이다. 아래 코드는 plugin project에 들어있는 axplugin.js 의 파일이다. 여기서 feature id에 plugin을 만들었을 때 사용하던 id를 입력시킨다. Appspresso는 WAC 를 사용하여 디바이스의 API에 접근을 할 수 있는데 echoSync와 echoAsync에 사용하는 this.execSync와 this.execAsync를 네이티브 코드로 call by name 으로 context를 호출하고 데이터를 처리하는 과정을 거친다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/*</span>
<span class="cm"> * JavaScript Stub Appspresso Plugin</span>
<span class="cm"> *</span>
<span class="cm"> * id: net.saltfactory.hybridtutorial.urlplugin</span>
<span class="cm"> * version: 1.0.0</span>
<span class="cm"> * feature: &lt;feature id=&quot;net.saltfactory.hybridtutorial.urlplugin&quot; category=&quot;Custom&quot; /&gt;</span>
<span class="cm"> */</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">function</span> <span class="nx">echoSync</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">ax</span><span class="p">.</span><span class="nx">INVALID_VALUES_ERR</span><span class="p">,</span> <span class="s1">&#39;invalid argument!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">execSync</span><span class="p">(</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="nx">message</span><span class="o">||</span><span class="s1">&#39;&#39;</span> <span class="p">]);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">echoAsync</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">errback</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">ax</span><span class="p">.</span><span class="nx">INVALID_VALUES_ERR</span><span class="p">,</span> <span class="s1">&#39;invalid argument!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">execAsync</span><span class="p">(</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">errback</span><span class="p">,</span> <span class="p">[</span> <span class="nx">message</span><span class="o">||</span><span class="s1">&#39;&#39;</span> <span class="p">]);</span>
    <span class="p">}</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">myplugin</span> <span class="o">=</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">&#39;net.saltfactory.hybridtutorial.urlplugin&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;echoSync&#39;</span><span class="o">:</span> <span class="nx">echoSync</span><span class="p">,</span>
        <span class="s1">&#39;echoAsync&#39;</span><span class="o">:</span> <span class="nx">echoAsync</span>
    <span class="p">});</span>
<span class="p">})();</span>
</code></pre></div>
<p>아래 파일은 axplugin.js에서 execSync나 execAsync로 호출해서 실제 네이티브 코드인 Objective-C 안에서 처리하는 소스 코드인다. -execute: 메소드를 호출하게 되는데 이때 execSyc나 execAysnc에서 요청한 context에서 메소드 이름을 가지고 처리를 한 후에 다시 context의 -sendResult:나 -sendError:를 사용하여 axplugin.js에 정의된 callback 메소드에게 결과를 메세지로 보내게 된다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  net_saltfactory_hybridtutorial_urlplugin_MyPlugin.m</span>
<span class="c1">//</span>
<span class="c1">//  Copyright 2011 none. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &quot;AxRuntimeContext.h&quot;</span>
<span class="cp">#import &quot;AxPluginContext.h&quot;</span>
<span class="cp">#import &quot;AxError.h&quot;</span>
<span class="cp">#import &quot;net_saltfactory_hybridtutorial_urlplugin_MyPlugin.h&quot;</span>


<span class="k">@implementation</span> <span class="nc">net_saltfactory_hybridtutorial_urlplugin_MyPlugin</span>

<span class="k">@synthesize</span> <span class="n">runtimeContext</span> <span class="o">=</span> <span class="n">_runtimeContext</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">activate:</span><span class="p">(</span><span class="bp">NSObject</span><span class="o">&lt;</span><span class="n">AxRuntimeContext</span><span class="o">&gt;*</span><span class="p">)</span><span class="nv">runtimeContext</span> <span class="p">{</span>
    <span class="n">_runtimeContext</span> <span class="o">=</span> <span class="p">[</span><span class="n">runtimeContext</span> <span class="k">retain</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">deactivate:</span><span class="p">(</span><span class="bp">NSObject</span><span class="o">&lt;</span><span class="n">AxRuntimeContext</span><span class="o">&gt;*</span><span class="p">)</span><span class="nv">runtimeContext</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">_runtimeContext</span> <span class="k">release</span><span class="p">];</span>
    <span class="n">_runtimeContext</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">execute:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">AxPluginContext</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">context</span> <span class="p">{</span>
    <span class="bp">NSString</span><span class="o">*</span> <span class="n">method</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span> <span class="n">getMethod</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">method</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;echo&quot;</span><span class="p">])</span> <span class="p">{</span>
        <span class="bp">NSString</span><span class="o">*</span> <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span> <span class="nl">getParamAsString</span><span class="p">:(</span><span class="mi">0</span><span class="p">)];</span>
        <span class="p">[</span><span class="n">context</span> <span class="nl">sendResult</span><span class="p">:(</span><span class="n">message</span><span class="p">)];</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">context</span> <span class="nl">sendError</span><span class="p">:(</span><span class="n">AX_NOT_AVAILABLE_ERR</span><span class="p">)];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>아래는 Android module project의 net.saltfactory.hybridtutorial.urlplugin.MyPlugin 클래스이고 동작 방법은 iOS의 동작 방법과 동일하거 call by name으로 처리하고 처리결과를 context에 다시 message를 보내는 방법이다.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">saltfactory</span><span class="o">.</span><span class="na">hybridtutorial</span><span class="o">.</span><span class="na">urlplugin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.appspresso.api.*</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * TODO: change package and class name.</span>
<span class="cm"> *</span>
<span class="cm"> * Appspresso Plugin Android Module</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPlugin</span> <span class="kd">implements</span> <span class="n">AxPlugin</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">AxRuntimeContext</span> <span class="n">runtimeContext</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">activate</span><span class="o">(</span><span class="n">AxRuntimeContext</span> <span class="n">runtimeContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">runtimeContext</span> <span class="o">=</span> <span class="n">runtimeContext</span><span class="o">;</span>

        <span class="c1">// TODO: addActivityListener</span>
        <span class="c1">// TODO: addWebViewListener</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="o">(</span><span class="n">AxRuntimeContext</span> <span class="n">runtimeContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">runtimeContext</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// TODO: removeActivityListener</span>
        <span class="c1">// TODO: removeWebViewListener</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">AxPluginContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="s">&quot;echo&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getParamAsString</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">context</span><span class="o">.</span><span class="na">sendResult</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="n">context</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="n">AxError</span><span class="o">.</span><span class="na">NOT_AVAILABLE_ERR</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>이렇게 네이티브 코드로 짜여진 코드는 Application Project에서 다음과 같이 코드로 실행할 수 있다. 기존의 내장 plugin을 사용했던 ax.ext.net.get 코드를 주석으로 처리하고 errorback과 echoAsync(), echoSync()를 정의하여 사용할 수 있다. 테스트를 위해서 echoSync()를 호출해보았다.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;pragma&quot;</span> <span class="na">content=</span><span class="s">&quot;no-cache&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/appspresso/appspresso.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;locale-example.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script&gt;</span>
            <span class="c1">//activate ax.log(), comment out when you release app</span>
            <span class="nx">ax</span><span class="p">.</span><span class="nx">runMode</span> <span class="o">=</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">MODE_DEBUG</span><span class="p">;</span>
            <span class="nx">ax</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">);</span>

<span class="cm">/*          ax.ext.net.get(&#39;http://search.twitter.com/search.json?q=saltfactory&#39;,</span>
<span class="cm">                    function(response){</span>
<span class="cm">                        var json = JSON.parse(response.data);</span>
<span class="cm">                        var text = json.results[0].text;</span>
<span class="cm">                        ax.log(text);</span>
<span class="cm">                        document.getElementById(&quot;text&quot;).innerHTML = text;</span>
<span class="cm">                    },</span>
<span class="cm">                    function(erorr){</span>
<span class="cm">                        ax.log(error);</span>
<span class="cm">                    },</span>
<span class="cm">                    &#39;utf-8&#39;);  */</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://search.twitter.com/search.json?q=appspresso&#39;</span><span class="p">;</span>

                    <span class="kd">function</span> <span class="nx">errback</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="kd">function</span> <span class="nx">echoAsync</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">myplugin</span><span class="p">.</span><span class="nx">echoAsync</span><span class="p">(</span>
                            <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                            <span class="p">},</span> <span class="nx">errback</span><span class="p">,</span> <span class="s2">&quot;call myplugin.echoAsync()&quot;</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="kd">function</span> <span class="nx">echoSync</span><span class="p">()</span> <span class="p">{</span>

                        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">myplugin</span><span class="p">.</span><span class="nx">echoSync</span><span class="p">(</span><span class="s2">&quot;call myplugin.echoSync()&quot;</span><span class="p">);</span>
                        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="nx">echoSync</span><span class="p">();</span>

 <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
            <span class="nf">#text</span> <span class="p">{</span>
                <span class="k">color</span><span class="o">:</span><span class="nb">blue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;h3&gt;</span>net.saltfactory.hybridtutorial<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">        /platforms            ... Metafile, icon, application name FOR PLATFORM(Android, iOS, ...)</span>
<span class="c">        /src</span>
<span class="c">           /appspresso</span>
<span class="c">              /appspresso.js  ... AUTO-GENERATED FILE.</span>
<span class="c">           /locales           ... Directory for Localized content.</span>
<span class="c">                                  SEE ALSO, http://www.w3.org/TR/widgets/#folder-based-localization</span>
<span class="c">              /en</span>
<span class="c">                 /locale.js</span>
<span class="c">              /ko</span>
<span class="c">              /...</span>
<span class="c">           /index.html        ... this page</span>
<span class="c">           /locale-example.js ... sample javascript</span>
<span class="c">           /widget-icon.png   ... icon for widget.</span>
<span class="c">                                  IF YOU WANT TO CHANGE ICON FOR ANDROID or IOS,</span>
<span class="c">                                  YOU CAN DO IT in &#39;platforms&#39; DIRECTORY.</span>
<span class="c">        /project.xml          ... application configuration file</span>
<span class="c">         --&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p><img src="http://cfile29.uf.tistory.com/image/1760B3374F9E46C5383872" alt=""></p>

<p>우리는 좀더 wac에 대한 접근 메소드가 궁금할 수 있는데 다행히도 Appspresso 1.1 버전부터는 ADE를 지원한다. ADE에 관한 내용은 이전 포스팅을 참조하면 된다. 여기서 우리는 echoSync 메소드에 breakpoint를 걸어서 확인할 것이다. 이렇게 breakpoint를 echoSync 내부의 this를 살펴보면 javascript 객체에 prototype으로 연결이 되어 있는데 보면 execAsync, execAsyncWAC, execSync, execSyncWAC, watch, ... 등 내부 메소드를 확인할 수가 있다.</p>

<p><img src="http://cfile10.uf.tistory.com/image/173DC1384F9E4A260CE695" alt=""></p>

<h2 id="pdk를-이용하여-네이티브-코드로-원격-데이터-요청하기">PDK를 이용하여 네이티브 코드로 원격 데이터 요청하기</h2>

<p>이제 우리는 네이티브 코드를 수정해서 사용해보자. 이젠 포스트에서 ax.ext.net.get을 이용해서 원격 데이터를 가져왔는데, 이번에는 네이티브 코드로 원격데이터를 가져오도록 해보자.
우리는 이 작업을 위해서 axplugin.js에 메소드하나를 추가한다. Application Project와 Native Module 간에 연결할 수 있는 인터페이스 메소드이다. 메소드 이름은 requestURL이고 ax.plugin에 requestURL이란 key에 requestURL 메소드를 지정한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/*</span>
<span class="cm"> * JavaScript Stub Appspresso Plugin</span>
<span class="cm"> *</span>
<span class="cm"> * id: net.saltfactory.hybridtutorial.urlplugin</span>
<span class="cm"> * version: 1.0.0</span>
<span class="cm"> * feature: &lt;feature id=&quot;net.saltfactory.hybridtutorial.urlplugin&quot; category=&quot;Custom&quot; /&gt;</span>
<span class="cm"> */</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">function</span> <span class="nx">echoSync</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">ax</span><span class="p">.</span><span class="nx">INVALID_VALUES_ERR</span><span class="p">,</span> <span class="s1">&#39;invalid argument!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">execSync</span><span class="p">(</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="nx">message</span><span class="o">||</span><span class="s1">&#39;&#39;</span> <span class="p">]);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">echoAsync</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">errback</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">ax</span><span class="p">.</span><span class="nx">INVALID_VALUES_ERR</span><span class="p">,</span> <span class="s1">&#39;invalid argument!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">execAsync</span><span class="p">(</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">errback</span><span class="p">,</span> <span class="p">[</span> <span class="nx">message</span><span class="o">||</span><span class="s1">&#39;&#39;</span> <span class="p">]);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">requestURL</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">errback</span><span class="p">,</span> <span class="nx">urlString</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">urlString</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">ax</span><span class="p">.</span><span class="nx">INVALID_VALUES_ERR</span><span class="p">,</span> <span class="s1">&#39;invalid argument!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
         <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">execAsync</span><span class="p">(</span><span class="s1">&#39;requestURL&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">errback</span><span class="p">,</span> <span class="p">[</span><span class="nx">urlString</span><span class="o">||</span><span class="s1">&#39;&#39;</span> <span class="p">]);</span>
    <span class="p">}</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">myplugin</span> <span class="o">=</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">&#39;net.saltfactory.hybridtutorial.urlplugin&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;echoSync&#39;</span><span class="o">:</span> <span class="nx">echoSync</span><span class="p">,</span>
        <span class="s1">&#39;echoAsync&#39;</span><span class="o">:</span> <span class="nx">echoAsync</span><span class="p">,</span>
        <span class="s1">&#39;requestURL&#39;</span><span class="o">:</span> <span class="nx">requestURL</span>

    <span class="p">});</span>
<span class="p">})();</span>
</code></pre></div>
<p>이제 iOS module project에서 execute 메소드에 다음 코드를 추가한다. 소스코드의 간결함을 위해서 github에서 NSURLConnection+Block 소스코드를 활용하였다. 이렇게 네이티브 코드에서 기존의 라이브러리를 추가하여 바로 사용을 할 수 있다. ( <a href="https://github.com/rickerbh/NSURLConnection-Blocks">https://github.com/rickerbh/NSURLConnection-Blocks</a> ) . axplugin.js에서 context로 네이티브로 요청이 들어올때 메소드 이름이 &#39;requestURL&#39; 일경우 동작하게 하는 메소드이다. 그리고 원격 데이터를 요청하고 처리한 NSData를 다시 message로 만들어서 context에 결과로 메세지를 보낸다.</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="c1">//</span>
<span class="c1">//  net_saltfactory_hybridtutorial_urlplugin_MyPlugin.m</span>
<span class="c1">//</span>
<span class="c1">//  Copyright 2011 none. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &quot;AxRuntimeContext.h&quot;</span>
<span class="cp">#import &quot;AxPluginContext.h&quot;</span>
<span class="cp">#import &quot;AxError.h&quot;</span>
<span class="cp">#import &quot;net_saltfactory_hybridtutorial_urlplugin_MyPlugin.h&quot;</span>
<span class="cp">#import &quot;NSURLConnection+Blocks.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">net_saltfactory_hybridtutorial_urlplugin_MyPlugin</span>

<span class="k">@synthesize</span> <span class="n">runtimeContext</span> <span class="o">=</span> <span class="n">_runtimeContext</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">activate:</span><span class="p">(</span><span class="bp">NSObject</span><span class="o">&lt;</span><span class="n">AxRuntimeContext</span><span class="o">&gt;*</span><span class="p">)</span><span class="nv">runtimeContext</span> <span class="p">{</span>
    <span class="n">_runtimeContext</span> <span class="o">=</span> <span class="p">[</span><span class="n">runtimeContext</span> <span class="k">retain</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">deactivate:</span><span class="p">(</span><span class="bp">NSObject</span><span class="o">&lt;</span><span class="n">AxRuntimeContext</span><span class="o">&gt;*</span><span class="p">)</span><span class="nv">runtimeContext</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">_runtimeContext</span> <span class="k">release</span><span class="p">];</span>
    <span class="n">_runtimeContext</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">execute:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">AxPluginContext</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">context</span> <span class="p">{</span>
    <span class="bp">NSString</span><span class="o">*</span> <span class="n">method</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span> <span class="n">getMethod</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">method</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;echo&quot;</span><span class="p">])</span> <span class="p">{</span>
        <span class="bp">NSString</span><span class="o">*</span> <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span> <span class="nl">getParamAsString</span><span class="p">:(</span><span class="mi">0</span><span class="p">)];</span>
        <span class="p">[</span><span class="n">context</span> <span class="nl">sendResult</span><span class="p">:(</span><span class="n">message</span><span class="p">)];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([[</span><span class="n">context</span> <span class="n">getMethod</span><span class="p">]</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;requestURL&quot;</span><span class="p">]){</span>
        <span class="bp">NSString</span><span class="o">*</span> <span class="n">urlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span> <span class="nl">getParamAsString</span><span class="p">:(</span><span class="mi">0</span><span class="p">)];</span>
        <span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="n">urlString</span><span class="p">];</span>
        <span class="bp">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
        <span class="p">[</span><span class="bp">NSURLConnection</span> <span class="nl">asyncRequest</span><span class="p">:</span><span class="n">request</span>
                              <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="bp">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">){</span>
                                  <span class="bp">NSString</span> <span class="o">*</span><span class="n">responseString</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSString</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithData</span><span class="p">:</span><span class="n">data</span> <span class="nl">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>

                                  <span class="p">[</span><span class="n">context</span> <span class="nl">sendResult</span><span class="p">:</span><span class="n">responseString</span><span class="p">];</span>
                              <span class="p">}</span>
                              <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                                  <span class="p">[</span><span class="n">context</span> <span class="nl">sendResult</span><span class="p">:[</span><span class="n">error</span> <span class="n">localizedDescription</span><span class="p">]];</span>
                              <span class="p">}];</span>


    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">context</span> <span class="nl">sendError</span><span class="p">:(</span><span class="n">AX_NOT_AVAILABLE_ERR</span><span class="p">)];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>마지막으로 이렇게 plugin project와 iOS module project에 수정된 코드를  application project에서 호출하여 사용해야한다. ajxplugin.js에서 myplugin이라는 객체로 plugin을 사용할 수 있는 ax.plugin을 설정하였고, 우리가 만든 requestURL을 호출하였다. 그리고 네티티브 코드가 실행되고 난 다음 callback으로 넘어온 결과를 json 파싱하여 text라는 div 엘리먼트 안에 text를 집어 넣게 된다.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;pragma&quot;</span> <span class="na">content=</span><span class="s">&quot;no-cache&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/appspresso/appspresso.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;locale-example.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script&gt;</span>
            <span class="c1">//activate ax.log(), comment out when you release app</span>
            <span class="nx">ax</span><span class="p">.</span><span class="nx">runMode</span> <span class="o">=</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">MODE_DEBUG</span><span class="p">;</span>
            <span class="nx">ax</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">);</span>

<span class="cm">/*          ax.ext.net.get(&#39;http://search.twitter.com/search.json?q=saltfactory&#39;,</span>
<span class="cm">                    function(response){</span>
<span class="cm">                        var json = JSON.parse(response.data);</span>
<span class="cm">                        var text = json.results[0].text;</span>
<span class="cm">                        ax.log(text);</span>
<span class="cm">                        document.getElementById(&quot;text&quot;).innerHTML = text;</span>
<span class="cm">                    },</span>
<span class="cm">                    function(erorr){</span>
<span class="cm">                        ax.log(error);</span>
<span class="cm">                    },</span>
<span class="cm">                    &#39;utf-8&#39;);  */</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://search.twitter.com/search.json?q=appspresso&#39;</span><span class="p">;</span>

                    <span class="kd">function</span> <span class="nx">errback</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="kd">function</span> <span class="nx">echoAsync</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">myplugin</span><span class="p">.</span><span class="nx">echoAsync</span><span class="p">(</span>
                            <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                            <span class="p">},</span> <span class="nx">errback</span><span class="p">,</span> <span class="s2">&quot;call myplugin.echoAsync()&quot;</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="kd">function</span> <span class="nx">echoSync</span><span class="p">()</span> <span class="p">{</span>

                        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">myplugin</span><span class="p">.</span><span class="nx">echoSync</span><span class="p">(</span><span class="s2">&quot;call myplugin.echoSync()&quot;</span><span class="p">);</span>
                        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="nx">myplugin</span><span class="p">.</span><span class="nx">requestURL</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                            <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                            <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">text</span><span class="p">;</span>
                            <span class="nx">ax</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
                            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
                    <span class="p">},</span> <span class="nx">errback</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
            <span class="nf">#text</span> <span class="p">{</span>
                <span class="k">color</span><span class="o">:</span><span class="nb">blue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;h3&gt;</span>net.saltfactory.hybridtutorial<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">        /platforms            ... Metafile, icon, application name FOR PLATFORM(Android, iOS, ...)</span>
<span class="c">        /src</span>
<span class="c">           /appspresso</span>
<span class="c">              /appspresso.js  ... AUTO-GENERATED FILE.</span>
<span class="c">           /locales           ... Directory for Localized content.</span>
<span class="c">                                  SEE ALSO, http://www.w3.org/TR/widgets/#folder-based-localization</span>
<span class="c">              /en</span>
<span class="c">                 /locale.js</span>
<span class="c">              /ko</span>
<span class="c">              /...</span>
<span class="c">           /index.html        ... this page</span>
<span class="c">           /locale-example.js ... sample javascript</span>
<span class="c">           /widget-icon.png   ... icon for widget.</span>
<span class="c">                                  IF YOU WANT TO CHANGE ICON FOR ANDROID or IOS,</span>
<span class="c">                                  YOU CAN DO IT in &#39;platforms&#39; DIRECTORY.</span>
<span class="c">        /project.xml          ... application configuration file</span>
<span class="c">         --&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>빌드해서 실행하면 다음과 같이 실행이 완료된다. ax.ext.net.get 내장 모듈과 사용할 때와 동일하게 네이티브 코드로 자신만의 plugin을 PDK로 만들어서 ax.plugin으로 연결하여 사용하여 얻은 결과이다.</p>

<p><img src="http://cfile9.uf.tistory.com/image/123111444F9E4D8812730D" alt=""></p>

<h2 id="결론">결론</h2>

<p>이 포스팅은 이해를 돕기 위해서 원격의 데이터를 요청하는 예제를 선택하였다. 그리고 네이티브 코드를 사요할 경우 기존의 외부 라이브러리를 사용할 수 있는것을 보여주기 위해서 NSURLConection+Block 을 사용하였다. 하지만 이렇게 간단한 URL요청은 ax.ext.net으로도 충분히 사용하는데 문제가 없다. 포스팅의 크기와 본문의 길이 때문에 예제는 iOS 버전만 남겼는데 Android 네이티브 코드를 사용하는 방법도 동일하다. (시간이 나는대로 다른 포스트로 추가하도록 하겠다.)성능상 네이티브가 꼭 필요한 경우에 이렇게 PDK를 이용하여 네이티브코드를 사용할 수 있다는 것을 설명하기 위해서 간단한 예제 코드를 만들었다. 이제 우리는 하이브리드 앱을 만들기 위해서 필요한 기술 중에서 cross domain으로부터 원격 데이터를 가져오는 방법에 대해서 웹 프로그램과 네이티브 프로그램을 처리하는 방법을 모두 살펴보았다. 그리고 ADE를 사용해서 javascript 코드와 HTML, CSS 코드를 디버깅하는 방법 또한 살펴보았다. 다음 포스팅은 UI Framework 를 적용하는 방법에 대해서 포스팅할 예정이다.</p>

<h2 id="연구원-소개">연구원 소개</h2>

<ul>
<li>작성자 : <a href="http://about.me/saltfactory">송성광</a> 개발 연구원</li>
<li>블로그 : <a href="http://blog.saltfactory.net">http://blog.saltfactory.net</a></li>
<li>이메일 : <a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
<li>트위터 : <a href="https://twitter.com/saltfactory">@saltfactory</a></li>
<li>페이스북 : <a href="https://facebook.com/salthub">https://facebook.com/salthub</a></li>
<li>연구소 : <a href="http://www.hibrain.net">하이브레인넷</a> 부설연구소</li>
<li>연구실 : <a href="http://dblab.changwon.ac.kr">창원대학교 데이터베이스 연구실</a></li>
</ul>

  </article>

  
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    
      var disqus_shortname = 'saltfactoryblog';
    
    // 
    
     var disqus_identifier = 'http://blog.saltfactory.net/129'; 
    


    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  



</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">saltfactory's blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <!-- <li>saltfactory's blog</li> -->
          <li><img class="profile" src="/assets/images/profile.png"/></li>
          <li><a href="mailto:saltfactory@gmail.com">saltfactory@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/saltfactory">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/saltfactory">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">@saltfactory</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://facebook.com/salthub">
              <span class="icon icon--facebook">
                <!-- <svg class="facebook-icon-svg" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#C2C2C2" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
</svg>
 -->
                <svg viewBox="0 0 16 28">
                  <path id="logo" d="M14.984 0.187v4.125h-2.453q-1.344 0-1.813 0.562t-0.469 1.687v2.953h4.578l-0.609 4.625h-3.969v11.859h-4.781v-11.859h-3.984v-4.625h3.984v-3.406q0-2.906 1.625-4.508t4.328-1.602q2.297 0 3.563 0.187z"></path>
                </svg>
              </span>
              <span class="username">salthub</span>
            </a>
          </li>

        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
